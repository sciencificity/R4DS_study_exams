<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Vebash Naidoo" />


<title>Chapter 10 - Relational Data with {dplyr}</title>

<script src="site_libs/jquery-1.12.4/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="site_libs/datatables-binding-0.16/datatables.js"></script>
<link href="site_libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="site_libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="site_libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="site_libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>

<link rel="icon" href="https://github.com/workflowr/workflowr-assets/raw/master/img/reproducible.png">
<!-- Add a small amount of space between sections. -->
<style type="text/css">
div.section {
  padding-top: 12px;
}
</style>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
      </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R4DS Book - Prep for exam</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="license.html">License</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Chapter 10 - Relational Data with {dplyr}</h1>
<h4 class="author">Vebash Naidoo</h4>
<h4 class="date">26/10/2020</h4>

</div>


<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-report" data-toggle="collapse" data-target="#workflowr-report">
<span class="glyphicon glyphicon-list" aria-hidden="true"></span> workflowr <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span>
</button>
</p>
<div id="workflowr-report" class="collapse">
<ul class="nav nav-tabs">
<li class="active">
<a data-toggle="tab" href="#summary">Summary</a>
</li>
<li>
<a data-toggle="tab" href="#checks"> Checks <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> </a>
</li>
<li>
<a data-toggle="tab" href="#versions">Past versions</a>
</li>
</ul>
<div class="tab-content">
<div id="summary" class="tab-pane fade in active">
<p>
<strong>Last updated:</strong> 2020-11-21
</p>
<p>
<strong>Checks:</strong> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> 7 <span class="glyphicon glyphicon-exclamation-sign text-danger" aria-hidden="true"></span> 0
</p>
<p>
<strong>Knit directory:</strong> <code>r4ds_book/</code> <span class="glyphicon glyphicon-question-sign" aria-hidden="true" title="This is the local directory in which the code in this file was executed."> </span>
</p>
<p>
This reproducible <a href="http://rmarkdown.rstudio.com">R Markdown</a> analysis was created with <a
  href="https://github.com/jdblischak/workflowr">workflowr</a> (version 1.6.2). The <em>Checks</em> tab describes the reproducibility checks that were applied when the results were created. The <em>Past versions</em> tab lists the development history.
</p>
<hr>
</div>
<div id="checks" class="tab-pane fade">
<div id="workflowr-checks" class="panel-group">
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRMarkdownfilestronguptodate"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>R Markdown file:</strong> up-to-date </a>
</p>
</div>
<div id="strongRMarkdownfilestronguptodate" class="panel-collapse collapse">
<div class="panel-body">
<p>Great! Since the R Markdown file has been committed to the Git repository, you know the exact version of the code that produced these results.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongEnvironmentstrongempty"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Environment:</strong> empty </a>
</p>
</div>
<div id="strongEnvironmentstrongempty" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! The global environment was empty. Objects defined in the global environment can affect the analysis in your R Markdown file in unknown ways. For reproduciblity it’s best to always run the code in an empty environment.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSeedstrongcodesetseed20200814code"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Seed:</strong> <code>set.seed(20200814)</code> </a>
</p>
</div>
<div id="strongSeedstrongcodesetseed20200814code" class="panel-collapse collapse">
<div class="panel-body">
<p>The command <code>set.seed(20200814)</code> was run prior to running the code in the R Markdown file. Setting a seed ensures that any results that rely on randomness, e.g. subsampling or permutations, are reproducible.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSessioninformationstrongrecorded"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Session information:</strong> recorded </a>
</p>
</div>
<div id="strongSessioninformationstrongrecorded" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Recording the operating system, R version, and package versions is critical for reproducibility.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongCachestrongnone"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Cache:</strong> none </a>
</p>
</div>
<div id="strongCachestrongnone" class="panel-collapse collapse">
<div class="panel-body">
<p>Nice! There were no cached chunks for this analysis, so you can be confident that you successfully produced the results during this run.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongFilepathsstrongrelative"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>File paths:</strong> relative </a>
</p>
</div>
<div id="strongFilepathsstrongrelative" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Using relative paths to the files within your workflowr project makes it easier to run your code on other machines.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRepositoryversionstrongahrefhttpsgithubcomsciencificityR4DSstudyexamstree6e7b3db6d0e7fa527d843407cafe965d5f7acd67targetblank6e7b3dba"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Repository version:</strong> <a href="https://github.com/sciencificity/R4DS_study_exams/tree/6e7b3db6d0e7fa527d843407cafe965d5f7acd67" target="_blank">6e7b3db</a> </a>
</p>
</div>
<div id="strongRepositoryversionstrongahrefhttpsgithubcomsciencificityR4DSstudyexamstree6e7b3db6d0e7fa527d843407cafe965d5f7acd67targetblank6e7b3dba" class="panel-collapse collapse">
<div class="panel-body">
<p>
Great! You are using Git for version control. Tracking code development and connecting the code version to the results is critical for reproducibility.
</p>
<p>
The results in this page were generated with repository version <a href="https://github.com/sciencificity/R4DS_study_exams/tree/6e7b3db6d0e7fa527d843407cafe965d5f7acd67" target="_blank">6e7b3db</a>. See the <em>Past versions</em> tab to see a history of the changes made to the R Markdown and HTML files.
</p>
<p>
Note that you need to be careful to ensure that all relevant files for the analysis have been committed to Git prior to generating the results (you can use <code>wflow_publish</code> or <code>wflow_git_commit</code>). workflowr only checks the R Markdown file, but you know if there are other scripts or data files that it depends on. Below is the status of the Git repository when the results were generated:
</p>
<pre><code>
Ignored files:
    Ignored:    .Rproj.user/

Untracked files:
    Untracked:  analysis/images/
    Untracked:  code_snipp.txt
    Untracked:  data/at_health_facilities.csv
    Untracked:  data/infant_hiv.csv
    Untracked:  data/measurements.csv
    Untracked:  data/person.csv
    Untracked:  data/ranking.csv
    Untracked:  data/visited.csv

</code></pre>
<p>
Note that any generated files, e.g. HTML, png, CSS, etc., are not included in this status report because it is ok for generated content to have uncommitted changes.
</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div id="versions" class="tab-pane fade">

<p>
These are the previous versions of the repository in which changes were made to the R Markdown (<code>analysis/ch10_relations_dplyr.Rmd</code>) and HTML (<code>docs/ch10_relations_dplyr.html</code>) files. If you’ve configured a remote Git repository (see <code>?wflow_git_remote</code>), click on the hyperlinks in the table below to view the files as they were in that past version.
</p>
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
File
</th>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
<th>
Message
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/sciencificity/R4DS_study_exams/7ed0458900c1f46198c63e4abf18223bec6e4a2f/docs/ch10_relations_dplyr.html" target="_blank">7ed0458</a>
</td>
<td>
sciencificity
</td>
<td>
2020-11-10
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/sciencificity/R4DS_study_exams/86457fa9c658cdc29f07e57c5b965859ac6c9814/docs/ch10_relations_dplyr.html" target="_blank">86457fa</a>
</td>
<td>
sciencificity
</td>
<td>
2020-11-10
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/sciencificity/R4DS_study_exams/4879249efdfb1b6acb1c0ed5d85a58fac5eeb0c2/docs/ch10_relations_dplyr.html" target="_blank">4879249</a>
</td>
<td>
sciencificity
</td>
<td>
2020-11-09
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/sciencificity/R4DS_study_exams/e4239674be77d3b6d016e78863ae5cf23c93a07b/docs/ch10_relations_dplyr.html" target="_blank">e423967</a>
</td>
<td>
sciencificity
</td>
<td>
2020-11-08
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/sciencificity/R4DS_study_exams/0d223fb536f932b6f5957f0eb33982ea0a73d3db/docs/ch10_relations_dplyr.html" target="_blank">0d223fb</a>
</td>
<td>
sciencificity
</td>
<td>
2020-11-08
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/sciencificity/R4DS_study_exams/ecd1d8ed8bb055d0acaf502bb58ca1845a946c31/docs/ch10_relations_dplyr.html" target="_blank">ecd1d8e</a>
</td>
<td>
sciencificity
</td>
<td>
2020-11-07
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/sciencificity/R4DS_study_exams/274005c12ed67cd6a85e644047ee088769411b8d/docs/ch10_relations_dplyr.html" target="_blank">274005c</a>
</td>
<td>
sciencificity
</td>
<td>
2020-11-06
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/sciencificity/R4DS_study_exams/60e7ce29b213bf0de9100b925369ab14e5b40973/docs/ch10_relations_dplyr.html" target="_blank">60e7ce2</a>
</td>
<td>
sciencificity
</td>
<td>
2020-11-02
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/sciencificity/R4DS_study_exams/db5a796c13f0cb36022a2fdc96cb9282a2304286/docs/ch10_relations_dplyr.html" target="_blank">db5a796</a>
</td>
<td>
sciencificity
</td>
<td>
2020-11-01
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/sciencificity/R4DS_study_exams/d8813e9e0385ceead4d53e252cce4c4334f3bdb2/docs/ch10_relations_dplyr.html" target="_blank">d8813e9</a>
</td>
<td>
sciencificity
</td>
<td>
2020-11-01
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/sciencificity/R4DS_study_exams/bf15f3bd2c94ef81cd7aa76aed6b70ab71335028/docs/ch10_relations_dplyr.html" target="_blank">bf15f3b</a>
</td>
<td>
sciencificity
</td>
<td>
2020-11-01
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/sciencificity/R4DS_study_exams/0aef1b0f9b5a050cc31609e13af14bc8129cc186/docs/ch10_relations_dplyr.html" target="_blank">0aef1b0</a>
</td>
<td>
sciencificity
</td>
<td>
2020-10-31
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/sciencificity/R4DS_study_exams/blob/72ad7d9fd9acac971aa29328e28745c8b8a9c43f/analysis/ch10_relations_dplyr.Rmd" target="_blank">72ad7d9</a>
</td>
<td>
sciencificity
</td>
<td>
2020-10-31
</td>
<td>
added ch10
</td>
</tr>
</tbody>
</table>
</div>
<hr>
</div>
</div>
</div>
<!-- I wanted the TOC to change depending on which tab we are in. This SO -->
<!-- Post has some info but doesn't work https://stackoverflow.com/questions/54803465/rmarkdown-is-it-possible-to-display-the-toc-of-the-current-tab-only-in-a-tabse -->
<style type="text/css">
.tabset h2 {display: none;}
</style>
<div id="buttons" class="section level1 tabset tabset-fade tabset-pills">
<h1>Relational Data</h1>
<p><strong>Click on the tab buttons below for each section</strong></p>
<h2>
Main types of joins
</h2>
<div id="main-types-of-joins" class="section level2">
<h2>Main types of joins</h2>
<ul>
<li><p><strong>Mutating joins</strong>, which add new variables to one data frame from matching observations in another.</p></li>
<li><p><strong>Filtering joins</strong>, which filter observations from one data frame based on whether or not they match an observation in the other table.</p></li>
<li><p><strong>Set operations</strong>, which treat observations as if they were set elements.</p></li>
</ul>
<div id="dataset" class="section level3">
<h3>Dataset</h3>
<p>These are the datasets we will be using to learn about <strong>joins</strong> which come from the <em>nycflights13</em> package.</p>
<ul>
<li><p><code>airlines</code> lets you look up the full carrier name from its abbreviated code:</p>
<pre class="r"><code>airlines
#&gt; # A tibble: 16 x 2
#&gt;    carrier name                       
#&gt;    &lt;chr&gt;   &lt;chr&gt;                      
#&gt;  1 9E      Endeavor Air Inc.          
#&gt;  2 AA      American Airlines Inc.     
#&gt;  3 AS      Alaska Airlines Inc.       
#&gt;  4 B6      JetBlue Airways            
#&gt;  5 DL      Delta Air Lines Inc.       
#&gt;  6 EV      ExpressJet Airlines Inc.   
#&gt;  7 F9      Frontier Airlines Inc.     
#&gt;  8 FL      AirTran Airways Corporation
#&gt;  9 HA      Hawaiian Airlines Inc.     
#&gt; 10 MQ      Envoy Air                  
#&gt; 11 OO      SkyWest Airlines Inc.      
#&gt; 12 UA      United Air Lines Inc.      
#&gt; 13 US      US Airways Inc.            
#&gt; 14 VX      Virgin America             
#&gt; 15 WN      Southwest Airlines Co.     
#&gt; 16 YV      Mesa Airlines Inc.</code></pre></li>
<li><p><code>airports</code> gives information about each airport, identified by the <code>faa</code> airport code:</p>
<pre class="r"><code>airports
#&gt; # A tibble: 1,458 x 8
#&gt;    faa   name                       lat    lon   alt    tz dst   tzone          
#&gt;    &lt;chr&gt; &lt;chr&gt;                    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;          
#&gt;  1 04G   Lansdowne Airport         41.1  -80.6  1044    -5 A     America/New_Yo~
#&gt;  2 06A   Moton Field Municipal A~  32.5  -85.7   264    -6 A     America/Chicago
#&gt;  3 06C   Schaumburg Regional       42.0  -88.1   801    -6 A     America/Chicago
#&gt;  4 06N   Randall Airport           41.4  -74.4   523    -5 A     America/New_Yo~
#&gt;  5 09J   Jekyll Island Airport     31.1  -81.4    11    -5 A     America/New_Yo~
#&gt;  6 0A9   Elizabethton Municipal ~  36.4  -82.2  1593    -5 A     America/New_Yo~
#&gt;  7 0G6   Williams County Airport   41.5  -84.5   730    -5 A     America/New_Yo~
#&gt;  8 0G7   Finger Lakes Regional A~  42.9  -76.8   492    -5 A     America/New_Yo~
#&gt;  9 0P2   Shoestring Aviation Air~  39.8  -76.6  1000    -5 U     America/New_Yo~
#&gt; 10 0S9   Jefferson County Intl     48.1 -123.    108    -8 A     America/Los_An~
#&gt; # ... with 1,448 more rows</code></pre></li>
<li><p><code>planes</code> gives information about each plane, identified by its <code>tailnum</code>:</p>
<pre class="r"><code>planes
#&gt; # A tibble: 3,322 x 9
#&gt;    tailnum  year type          manufacturer   model  engines seats speed engine 
#&gt;    &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;         &lt;chr&gt;          &lt;chr&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  
#&gt;  1 N10156   2004 Fixed wing m~ EMBRAER        EMB-1~       2    55    NA Turbo-~
#&gt;  2 N102UW   1998 Fixed wing m~ AIRBUS INDUST~ A320-~       2   182    NA Turbo-~
#&gt;  3 N103US   1999 Fixed wing m~ AIRBUS INDUST~ A320-~       2   182    NA Turbo-~
#&gt;  4 N104UW   1999 Fixed wing m~ AIRBUS INDUST~ A320-~       2   182    NA Turbo-~
#&gt;  5 N10575   2002 Fixed wing m~ EMBRAER        EMB-1~       2    55    NA Turbo-~
#&gt;  6 N105UW   1999 Fixed wing m~ AIRBUS INDUST~ A320-~       2   182    NA Turbo-~
#&gt;  7 N107US   1999 Fixed wing m~ AIRBUS INDUST~ A320-~       2   182    NA Turbo-~
#&gt;  8 N108UW   1999 Fixed wing m~ AIRBUS INDUST~ A320-~       2   182    NA Turbo-~
#&gt;  9 N109UW   1999 Fixed wing m~ AIRBUS INDUST~ A320-~       2   182    NA Turbo-~
#&gt; 10 N110UW   1999 Fixed wing m~ AIRBUS INDUST~ A320-~       2   182    NA Turbo-~
#&gt; # ... with 3,312 more rows</code></pre></li>
<li><p><code>weather</code> gives the weather at each NYC airport for each hour:</p>
<pre class="r"><code>weather
#&gt; # A tibble: 26,115 x 15
#&gt;    origin  year month   day  hour  temp  dewp humid wind_dir wind_speed
#&gt;    &lt;chr&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
#&gt;  1 EWR     2013     1     1     1  39.0  26.1  59.4      270      10.4 
#&gt;  2 EWR     2013     1     1     2  39.0  27.0  61.6      250       8.06
#&gt;  3 EWR     2013     1     1     3  39.0  28.0  64.4      240      11.5 
#&gt;  4 EWR     2013     1     1     4  39.9  28.0  62.2      250      12.7 
#&gt;  5 EWR     2013     1     1     5  39.0  28.0  64.4      260      12.7 
#&gt;  6 EWR     2013     1     1     6  37.9  28.0  67.2      240      11.5 
#&gt;  7 EWR     2013     1     1     7  39.0  28.0  64.4      240      15.0 
#&gt;  8 EWR     2013     1     1     8  39.9  28.0  62.2      250      10.4 
#&gt;  9 EWR     2013     1     1     9  39.9  28.0  62.2      260      15.0 
#&gt; 10 EWR     2013     1     1    10  41    28.0  59.6      260      13.8 
#&gt; # ... with 26,105 more rows, and 5 more variables: wind_gust &lt;dbl&gt;,
#&gt; #   precip &lt;dbl&gt;, pressure &lt;dbl&gt;, visib &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre></li>
<li><p><code>flights</code> gives the flights departing a NYC airport:</p>
<pre class="r"><code>flights
#&gt; # A tibble: 336,776 x 19
#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
#&gt;  1  2013     1     1      517            515         2      830            819
#&gt;  2  2013     1     1      533            529         4      850            830
#&gt;  3  2013     1     1      542            540         2      923            850
#&gt;  4  2013     1     1      544            545        -1     1004           1022
#&gt;  5  2013     1     1      554            600        -6      812            837
#&gt;  6  2013     1     1      554            558        -4      740            728
#&gt;  7  2013     1     1      555            600        -5      913            854
#&gt;  8  2013     1     1      557            600        -3      709            723
#&gt;  9  2013     1     1      557            600        -3      838            846
#&gt; 10  2013     1     1      558            600        -2      753            745
#&gt; # ... with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#&gt; #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre></li>
</ul>
<figure>
<p><img src="assets/relational-nycflights.png" width="800" height="600" alt="ERD"></p>
<figcaption>
Enterprise Relation Diagram from <a href="https://r4ds.had.co.nz/relational-data.html">R4DS</a>
</figcaption>
</figure>
<p><br></p>
<p>For nycflights13:</p>
<ul>
<li><p><code>flights</code> connects to <code>planes</code> via a single variable, <code>tailnum</code>.</p></li>
<li><p><code>flights</code> connects to <code>airlines</code> through the <code>carrier</code> variable.</p></li>
<li><p><code>flights</code> connects to <code>airports</code> in two ways: via the <code>origin</code> and <code>dest</code> variables.</p></li>
<li><p><code>flights</code> connects to <code>weather</code> via <code>origin</code> (the location), and <code>year</code>, <code>month</code>, <code>day</code> and <code>hour</code> (the time).</p></li>
</ul>
</div>
<div id="exercises" class="section level3">
<h3>Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Imagine you wanted to draw (approximately) the route each plane flies from its origin to its destination. What variables would you need? What tables would you need to combine?</p>
<p>We would need the origin and dest from <code>flights</code> and the lat and lon for each origin / dest from <code>airports</code>.</p></li>
<li><p>I forgot to draw the relationship between <code>weather</code> and <code>airports</code>. What is the relationship and how should it appear in the diagram?</p>
<p><code>weather</code> has origin, and <code>airports</code> has faa. These could be joined to get all weather conditions for each day and each hour in the dataset.</p></li>
<li><p><code>weather</code> only contains information for the origin (NYC) airports. If it contained weather records for all airports in the USA, what additional relation would it define with <code>flights</code>?</p>
<p>There would be a relation with dest.</p></li>
<li><p>We know that some days of the year are “special”, and fewer people than usual fly on them. How might you represent that data as a data frame? What would be the primary keys of that table? How would it connect to the existing tables?</p>
<p>I would have a table called <code>holidays</code> and it would have a <em>year</em>, <em>month</em> and <em>day</em> variable that can be used to connect to flights, and weather.</p></li>
</ol>
<h2>
Keys
</h2>
</div>
</div>
<div id="keys" class="section level2">
<h2>Keys</h2>
<ul>
<li><p>A table has a name, a column too has a name.</p></li>
<li><p>Rows however don’t have names, and need a way to be identified. This is done through a <strong>primary key</strong>. A primary key identifies a single row in a table. It is unique since no two rows can have the same primary key. It may be simple (a single column serves as the primary key) or composite (multiple columns serve as the primary key). <br> For example, <code>planes$tailnum</code> is a primary key because it uniquely identifies each plane in the <code>planes</code> table.</p></li>
<li><p>Data is spread among several columns. A <strong>foreign key</strong> allows you to associate the different tables you have. A <em>foreign key</em> is either a single column or multiple columns that reference values in some other table.<br> For example, <code>flights$tailnum</code> is a foreign key because it appears in the <code>flights</code> table where it matches each flight to a unique plane in the <code>planes</code> table.</p></li>
<li><p>A variable can be both a primary key <em>and</em> a foreign key. For example, <code>origin</code> is part of the <code>weather</code> primary key, and is also a foreign key for the <code>airports</code> table.</p></li>
</ul>
<pre><code class='language-r'><code>airlines %>% <br>&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>count</span>(carrier) %>% <br>&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>filter(n > 1)</span><br>#> # A tibble: 0 x 2<br>#> # ... with 2 variables: carrier <chr>, n <int><br><br>airports %>% <br>&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>count</span>(faa) %>% <br>&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>filter(n > 1)</span><br>#> # A tibble: 0 x 2<br>#> # ... with 2 variables: faa <chr>, n <int><br><br>planes %>% <br>&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>count</span>(tailnum) %>% <br>&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>filter(n > 1)</span><br>#> # A tibble: 0 x 2<br>#> # ... with 2 variables: tailnum <chr>, n <int><br><br>weather %>% <br>&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>count</span>(year, month, day, hour, origin) %>% <br>&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>filter(n > 1)</span> &nbsp;<br>#> # A tibble: 3 x 6<br>#> &nbsp;&nbsp;&nbsp;year month &nbsp;&nbsp;day &nbsp;hour origin &nbsp;&nbsp;&nbsp;&nbsp;n<br>#> &nbsp;&nbsp;<int> <int> <int> <int> <chr> &nbsp;<int><br>#> 1 &nbsp;2013 &nbsp;&nbsp;&nbsp;11 &nbsp;&nbsp;&nbsp;&nbsp;3 &nbsp;&nbsp;&nbsp;&nbsp;1 EWR &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2<br>#> 2 &nbsp;2013 &nbsp;&nbsp;&nbsp;11 &nbsp;&nbsp;&nbsp;&nbsp;3 &nbsp;&nbsp;&nbsp;&nbsp;1 JFK &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2<br>#> 3 &nbsp;2013 &nbsp;&nbsp;&nbsp;11 &nbsp;&nbsp;&nbsp;&nbsp;3 &nbsp;&nbsp;&nbsp;&nbsp;1 LGA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2<br>&nbsp;&nbsp;<br>weather %>% <br>&nbsp;&nbsp;filter(year == 2013,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;month == 11,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;day == 3,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hour == 1) %>% <br>&nbsp;&nbsp;print(width = Inf)<br>#> # A tibble: 6 x 15<br>#> &nbsp;&nbsp;origin &nbsp;year month &nbsp;&nbsp;day &nbsp;hour &nbsp;temp &nbsp;dewp humid wind_dir wind_speed wind_gust<br>#> &nbsp;&nbsp;<chr> &nbsp;<int> <int> <int> <int> <dbl> <dbl> <dbl> &nbsp;&nbsp;&nbsp;<dbl> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<dbl> &nbsp;&nbsp;&nbsp;&nbsp;<dbl><br>#> 1 EWR &nbsp;&nbsp;&nbsp;&nbsp;2013 &nbsp;&nbsp;&nbsp;11 &nbsp;&nbsp;&nbsp;&nbsp;3 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;52.0 &nbsp;39.0 &nbsp;61.2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;310 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6.90 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA<br>#> 2 EWR &nbsp;&nbsp;&nbsp;&nbsp;2013 &nbsp;&nbsp;&nbsp;11 &nbsp;&nbsp;&nbsp;&nbsp;3 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;50 &nbsp;&nbsp;&nbsp;39.0 &nbsp;65.8 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;290 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.75 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA<br>#> 3 JFK &nbsp;&nbsp;&nbsp;&nbsp;2013 &nbsp;&nbsp;&nbsp;11 &nbsp;&nbsp;&nbsp;&nbsp;3 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;54.0 &nbsp;37.9 &nbsp;54.5 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;320 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9.21 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA<br>#> 4 JFK &nbsp;&nbsp;&nbsp;&nbsp;2013 &nbsp;&nbsp;&nbsp;11 &nbsp;&nbsp;&nbsp;&nbsp;3 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;52.0 &nbsp;37.9 &nbsp;58.6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;310 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6.90 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA<br>#> 5 LGA &nbsp;&nbsp;&nbsp;&nbsp;2013 &nbsp;&nbsp;&nbsp;11 &nbsp;&nbsp;&nbsp;&nbsp;3 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;55.0 &nbsp;39.0 &nbsp;54.7 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;330 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9.21 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA<br>#> 6 LGA &nbsp;&nbsp;&nbsp;&nbsp;2013 &nbsp;&nbsp;&nbsp;11 &nbsp;&nbsp;&nbsp;&nbsp;3 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;54.0 &nbsp;39.9 &nbsp;58.9 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;310 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8.06 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA<br>#> &nbsp;&nbsp;precip pressure visib time_hour &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>#> &nbsp;&nbsp;&nbsp;<dbl> &nbsp;&nbsp;&nbsp;<dbl> <dbl> <dttm> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>#> 1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;1010. &nbsp;&nbsp;&nbsp;10 2013-11-03 01:00:00<br>#> 2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;1010. &nbsp;&nbsp;&nbsp;10 2013-11-03 01:00:00<br>#> 3 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;1010. &nbsp;&nbsp;&nbsp;10 2013-11-03 01:00:00<br>#> 4 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;1010. &nbsp;&nbsp;&nbsp;10 2013-11-03 01:00:00<br>#> 5 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;1009. &nbsp;&nbsp;&nbsp;10 2013-11-03 01:00:00<br>#> 6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;1010. &nbsp;&nbsp;&nbsp;10 2013-11-03 01:00:00<br><br>weather %>% <br>&nbsp;&nbsp;filter(year == 2013,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;month == 11,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;day == 3,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hour == 1) %>% <br>&nbsp;&nbsp;mutate(lag = lag(time_hour),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lead = lead(time_hour),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diff = time_hour - lag) %>% <br>&nbsp;&nbsp;print(width = Inf)<br>#> # A tibble: 6 x 18<br>#> &nbsp;&nbsp;origin &nbsp;year month &nbsp;&nbsp;day &nbsp;hour &nbsp;temp &nbsp;dewp humid wind_dir wind_speed wind_gust<br>#> &nbsp;&nbsp;<chr> &nbsp;<int> <int> <int> <int> <dbl> <dbl> <dbl> &nbsp;&nbsp;&nbsp;<dbl> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<dbl> &nbsp;&nbsp;&nbsp;&nbsp;<dbl><br>#> 1 EWR &nbsp;&nbsp;&nbsp;&nbsp;2013 &nbsp;&nbsp;&nbsp;11 &nbsp;&nbsp;&nbsp;&nbsp;3 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;52.0 &nbsp;39.0 &nbsp;61.2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;310 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6.90 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA<br>#> 2 EWR &nbsp;&nbsp;&nbsp;&nbsp;2013 &nbsp;&nbsp;&nbsp;11 &nbsp;&nbsp;&nbsp;&nbsp;3 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;50 &nbsp;&nbsp;&nbsp;39.0 &nbsp;65.8 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;290 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.75 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA<br>#> 3 JFK &nbsp;&nbsp;&nbsp;&nbsp;2013 &nbsp;&nbsp;&nbsp;11 &nbsp;&nbsp;&nbsp;&nbsp;3 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;54.0 &nbsp;37.9 &nbsp;54.5 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;320 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9.21 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA<br>#> 4 JFK &nbsp;&nbsp;&nbsp;&nbsp;2013 &nbsp;&nbsp;&nbsp;11 &nbsp;&nbsp;&nbsp;&nbsp;3 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;52.0 &nbsp;37.9 &nbsp;58.6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;310 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6.90 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA<br>#> 5 LGA &nbsp;&nbsp;&nbsp;&nbsp;2013 &nbsp;&nbsp;&nbsp;11 &nbsp;&nbsp;&nbsp;&nbsp;3 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;55.0 &nbsp;39.0 &nbsp;54.7 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;330 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9.21 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA<br>#> 6 LGA &nbsp;&nbsp;&nbsp;&nbsp;2013 &nbsp;&nbsp;&nbsp;11 &nbsp;&nbsp;&nbsp;&nbsp;3 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;54.0 &nbsp;39.9 &nbsp;58.9 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;310 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8.06 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA<br>#> &nbsp;&nbsp;precip pressure visib time_hour &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lag &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>#> &nbsp;&nbsp;&nbsp;<dbl> &nbsp;&nbsp;&nbsp;<dbl> <dbl> <dttm> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<dttm> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>#> 1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;1010. &nbsp;&nbsp;&nbsp;10 2013-11-03 01:00:00 NA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>#> 2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;1010. &nbsp;&nbsp;&nbsp;10 2013-11-03 01:00:00 2013-11-03 01:00:00<br>#> 3 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;1010. &nbsp;&nbsp;&nbsp;10 2013-11-03 01:00:00 2013-11-03 01:00:00<br>#> 4 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;1010. &nbsp;&nbsp;&nbsp;10 2013-11-03 01:00:00 2013-11-03 01:00:00<br>#> 5 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;1009. &nbsp;&nbsp;&nbsp;10 2013-11-03 01:00:00 2013-11-03 01:00:00<br>#> 6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;1010. &nbsp;&nbsp;&nbsp;10 2013-11-03 01:00:00 2013-11-03 01:00:00<br>#> &nbsp;&nbsp;lead &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diff &nbsp;&nbsp;&nbsp;<br>#> &nbsp;&nbsp;<dttm> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<drtn> &nbsp;<br>#> 1 2013-11-03 01:00:00 NA hours<br>#> 2 2013-11-03 01:00:00 &nbsp;1 hours<br>#> 3 2013-11-03 01:00:00 -1 hours<br>#> 4 2013-11-03 01:00:00 &nbsp;1 hours<br>#> 5 2013-11-03 01:00:00 -1 hours<br>#> 6 NA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 hours<br>&nbsp;&nbsp;<br><br>weather %>% <br>&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>count</span>(year, month, day, hour, origin, time_hour) %>% <br>&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>filter(n > 1)</span><br>#> # A tibble: 0 x 7<br>#> # ... with 7 variables: year <int>, month <int>, day <int>, hour <int>,<br>#> # &nbsp;&nbsp;origin <chr>, time_hour <dttm>, n <int><br><br>weather %>% <br>&nbsp;&nbsp;print(width = Inf)<br>#> # A tibble: 26,115 x 15<br>#> &nbsp;&nbsp;&nbsp;origin &nbsp;year month &nbsp;&nbsp;day &nbsp;hour &nbsp;temp &nbsp;dewp humid wind_dir wind_speed<br>#> &nbsp;&nbsp;&nbsp;<chr> &nbsp;<int> <int> <int> <int> <dbl> <dbl> <dbl> &nbsp;&nbsp;&nbsp;<dbl> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<dbl><br>#> &nbsp;1 EWR &nbsp;&nbsp;&nbsp;&nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;39.0 &nbsp;26.1 &nbsp;59.4 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;270 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.4 <br>#> &nbsp;2 EWR &nbsp;&nbsp;&nbsp;&nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;2 &nbsp;39.0 &nbsp;27.0 &nbsp;61.6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;250 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8.06<br>#> &nbsp;3 EWR &nbsp;&nbsp;&nbsp;&nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;3 &nbsp;39.0 &nbsp;28.0 &nbsp;64.4 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;240 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;11.5 <br>#> &nbsp;4 EWR &nbsp;&nbsp;&nbsp;&nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;4 &nbsp;39.9 &nbsp;28.0 &nbsp;62.2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;250 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;12.7 <br>#> &nbsp;5 EWR &nbsp;&nbsp;&nbsp;&nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;5 &nbsp;39.0 &nbsp;28.0 &nbsp;64.4 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;260 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;12.7 <br>#> &nbsp;6 EWR &nbsp;&nbsp;&nbsp;&nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;6 &nbsp;37.9 &nbsp;28.0 &nbsp;67.2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;240 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;11.5 <br>#> &nbsp;7 EWR &nbsp;&nbsp;&nbsp;&nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;7 &nbsp;39.0 &nbsp;28.0 &nbsp;64.4 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;240 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;15.0 <br>#> &nbsp;8 EWR &nbsp;&nbsp;&nbsp;&nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;8 &nbsp;39.9 &nbsp;28.0 &nbsp;62.2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;250 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.4 <br>#> &nbsp;9 EWR &nbsp;&nbsp;&nbsp;&nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;9 &nbsp;39.9 &nbsp;28.0 &nbsp;62.2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;260 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;15.0 <br>#> 10 EWR &nbsp;&nbsp;&nbsp;&nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;10 &nbsp;41 &nbsp;&nbsp;&nbsp;28.0 &nbsp;59.6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;260 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;13.8 <br>#> &nbsp;&nbsp;&nbsp;wind_gust precip pressure visib time_hour &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>#> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<dbl> &nbsp;<dbl> &nbsp;&nbsp;&nbsp;<dbl> <dbl> <dttm> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>#> &nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;1012 &nbsp;&nbsp;&nbsp;&nbsp;10 2013-01-01 01:00:00<br>#> &nbsp;2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;1012. &nbsp;&nbsp;&nbsp;10 2013-01-01 02:00:00<br>#> &nbsp;3 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;1012. &nbsp;&nbsp;&nbsp;10 2013-01-01 03:00:00<br>#> &nbsp;4 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;1012. &nbsp;&nbsp;&nbsp;10 2013-01-01 04:00:00<br>#> &nbsp;5 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;1012. &nbsp;&nbsp;&nbsp;10 2013-01-01 05:00:00<br>#> &nbsp;6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;1012. &nbsp;&nbsp;&nbsp;10 2013-01-01 06:00:00<br>#> &nbsp;7 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;1012. &nbsp;&nbsp;&nbsp;10 2013-01-01 07:00:00<br>#> &nbsp;8 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;1012. &nbsp;&nbsp;&nbsp;10 2013-01-01 08:00:00<br>#> &nbsp;9 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;1013. &nbsp;&nbsp;&nbsp;10 2013-01-01 09:00:00<br>#> 10 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;1012. &nbsp;&nbsp;&nbsp;10 2013-01-01 10:00:00<br>#> # ... with 26,105 more rows<br><br>flights %>% <br>&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>count</span>(year, month, day, hour, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;origin, dest, carrier,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tailnum) %>% <br>&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>filter(n > 1)</span><br>#> # A tibble: 13 x 9<br>#> &nbsp;&nbsp;&nbsp;&nbsp;year month &nbsp;&nbsp;day &nbsp;hour origin dest &nbsp;carrier tailnum &nbsp;&nbsp;&nbsp;&nbsp;n<br>#> &nbsp;&nbsp;&nbsp;<int> <int> <int> <dbl> <chr> &nbsp;<chr> <chr> &nbsp;&nbsp;<chr> &nbsp;&nbsp;<int><br>#> &nbsp;1 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;7 &nbsp;&nbsp;&nbsp;&nbsp;6 LGA &nbsp;&nbsp;&nbsp;ORD &nbsp;&nbsp;AA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;N3CYAA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2<br>#> &nbsp;2 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;2 &nbsp;&nbsp;&nbsp;&nbsp;8 &nbsp;&nbsp;&nbsp;16 EWR &nbsp;&nbsp;&nbsp;ORD &nbsp;&nbsp;UA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<NA> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2<br>#> &nbsp;3 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;2 &nbsp;&nbsp;&nbsp;&nbsp;9 &nbsp;&nbsp;&nbsp;&nbsp;6 EWR &nbsp;&nbsp;&nbsp;CLT &nbsp;&nbsp;US &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<NA> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2<br>#> &nbsp;4 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;2 &nbsp;&nbsp;&nbsp;&nbsp;9 &nbsp;&nbsp;&nbsp;&nbsp;6 LGA &nbsp;&nbsp;&nbsp;CLT &nbsp;&nbsp;US &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<NA> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2<br>#> &nbsp;5 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;2 &nbsp;&nbsp;&nbsp;&nbsp;9 &nbsp;&nbsp;&nbsp;&nbsp;6 LGA &nbsp;&nbsp;&nbsp;DFW &nbsp;&nbsp;AA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<NA> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2<br>#> &nbsp;6 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;2 &nbsp;&nbsp;&nbsp;&nbsp;9 &nbsp;&nbsp;&nbsp;&nbsp;6 LGA &nbsp;&nbsp;&nbsp;ORD &nbsp;&nbsp;AA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<NA> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2<br>#> &nbsp;7 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;2 &nbsp;&nbsp;&nbsp;&nbsp;9 &nbsp;&nbsp;&nbsp;&nbsp;7 LGA &nbsp;&nbsp;&nbsp;MIA &nbsp;&nbsp;AA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<NA> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2<br>#> &nbsp;8 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;3 &nbsp;&nbsp;&nbsp;19 &nbsp;&nbsp;&nbsp;&nbsp;7 LGA &nbsp;&nbsp;&nbsp;ORD &nbsp;&nbsp;AA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;N4XMAA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2<br>#> &nbsp;9 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;6 &nbsp;&nbsp;&nbsp;12 &nbsp;&nbsp;&nbsp;18 LGA &nbsp;&nbsp;&nbsp;ORD &nbsp;&nbsp;UA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<NA> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2<br>#> 10 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;7 &nbsp;&nbsp;&nbsp;&nbsp;6 &nbsp;&nbsp;&nbsp;15 EWR &nbsp;&nbsp;&nbsp;SFO &nbsp;&nbsp;UA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<NA> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2<br>#> 11 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;9 &nbsp;&nbsp;&nbsp;&nbsp;2 &nbsp;&nbsp;&nbsp;17 LGA &nbsp;&nbsp;&nbsp;ORD &nbsp;&nbsp;UA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<NA> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2<br>#> 12 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;9 &nbsp;&nbsp;&nbsp;12 &nbsp;&nbsp;&nbsp;17 LGA &nbsp;&nbsp;&nbsp;ORD &nbsp;&nbsp;UA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<NA> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2<br>#> 13 &nbsp;2013 &nbsp;&nbsp;&nbsp;11 &nbsp;&nbsp;&nbsp;25 &nbsp;&nbsp;&nbsp;&nbsp;6 LGA &nbsp;&nbsp;&nbsp;DFW &nbsp;&nbsp;AA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<NA> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2<br><br># Let's have a look at a few<br>flights %>% <br>&nbsp;&nbsp;filter(year == 2013, month == 1, day == 7, hour == "6",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;origin == "LGA", dest == "ORD",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carrier == "AA", tailnum == "N3CYAA") %>% <br>&nbsp;&nbsp;print(width = Inf)<br>#> # A tibble: 2 x 19<br>#> &nbsp;&nbsp;&nbsp;year month &nbsp;&nbsp;day dep_time sched_dep_time dep_delay arr_time sched_arr_time<br>#> &nbsp;&nbsp;<int> <int> <int> &nbsp;&nbsp;&nbsp;<int> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<int> &nbsp;&nbsp;&nbsp;&nbsp;<dbl> &nbsp;&nbsp;&nbsp;<int> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<int><br>#> 1 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;7 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;634 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;630 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;758 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;810<br>#> 2 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;7 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;600 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;745<br>#> &nbsp;&nbsp;arr_delay carrier flight tailnum origin dest &nbsp;air_time distance &nbsp;hour minute<br>#> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<dbl> <chr> &nbsp;&nbsp;&nbsp;<int> <chr> &nbsp;&nbsp;<chr> &nbsp;<chr> &nbsp;&nbsp;&nbsp;<dbl> &nbsp;&nbsp;&nbsp;<dbl> <dbl> &nbsp;<dbl><br>#> 1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-12 AA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;303 N3CYAA &nbsp;LGA &nbsp;&nbsp;&nbsp;ORD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;116 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;733 &nbsp;&nbsp;&nbsp;&nbsp;6 &nbsp;&nbsp;&nbsp;&nbsp;30<br>#> 2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA AA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;301 N3CYAA &nbsp;LGA &nbsp;&nbsp;&nbsp;ORD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;733 &nbsp;&nbsp;&nbsp;&nbsp;6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0<br>#> &nbsp;&nbsp;time_hour &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>#> &nbsp;&nbsp;<dttm> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>#> 1 2013-01-07 06:00:00<br>#> 2 2013-01-07 06:00:00<br><br>flights %>% <br>&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>count</span>(year, month, day, hour, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;origin, dest, carrier,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tailnum, flight) %>% <br>&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>filter(n > 1)</span><br>#> # A tibble: 0 x 10<br>#> # ... with 10 variables: year <int>, month <int>, day <int>, hour <dbl>,<br>#> # &nbsp;&nbsp;origin <chr>, dest <chr>, carrier <chr>, tailnum <chr>, flight <int>,<br>#> # &nbsp;&nbsp;n <int></code></code></pre>
<p>When even a combination of columns does not seem to identify an observation you may add your own primary key. The best is to use <span style="color: #008080;background-color:#9FDDBA"><strong>mutate</strong></span> with <span style="color: #008080;background-color:#9FDDBA"><code>row_number()</code></span>. This is called a <em>surrogate key</em>.</p>
<div id="exercises-1" class="section level3">
<h3>Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Add a surrogate key to <code>flights</code>.</p>
<pre class="r"><code>(flights_pk &lt;- flights %&gt;% 
  mutate(pk = row_number())) %T&gt;%
   print(width = Inf)
#&gt; # A tibble: 336,776 x 20
#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
#&gt;  1  2013     1     1      517            515         2      830            819
#&gt;  2  2013     1     1      533            529         4      850            830
#&gt;  3  2013     1     1      542            540         2      923            850
#&gt;  4  2013     1     1      544            545        -1     1004           1022
#&gt;  5  2013     1     1      554            600        -6      812            837
#&gt;  6  2013     1     1      554            558        -4      740            728
#&gt;  7  2013     1     1      555            600        -5      913            854
#&gt;  8  2013     1     1      557            600        -3      709            723
#&gt;  9  2013     1     1      557            600        -3      838            846
#&gt; 10  2013     1     1      558            600        -2      753            745
#&gt;    arr_delay carrier flight tailnum origin dest  air_time distance  hour minute
#&gt;        &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
#&gt;  1        11 UA        1545 N14228  EWR    IAH        227     1400     5     15
#&gt;  2        20 UA        1714 N24211  LGA    IAH        227     1416     5     29
#&gt;  3        33 AA        1141 N619AA  JFK    MIA        160     1089     5     40
#&gt;  4       -18 B6         725 N804JB  JFK    BQN        183     1576     5     45
#&gt;  5       -25 DL         461 N668DN  LGA    ATL        116      762     6      0
#&gt;  6        12 UA        1696 N39463  EWR    ORD        150      719     5     58
#&gt;  7        19 B6         507 N516JB  EWR    FLL        158     1065     6      0
#&gt;  8       -14 EV        5708 N829AS  LGA    IAD         53      229     6      0
#&gt;  9        -8 B6          79 N593JB  JFK    MCO        140      944     6      0
#&gt; 10         8 AA         301 N3ALAA  LGA    ORD        138      733     6      0
#&gt;    time_hour              pk
#&gt;    &lt;dttm&gt;              &lt;int&gt;
#&gt;  1 2013-01-01 05:00:00     1
#&gt;  2 2013-01-01 05:00:00     2
#&gt;  3 2013-01-01 05:00:00     3
#&gt;  4 2013-01-01 05:00:00     4
#&gt;  5 2013-01-01 06:00:00     5
#&gt;  6 2013-01-01 05:00:00     6
#&gt;  7 2013-01-01 06:00:00     7
#&gt;  8 2013-01-01 06:00:00     8
#&gt;  9 2013-01-01 06:00:00     9
#&gt; 10 2013-01-01 06:00:00    10
#&gt; # ... with 336,766 more rows
#&gt; # A tibble: 336,776 x 20
#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
#&gt;  1  2013     1     1      517            515         2      830            819
#&gt;  2  2013     1     1      533            529         4      850            830
#&gt;  3  2013     1     1      542            540         2      923            850
#&gt;  4  2013     1     1      544            545        -1     1004           1022
#&gt;  5  2013     1     1      554            600        -6      812            837
#&gt;  6  2013     1     1      554            558        -4      740            728
#&gt;  7  2013     1     1      555            600        -5      913            854
#&gt;  8  2013     1     1      557            600        -3      709            723
#&gt;  9  2013     1     1      557            600        -3      838            846
#&gt; 10  2013     1     1      558            600        -2      753            745
#&gt; # ... with 336,766 more rows, and 12 more variables: arr_delay &lt;dbl&gt;,
#&gt; #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;,
#&gt; #   pk &lt;int&gt;</code></pre></li>
<li><p>Identify the keys in the following datasets</p>
<ol style="list-style-type: lower-alpha">
<li><p><code>Lahman::Batting</code></p>
<p>Wondering how to figure out what datasets are available to you to use?</p>
<p>Call <span style="color: #008080;background-color:#9FDDBA"><code>data(package = 'XXX')</code></span> to get a listing.</p>
<pre class="r"><code>data(package = &quot;Lahman&quot;) %&gt;% 
  print()
</code></pre>
<p>The above produces a list like this 🔻:</p>
<figure>
<p><img src="assets/data_cmd.PNG" width="650" height="500" alt="Data in a package Lahman"></p>
<figcaption>
<p>data(package = ‘name_of_pkg’)</p>
</figcaption>
</figure>
<p><br></p>
<pre class="r"><code>data(&quot;Batting&quot;, package = &quot;Lahman&quot;)
# data(&quot;Salaries&quot;, package = &quot;Lahman&quot;)
# data(&quot;People&quot;, package = &quot;Lahman&quot;)

as_tibble(Batting) %&gt;% 
# first try
count(playerID, yearID, teamID) %&gt;% 
filter(n &gt; 1)
#&gt; # A tibble: 70 x 4
#&gt;    playerID  yearID teamID     n
#&gt;    &lt;chr&gt;      &lt;int&gt; &lt;fct&gt;  &lt;int&gt;
#&gt;  1 alyeabr01   1972 OAK        2
#&gt;  2 anderjo01   1898 BRO        2
#&gt;  3 baldwja01   2005 BAL        2
#&gt;  4 behrmha01   1947 BRO        2
#&gt;  5 chouife01   1914 BRF        3
#&gt;  6 clarkje02   2003 TEX        2
#&gt;  7 clarkni01   1905 CLE        2
#&gt;  8 cranddo01   1913 NY1        2
#&gt;  9 cranesa01   1890 NY1        2
#&gt; 10 donahpa01   1910 PHA        2
#&gt; # ... with 60 more rows

as_tibble(Batting) %&gt;%  
  # let&#39;s have a look at one to see what else
  # differentiates it
  filter(playerID == &quot;alyeabr01&quot;,
        yearID == 1972,
        teamID == &quot;OAK&quot;)
#&gt; # A tibble: 2 x 22
#&gt;   playerID yearID stint teamID lgID      G    AB     R     H   X2B   X3B    HR
#&gt;   &lt;chr&gt;     &lt;int&gt; &lt;int&gt; &lt;fct&gt;  &lt;fct&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
#&gt; 1 alyeabr~   1972     1 OAK    AL       10    13     1     3     1     0     0
#&gt; 2 alyeabr~   1972     3 OAK    AL       10    18     2     3     0     0     1
#&gt; # ... with 10 more variables: RBI &lt;int&gt;, SB &lt;int&gt;, CS &lt;int&gt;, BB &lt;int&gt;,
#&gt; #   SO &lt;int&gt;, IBB &lt;int&gt;, HBP &lt;int&gt;, SH &lt;int&gt;, SF &lt;int&gt;, GIDP &lt;int&gt;

as_tibble(Batting) %&gt;% 
  count(playerID, yearID, teamID, stint) %&gt;% 
  filter(n &gt; 1)
#&gt; # A tibble: 0 x 5
#&gt; # ... with 5 variables: playerID &lt;chr&gt;, yearID &lt;int&gt;, teamID &lt;fct&gt;,
#&gt; #   stint &lt;int&gt;, n &lt;int&gt;</code></pre>
<p>Looks like the key is <code>playerID</code>, <code>yearID</code>, <code>teamID</code> and <code>stint</code>.</p></li>
<li><p><code>babynames::babynames</code></p>
<pre class="r"><code>data(babynames, package = &quot;babynames&quot;)
class(babynames)
#&gt; [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;
babynames
#&gt; # A tibble: 1,924,665 x 5
#&gt;     year sex   name          n   prop
#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt;
#&gt;  1  1880 F     Mary       7065 0.0724
#&gt;  2  1880 F     Anna       2604 0.0267
#&gt;  3  1880 F     Emma       2003 0.0205
#&gt;  4  1880 F     Elizabeth  1939 0.0199
#&gt;  5  1880 F     Minnie     1746 0.0179
#&gt;  6  1880 F     Margaret   1578 0.0162
#&gt;  7  1880 F     Ida        1472 0.0151
#&gt;  8  1880 F     Alice      1414 0.0145
#&gt;  9  1880 F     Bertha     1320 0.0135
#&gt; 10  1880 F     Sarah      1288 0.0132
#&gt; # ... with 1,924,655 more rows
babynames %&gt;% 
  # n is in the columns so we need to name our variable
  # something else
  dplyr::count(year, sex, name,
              name = &quot;count&quot;,
  # without the wt = 1, it was using n as a weight in count                  
  # Using `n` as weighting variable
  # i Quiet this message with `wt = n` or count rows with `wt = 1`
              wt = 1) %&gt;% 
  filter(count &gt; 1)
#&gt; # A tibble: 0 x 4
#&gt; # ... with 4 variables: year &lt;dbl&gt;, sex &lt;chr&gt;, name &lt;chr&gt;, count &lt;dbl&gt;

babynames %&gt;% 
  group_by(year, sex, name) %&gt;% 
  summarise(nn = n())
#&gt; # A tibble: 1,924,665 x 4
#&gt; # Groups:   year, sex [276]
#&gt;     year sex   name        nn
#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;    &lt;int&gt;
#&gt;  1  1880 F     Abbie        1
#&gt;  2  1880 F     Abby         1
#&gt;  3  1880 F     Abigail      1
#&gt;  4  1880 F     Ada          1
#&gt;  5  1880 F     Adah         1
#&gt;  6  1880 F     Adaline      1
#&gt;  7  1880 F     Adda         1
#&gt;  8  1880 F     Addie        1
#&gt;  9  1880 F     Adela        1
#&gt; 10  1880 F     Adelaide     1
#&gt; # ... with 1,924,655 more rows

babynames %&gt;% 
  # confirming there is only one row for each
  filter(year == 1880, 
         sex == &#39;F&#39;,
         name == &#39;Abby&#39; | name == &quot;Adda&quot;)
#&gt; # A tibble: 2 x 5
#&gt;    year sex   name      n      prop
#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt;     &lt;dbl&gt;
#&gt; 1  1880 F     Adda     14 0.000143 
#&gt; 2  1880 F     Abby      6 0.0000615</code></pre>
<p>Looks like the key is <code>year</code>, <code>sex</code>, <code>name</code>. So, we had some issues here, since the dataset had an <code>n</code> variable in it. The <span style="color: #008080;background-color:#9FDDBA"><code>count() / tally()</code></span> function uses <code>n</code> as a weighting variable.</p>
<p>To fix this we need to:</p>
<ul>
<li>explicitly name the output variable something other than <code>n</code></li>
<li>add a <code>wt = 1</code> to not tally up the <code>n</code>.</li>
</ul>
<p>Let’s see this with the example tribble in the help docs.</p>
<p>First as it should be:</p>
<pre class="r"><code># use the `wt` argument to perform a weighted count. This is useful
# when the data has already been aggregated once
(df &lt;- tribble(
  ~name,    ~gender,   ~runs,
  &quot;Max&quot;,    &quot;male&quot;,       10,
  &quot;Sandra&quot;, &quot;female&quot;,      1,
  &quot;Susan&quot;,  &quot;female&quot;,      4
))
#&gt; # A tibble: 3 x 3
#&gt;   name   gender  runs
#&gt;   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt;
#&gt; 1 Max    male      10
#&gt; 2 Sandra female     1
#&gt; 3 Susan  female     4
# counts rows:
df %&gt;% count(gender)
#&gt; # A tibble: 2 x 2
#&gt;   gender     n
#&gt;   &lt;chr&gt;  &lt;int&gt;
#&gt; 1 female     2
#&gt; 2 male       1
# counts runs:
df %&gt;% count(gender, wt = runs)
#&gt; # A tibble: 2 x 2
#&gt;   gender     n
#&gt;   &lt;chr&gt;  &lt;dbl&gt;
#&gt; 1 female     5
#&gt; 2 male      10</code></pre>
<p>Now let’s rename <code>runs</code> to <code>n</code>, and we see the difference:</p>
<pre class="r"><code># use the `wt` argument to perform a weighted count. This is useful
# when the data has already been aggregated once
(df &lt;- tribble(
  ~name,    ~gender,      ~n,
  &quot;Max&quot;,    &quot;male&quot;,       10,
  &quot;Sandra&quot;, &quot;female&quot;,      1,
  &quot;Susan&quot;,  &quot;female&quot;,      4
))
#&gt; # A tibble: 3 x 3
#&gt;   name   gender     n
#&gt;   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt;
#&gt; 1 Max    male      10
#&gt; 2 Sandra female     1
#&gt; 3 Susan  female     4
# counts rows:
df %&gt;% count(gender) # weight(wt) = n implicit
#&gt; # A tibble: 2 x 2
#&gt;   gender     n
#&gt;   &lt;chr&gt;  &lt;int&gt;
#&gt; 1 female     2
#&gt; 2 male       1</code></pre>
<p>Adding a new name and a <code>wt = 1</code> we should get the original output as when we used the variable named <code>runs</code>. Here it shows <code>female</code> as 1 which is not correct. 🙀</p>
<pre class="r"><code># use the `wt` argument to perform a weighted count. This is useful
# when the data has already been aggregated once
(df &lt;- tribble(
  ~name,    ~gender,      ~n,
  &quot;Max&quot;,    &quot;male&quot;,       10,
  &quot;Sandra&quot;, &quot;female&quot;,      1,
  &quot;Susan&quot;,  &#39;female&#39;,      4
))
#&gt; # A tibble: 3 x 3
#&gt;   name   gender     n
#&gt;   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt;
#&gt; 1 Max    male      10
#&gt; 2 Sandra female     1
#&gt; 3 Susan  female     4
# counts rows:
df %&gt;% count(gender, 
             name = &quot;count&quot;, 
             wt = 1
             )
#&gt; # A tibble: 2 x 2
#&gt;   gender count
#&gt;   &lt;chr&gt;  &lt;dbl&gt;
#&gt; 1 female     1
#&gt; 2 male       1
# counts n&#39;s:
df %&gt;% count(gender, name = &quot;count&quot;, wt = n)
#&gt; # A tibble: 2 x 2
#&gt;   gender count
#&gt;   &lt;chr&gt;  &lt;dbl&gt;
#&gt; 1 female     5
#&gt; 2 male      10</code></pre>
<p>I am <span style="color: #FFE4E1;background-color:#E3242B">unsure what is really going on above</span>, as I expected <code>female = 2</code>, but I don’t have time to investigate. It does work for the <code>babynames</code> case so this may be some other anomaly - maybe convert to a factor and see?</p></li>
<li><p><code>nasaweather::atmos</code></p>
<pre class="r"><code>data(&quot;atmos&quot;, package = &quot;nasaweather&quot;)

atmos %&gt;% 
  count(lat, long, year, month) %&gt;% 
  filter(n &gt; 1)
#&gt; # A tibble: 0 x 5
#&gt; # ... with 5 variables: lat &lt;dbl&gt;, long &lt;dbl&gt;, year &lt;int&gt;, month &lt;int&gt;, n &lt;int&gt;</code></pre>
<p>Looks like the key is <code>lat</code>, <code>long</code>, <code>year</code> and <code>month</code>.</p></li>
<li><p><code>fueleconomy::vehicles</code></p>
<pre class="r"><code>fueleconomy::vehicles %&gt;% 
  count(id) %&gt;% 
  filter(n &gt; 1)
#&gt; # A tibble: 0 x 2
#&gt; # ... with 2 variables: id &lt;dbl&gt;, n &lt;int&gt;</code></pre>
<p>Looks like the key is <code>id</code>.</p></li>
<li><p><code>ggplot2::diamonds</code></p>
<pre class="r"><code>ggplot2::diamonds %&gt;% 
  count(carat, cut, color, clarity, price, depth, table, x, y, z) %&gt;% 
  filter(n &gt; 1)
#&gt; # A tibble: 143 x 11
#&gt;    carat cut       color clarity price depth table     x     y     z     n
#&gt;    &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
#&gt;  1  0.3  Good      J     VS1       394  63.4    57  4.23  4.26  2.69     2
#&gt;  2  0.3  Very Good G     VS2       526  63      55  4.29  4.31  2.71     2
#&gt;  3  0.3  Very Good J     VS1       506  63.4    57  4.26  4.23  2.69     2
#&gt;  4  0.3  Premium   D     SI1       709  62.2    58  4.31  4.28  2.67     2
#&gt;  5  0.3  Ideal     G     VS2       675  63      55  4.31  4.29  2.71     2
#&gt;  6  0.3  Ideal     G     IF        863  62.1    55  4.32  4.35  2.69     2
#&gt;  7  0.3  Ideal     H     SI1       450  62.2    57  4.26  4.29  2.66     2
#&gt;  8  0.3  Ideal     H     SI1       450  62.2    57  4.27  4.28  2.66     2
#&gt;  9  0.31 Good      D     SI1       571  63.5    56  4.29  4.31  2.73     2
#&gt; 10  0.31 Very Good D     SI1       732  63.5    56  4.31  4.29  2.73     2
#&gt; # ... with 133 more rows</code></pre>
<p>There is not a clear key for diamonds so here we would create one using a surrogate key via a mutate and row_number().</p></li>
</ol></li>
<li><p>Draw a diagram illustrating the connections between the <code>Batting</code>, <code>People</code>, and <code>Salaries</code> tables in the Lahman package. Draw another diagram that shows the relationship between <code>People</code>, <code>Managers</code>, <code>AwardsManagers</code>.</p>
<p>How would you characterise the relationship between the <code>Batting</code>, <code>Pitching</code>, and <code>Fielding</code> tables?</p>
<pre class="r"><code># the connections between the `Batting`, `People`, and `Salaries` 
data(&#39;Batting&#39;, package = &quot;Lahman&quot;)
data(&#39;People&#39;, package = &quot;Lahman&quot;)
data(&#39;Salaries&#39;, package = &quot;Lahman&quot;)

Batting &lt;- Batting %&gt;% 
  as_tibble() 

Batting %&gt;% 
  head(15) %&gt;% 
  DT::datatable()</code></pre>
<div id="htmlwidget-17ef7cc3e66da41b2073" style="width:100%;height:auto;" class="datatables html-widget"></div>
    <script type="application/json" data-for="htmlwidget-17ef7cc3e66da41b2073">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],["abercda01","addybo01","allisar01","allisdo01","ansonca01","armstbo01","barkeal01","barnero01","barrebi01","barrofr01","bassjo01","battijo01","bealsto01","beaveed01","bechtge01"],[1871,1871,1871,1871,1871,1871,1871,1871,1871,1871,1871,1871,1871,1871,1871],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],["TRO","RC1","CL1","WS3","RC1","FW1","RC1","BS1","FW1","BS1","CL1","CL1","WS3","TRO","PH1"],["NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA","NA"],[1,25,29,27,25,12,1,31,1,18,22,1,10,3,20],[4,118,137,133,120,49,4,157,5,86,89,3,36,15,94],[0,30,28,28,29,9,0,66,1,13,18,0,6,7,24],[0,32,40,44,39,11,1,63,1,13,27,0,7,6,33],[0,6,4,10,11,2,0,10,1,2,1,0,0,0,9],[0,0,5,2,3,1,0,9,0,1,10,0,0,0,1],[0,0,0,2,0,0,0,0,0,0,3,0,0,0,1],[0,13,19,27,16,5,2,34,1,11,18,0,1,5,21],[0,8,3,1,6,0,0,11,0,1,0,0,2,2,4],[0,1,1,1,2,1,0,6,0,0,1,0,0,0,0],[0,4,2,0,2,0,1,13,0,0,3,1,2,0,2],[0,0,5,2,1,1,0,1,0,0,4,0,0,0,2],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[0,0,1,0,0,0,0,1,0,0,0,0,2,0,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>playerID<\/th>\n      <th>yearID<\/th>\n      <th>stint<\/th>\n      <th>teamID<\/th>\n      <th>lgID<\/th>\n      <th>G<\/th>\n      <th>AB<\/th>\n      <th>R<\/th>\n      <th>H<\/th>\n      <th>X2B<\/th>\n      <th>X3B<\/th>\n      <th>HR<\/th>\n      <th>RBI<\/th>\n      <th>SB<\/th>\n      <th>CS<\/th>\n      <th>BB<\/th>\n      <th>SO<\/th>\n      <th>IBB<\/th>\n      <th>HBP<\/th>\n      <th>SH<\/th>\n      <th>SF<\/th>\n      <th>GIDP<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>
People &lt;- People %&gt;% 
  as_tibble() 

People %&gt;% 
  head(15) %&gt;% 
  DT::datatable()  </code></pre>
<div id="htmlwidget-9b334804dafb5fb3b7a3" style="width:100%;height:auto;" class="datatables html-widget"></div>
    <script type="application/json" data-for="htmlwidget-9b334804dafb5fb3b7a3">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],["aardsda01","aaronha01","aaronto01","aasedo01","abadan01","abadfe01","abadijo01","abbated01","abbeybe01","abbeych01","abbotda01","abbotfr01","abbotgl01","abbotje01","abbotji01"],[1981,1934,1939,1954,1972,1985,1850,1877,1869,1866,1862,1874,1951,1972,1967],[12,2,8,9,8,12,11,4,11,10,3,10,2,8,9],[27,5,5,8,25,17,4,15,11,14,16,22,16,17,19],["USA","USA","USA","USA","USA","D.R.","USA","USA","USA","USA","USA","USA","USA","USA","USA"],["CO","AL","AL","CA","FL","La Romana","PA","PA","VT","NE","OH","OH","AR","GA","MI"],["Denver","Mobile","Mobile","Orange","Palm Beach","La Romana","Philadelphia","Latrobe","Essex","Falls City","Portage","Versailles","Little Rock","Atlanta","Flint"],[null,null,1984,null,null,null,1905,1957,1962,1926,1930,1935,null,null,null],[null,null,8,null,null,null,5,1,6,4,2,6,null,null,null],[null,null,16,null,null,null,17,6,11,27,13,11,null,null,null],[null,null,"USA",null,null,null,"USA","USA","USA","USA","USA","USA",null,null,null],[null,null,"GA",null,null,null,"NJ","FL","VT","CA","MI","CA",null,null,null],[null,null,"Atlanta",null,null,null,"Pemberton","Fort Lauderdale","Colchester","San Francisco","Ottawa Lake","Los Angeles",null,null,null],["David","Hank","Tommie","Don","Andy","Fernando","John","Ed","Bert","Charlie","Dan","Fred","Glenn","Jeff","Jim"],["Aardsma","Aaron","Aaron","Aase","Abad","Abad","Abadie","Abbaticchio","Abbey","Abbey","Abbott","Abbott","Abbott","Abbott","Abbott"],["David Allan","Henry Louis","Tommie Lee","Donald William","Fausto Andres","Fernando Antonio","John W.","Edward James","Bert Wood","Charles S.","Leander Franklin","Harry Frederick","William Glenn","Jeffrey William","James Anthony"],[215,180,190,190,184,220,192,170,175,169,190,180,200,190,200],[75,72,75,75,73,73,72,71,71,68,71,70,78,74,75],["R","R","R","R","L","L","R","R","R","L","R","R","R","R","L"],["R","R","R","R","L","L","R","R","R","L","R","R","R","L","L"],["2004-04-06","1954-04-13","1962-04-10","1977-07-26","2001-09-10","2010-07-28","1875-04-26","1897-09-04","1892-06-14","1893-08-16","1890-04-19","1903-04-25","1973-07-29","1997-06-10","1989-04-08"],["2015-08-23","1976-10-03","1971-09-26","1990-10-03","2006-04-13","2019-09-28","1875-06-10","1910-09-15","1896-09-23","1897-08-19","1890-05-23","1905-09-20","1984-08-08","2001-09-29","1999-07-21"],["aardd001","aaroh101","aarot101","aased001","abada001","abadf001","abadj101","abbae101","abbeb101","abbec101","abbod101","abbof101","abbog001","abboj002","abboj001"],["aardsda01","aaronha01","aaronto01","aasedo01","abadan01","abadfe01","abadijo01","abbated01","abbeybe01","abbeych01","abbotda01","abbotfr01","abbotgl01","abbotje01","abbotji01"],[null,null,"1984-08-16",null,null,null,"1905-05-17","1957-01-06","1962-06-11","1926-04-27","1930-02-13","1935-06-11",null,null,null],["1981-12-27","1934-02-05","1939-08-05","1954-09-08","1972-08-25","1985-12-17","1850-11-04","1877-04-15","1869-11-11","1866-10-14","1862-03-16","1874-10-22","1951-02-16","1972-08-17","1967-09-19"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>playerID<\/th>\n      <th>birthYear<\/th>\n      <th>birthMonth<\/th>\n      <th>birthDay<\/th>\n      <th>birthCountry<\/th>\n      <th>birthState<\/th>\n      <th>birthCity<\/th>\n      <th>deathYear<\/th>\n      <th>deathMonth<\/th>\n      <th>deathDay<\/th>\n      <th>deathCountry<\/th>\n      <th>deathState<\/th>\n      <th>deathCity<\/th>\n      <th>nameFirst<\/th>\n      <th>nameLast<\/th>\n      <th>nameGiven<\/th>\n      <th>weight<\/th>\n      <th>height<\/th>\n      <th>bats<\/th>\n      <th>throws<\/th>\n      <th>debut<\/th>\n      <th>finalGame<\/th>\n      <th>retroID<\/th>\n      <th>bbrefID<\/th>\n      <th>deathDate<\/th>\n      <th>birthDate<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,8,9,10,17,18]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>
Batting %&gt;% 
  # how many distinct &quot;players&quot;?
  distinct(playerID) %&gt;% 
  nrow()
#&gt; [1] 19689

People %&gt;% 
  # how many distinct &quot;people&quot;?
  distinct(playerID) %&gt;% 
  # ahh, notice num_people &gt; num_players
  # this accounts for the managers etc. I believe
  nrow()
#&gt; [1] 19878

Salaries &lt;- Salaries %&gt;% 
  as_tibble()

Salaries %&gt;% 
  head(15) %&gt;% 
  DT::datatable()  </code></pre>
<div id="htmlwidget-14e359495ee8d32c8554" style="width:100%;height:auto;" class="datatables html-widget"></div>
    <script type="application/json" data-for="htmlwidget-14e359495ee8d32c8554">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],[1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985],["ATL","ATL","ATL","ATL","ATL","ATL","ATL","ATL","ATL","ATL","ATL","ATL","ATL","ATL","ATL"],["NL","NL","NL","NL","NL","NL","NL","NL","NL","NL","NL","NL","NL","NL","NL"],["barkele01","bedrost01","benedbr01","campri01","ceronri01","chambch01","dedmoje01","forstte01","garbege01","harpete01","hornebo01","hubbagl01","mahleri01","mcmurcr01","mumphje01"],[870000,550000,545000,633333,625000,800000,150000,483333,772000,250000,1500000,455000,407500,275000,775000]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>yearID<\/th>\n      <th>teamID<\/th>\n      <th>lgID<\/th>\n      <th>playerID<\/th>\n      <th>salary<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>
Salaries %&gt;% 
  # how many distinct &quot;people&quot; do we have salaries for?
  distinct(playerID) %&gt;% 
  # ahh, notice we have very few salary records
  nrow()  
#&gt; [1] 5149</code></pre>
<figure>
<p><img src="assets/players.PNG" width="650" height="550" alt="ERD for a few tables"></p>
<figcaption>
<p>Enterprise Relationship Diagram (ERD) for a couple of tables</p>
</figcaption>
</figure>
<p><br></p>
<pre class="r"><code># the relationship between `People`, `Managers`, `AwardsManagers`.
Lahman::People %&gt;% 
  as_tibble() %&gt;% 
  head()
#&gt; # A tibble: 6 x 26
#&gt;   playerID birthYear birthMonth birthDay birthCountry birthState birthCity
#&gt;   &lt;chr&gt;        &lt;int&gt;      &lt;int&gt;    &lt;int&gt; &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;    
#&gt; 1 aardsda~      1981         12       27 USA          CO         Denver   
#&gt; 2 aaronha~      1934          2        5 USA          AL         Mobile   
#&gt; 3 aaronto~      1939          8        5 USA          AL         Mobile   
#&gt; 4 aasedo01      1954          9        8 USA          CA         Orange   
#&gt; 5 abadan01      1972          8       25 USA          FL         Palm Bea~
#&gt; 6 abadfe01      1985         12       17 D.R.         La Romana  La Romana
#&gt; # ... with 19 more variables: deathYear &lt;int&gt;, deathMonth &lt;int&gt;,
#&gt; #   deathDay &lt;int&gt;, deathCountry &lt;chr&gt;, deathState &lt;chr&gt;, deathCity &lt;chr&gt;,
#&gt; #   nameFirst &lt;chr&gt;, nameLast &lt;chr&gt;, nameGiven &lt;chr&gt;, weight &lt;int&gt;,
#&gt; #   height &lt;int&gt;, bats &lt;fct&gt;, throws &lt;fct&gt;, debut &lt;chr&gt;, finalGame &lt;chr&gt;,
#&gt; #   retroID &lt;chr&gt;, bbrefID &lt;chr&gt;, deathDate &lt;date&gt;, birthDate &lt;date&gt;

Lahman::Managers %&gt;% 
  as_tibble() %&gt;% 
  head()
#&gt; # A tibble: 6 x 10
#&gt;   playerID  yearID teamID lgID  inseason     G     W     L  rank plyrMgr
#&gt;   &lt;chr&gt;      &lt;int&gt; &lt;fct&gt;  &lt;fct&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;fct&gt;  
#&gt; 1 wrighha01   1871 BS1    NA           1    31    20    10     3 Y      
#&gt; 2 woodji01    1871 CH1    NA           1    28    19     9     2 Y      
#&gt; 3 paborch01   1871 CL1    NA           1    29    10    19     8 Y      
#&gt; 4 lennobi01   1871 FW1    NA           1    14     5     9     8 Y      
#&gt; 5 deaneha01   1871 FW1    NA           2     5     2     3     8 Y      
#&gt; 6 fergubo01   1871 NY2    NA           1    33    16    17     5 Y

Lahman::AwardsManagers %&gt;% 
  as_tibble() %&gt;% 
  head()
#&gt; # A tibble: 6 x 6
#&gt;   playerID  awardID                   yearID lgID  tie   notes
#&gt;   &lt;chr&gt;     &lt;chr&gt;                      &lt;int&gt; &lt;fct&gt; &lt;chr&gt; &lt;lgl&gt;
#&gt; 1 larusto01 BBWAA Manager of the Year   1983 AL    &lt;NA&gt;  NA   
#&gt; 2 lasorto01 BBWAA Manager of the Year   1983 NL    &lt;NA&gt;  NA   
#&gt; 3 andersp01 BBWAA Manager of the Year   1984 AL    &lt;NA&gt;  NA   
#&gt; 4 freyji99  BBWAA Manager of the Year   1984 NL    &lt;NA&gt;  NA   
#&gt; 5 coxbo01   BBWAA Manager of the Year   1985 AL    &lt;NA&gt;  NA   
#&gt; 6 herzowh01 BBWAA Manager of the Year   1985 NL    &lt;NA&gt;  NA</code></pre>
<figure>
<p><img src="assets/players2.PNG" width="650" height="550" alt="ERD for a few tables"></p>
<figcaption>
<p>Enterprise Relationship Diagram (ERD) for a couple of tables</p>
</figcaption>
</figure>
<p><br></p>
<pre class="r"><code>Lahman::Batting %&gt;% 
  as_tibble() %&gt;% 
  head()
#&gt; # A tibble: 6 x 22
#&gt;   playerID yearID stint teamID lgID      G    AB     R     H   X2B   X3B    HR
#&gt;   &lt;chr&gt;     &lt;int&gt; &lt;int&gt; &lt;fct&gt;  &lt;fct&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
#&gt; 1 abercda~   1871     1 TRO    NA        1     4     0     0     0     0     0
#&gt; 2 addybo01   1871     1 RC1    NA       25   118    30    32     6     0     0
#&gt; 3 allisar~   1871     1 CL1    NA       29   137    28    40     4     5     0
#&gt; 4 allisdo~   1871     1 WS3    NA       27   133    28    44    10     2     2
#&gt; 5 ansonca~   1871     1 RC1    NA       25   120    29    39    11     3     0
#&gt; 6 armstbo~   1871     1 FW1    NA       12    49     9    11     2     1     0
#&gt; # ... with 10 more variables: RBI &lt;int&gt;, SB &lt;int&gt;, CS &lt;int&gt;, BB &lt;int&gt;,
#&gt; #   SO &lt;int&gt;, IBB &lt;int&gt;, HBP &lt;int&gt;, SH &lt;int&gt;, SF &lt;int&gt;, GIDP &lt;int&gt;

Lahman::Pitching %&gt;% 
  as_tibble() %&gt;% 
  head()
#&gt; # A tibble: 6 x 30
#&gt;   playerID yearID stint teamID lgID      W     L     G    GS    CG   SHO    SV
#&gt;   &lt;chr&gt;     &lt;int&gt; &lt;int&gt; &lt;fct&gt;  &lt;fct&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
#&gt; 1 bechtge~   1871     1 PH1    NA        1     2     3     3     2     0     0
#&gt; 2 brainas~   1871     1 WS3    NA       12    15    30    30    30     0     0
#&gt; 3 fergubo~   1871     1 NY2    NA        0     0     1     0     0     0     0
#&gt; 4 fishech~   1871     1 RC1    NA        4    16    24    24    22     1     0
#&gt; 5 fleetfr~   1871     1 NY2    NA        0     1     1     1     1     0     0
#&gt; 6 flowedi~   1871     1 TRO    NA        0     0     1     0     0     0     0
#&gt; # ... with 18 more variables: IPouts &lt;int&gt;, H &lt;int&gt;, ER &lt;int&gt;, HR &lt;int&gt;,
#&gt; #   BB &lt;int&gt;, SO &lt;int&gt;, BAOpp &lt;dbl&gt;, ERA &lt;dbl&gt;, IBB &lt;int&gt;, WP &lt;int&gt;, HBP &lt;int&gt;,
#&gt; #   BK &lt;int&gt;, BFP &lt;int&gt;, GF &lt;int&gt;, R &lt;int&gt;, SH &lt;int&gt;, SF &lt;int&gt;, GIDP &lt;int&gt;

Lahman::Fielding %&gt;% 
  as_tibble() %&gt;% 
  head()
#&gt; # A tibble: 6 x 18
#&gt;   playerID yearID stint teamID lgID  POS       G    GS InnOuts    PO     A     E
#&gt;   &lt;chr&gt;     &lt;int&gt; &lt;int&gt; &lt;fct&gt;  &lt;fct&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
#&gt; 1 abercda~   1871     1 TRO    NA    SS        1     1      24     1     3     2
#&gt; 2 addybo01   1871     1 RC1    NA    2B       22    22     606    67    72    42
#&gt; 3 addybo01   1871     1 RC1    NA    SS        3     3      96     8    14     7
#&gt; 4 allisar~   1871     1 CL1    NA    2B        2     0      18     1     4     0
#&gt; 5 allisar~   1871     1 CL1    NA    OF       29    29     729    51     3     7
#&gt; 6 allisdo~   1871     1 WS3    NA    C        27    27     681    68    15    20
#&gt; # ... with 6 more variables: DP &lt;int&gt;, PB &lt;int&gt;, WP &lt;int&gt;, SB &lt;int&gt;, CS &lt;int&gt;,
#&gt; #   ZR &lt;int&gt;

Lahman::battingLabels %&gt;% 
  as_tibble() %&gt;% 
  DT::datatable()</code></pre>
<div id="htmlwidget-76f151308c6cad255e4d" style="width:100%;height:auto;" class="datatables html-widget"></div>
    <script type="application/json" data-for="htmlwidget-76f151308c6cad255e4d">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22"],["playerID","yearID","stint","teamID","lgID","G","AB","R","H","X2B","X3B","HR","RBI","SB","CS","BB","SO","IBB","HBP","SH","SF","GIDP"],["Player ID code","Year","Player's stint","Team","League","Games","At Bats","Runs","Hits","Doubles","Triples","Homeruns","Runs Batted In","Stolen Bases","Caught Stealing","Base on Balls","Strikeouts","Intentional walks","Hit by pitch","Sacrifice hits","Sacrifice flies","Grounded into double plays"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>variable<\/th>\n      <th>label<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>
Lahman::pitchingLabels %&gt;% 
  as_tibble() %&gt;% 
  DT::datatable()</code></pre>
<div id="htmlwidget-a24697eb28feda122ab4" style="width:100%;height:auto;" class="datatables html-widget"></div>
    <script type="application/json" data-for="htmlwidget-a24697eb28feda122ab4">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30"],["playerID","yearID","stint","teamID","lgID","W","L","G","GS","CG","SHO","SV","IPOuts","H","ER","HR","BB","SO","BAOpp","ERA","IBB","WP","HBP","BK","BFP","GF","R","SH","SF","GIDP"],["Player ID code","Year","Player's stint","Team","League","Wins","Losses","Games","Games Started","Complete Games ","Shutouts","Saves","Outs Pitched","Hits","Earned Runs","Homeruns","Walks","Strikeouts","Opponent's Batting Average","Earned Run Average","Intentional Walks","Wild Pitches","Batters Hit By Pitch","Balks","Batters faced by Pitcher","Games Finished","Runs Allowed","Sacrifices by opposing batters","Sacrifice flies by opposing batters","Grounded into double plays by opposing batter"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>variable<\/th>\n      <th>label<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>
Lahman::fieldingLabels %&gt;% 
  as_tibble() %&gt;% 
  DT::datatable()</code></pre>
<div id="htmlwidget-96a1802908d26287a15b" style="width:100%;height:auto;" class="datatables html-widget"></div>
    <script type="application/json" data-for="htmlwidget-96a1802908d26287a15b">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18"],["playerID","yearID","stint","teamID","lgID","Pos","G","GS","InnOuts","PO","A","E","DP","PB","WP","SB","CS","ZR"],["Player ID code","Year","Player's stint","Team","League","Position","Games ","Games Started","Time played in the field (outs)","Putouts","Assists","Errors","Double Plays","Passed Balls (by catchers)","Wild Pitches (by catchers)","Opponent Stolen Bases (by catchers)","Opponents Caught Stealing (by catchers)","Zone Rating"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>variable<\/th>\n      <th>label<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script>
<p>I think these are complementary tables which all together make up the different aspects of the game of baseball, and the stats for each player.</p></li>
</ol>
<h2>
Mutating joins
</h2>
</div>
</div>
<div id="mutating-joins" class="section level2">
<h2>Mutating joins</h2>
<p>Just as <code>mutate()</code> adds new variables to a dataset <span style="color: #008080;background-color:#9FDDBA">mutating joins</span> joins two datasets and tags on the extra variables on the right.</p>
<ul>
<li>Tables are joined using <span style="color: #008080;background-color:#9FDDBA">keys</span>.</li>
<li>Additional variables are <span style="color: #008080;background-color:#9FDDBA">copied over</span> from one table to another.</li>
</ul>
<pre class="r"><code>(flights2 &lt;- flights %&gt;% 
   select(year:day, hour, origin, dest, tailnum, carrier)
)
#&gt; # A tibble: 336,776 x 8
#&gt;     year month   day  hour origin dest  tailnum carrier
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;  
#&gt;  1  2013     1     1     5 EWR    IAH   N14228  UA     
#&gt;  2  2013     1     1     5 LGA    IAH   N24211  UA     
#&gt;  3  2013     1     1     5 JFK    MIA   N619AA  AA     
#&gt;  4  2013     1     1     5 JFK    BQN   N804JB  B6     
#&gt;  5  2013     1     1     6 LGA    ATL   N668DN  DL     
#&gt;  6  2013     1     1     5 EWR    ORD   N39463  UA     
#&gt;  7  2013     1     1     6 EWR    FLL   N516JB  B6     
#&gt;  8  2013     1     1     6 LGA    IAD   N829AS  EV     
#&gt;  9  2013     1     1     6 JFK    MCO   N593JB  B6     
#&gt; 10  2013     1     1     6 LGA    ORD   N3ALAA  AA     
#&gt; # ... with 336,766 more rows</code></pre>
<p>Let’s say we want to add the actual airline.</p>
<ul>
<li>Need to figure out where we would get this … looking at our tables it seems <code>airlines</code> would be appropriate.</li>
<li>Need to figure out which field we can use to join it to <code>flights</code> … looks like <code>carrier</code> will do.</li>
</ul>
<pre class="r"><code>flights2 %&gt;% 
  left_join(airlines, by = &quot;carrier&quot;) %&gt;% 
  print(width = Inf)
#&gt; # A tibble: 336,776 x 9
#&gt;     year month   day  hour origin dest  tailnum carrier name                    
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;                   
#&gt;  1  2013     1     1     5 EWR    IAH   N14228  UA      United Air Lines Inc.   
#&gt;  2  2013     1     1     5 LGA    IAH   N24211  UA      United Air Lines Inc.   
#&gt;  3  2013     1     1     5 JFK    MIA   N619AA  AA      American Airlines Inc.  
#&gt;  4  2013     1     1     5 JFK    BQN   N804JB  B6      JetBlue Airways         
#&gt;  5  2013     1     1     6 LGA    ATL   N668DN  DL      Delta Air Lines Inc.    
#&gt;  6  2013     1     1     5 EWR    ORD   N39463  UA      United Air Lines Inc.   
#&gt;  7  2013     1     1     6 EWR    FLL   N516JB  B6      JetBlue Airways         
#&gt;  8  2013     1     1     6 LGA    IAD   N829AS  EV      ExpressJet Airlines Inc.
#&gt;  9  2013     1     1     6 JFK    MCO   N593JB  B6      JetBlue Airways         
#&gt; 10  2013     1     1     6 LGA    ORD   N3ALAA  AA      American Airlines Inc.  
#&gt; # ... with 336,766 more rows</code></pre>
<p><strong>Ok, let’s create a few tables to see joins in action.</strong></p>
<pre class="r"><code>x &lt;- tribble(
  ~key, ~val_x,
  1,    &quot;x1&quot;,
  2,    &quot;x2&quot;,
  3,    &quot;x3&quot;
)

y &lt;- tribble(
  ~key, ~val_x,
  1,    &quot;y1&quot;,
  2,    &quot;y2&quot;,
  4,    &quot;y3&quot;
)</code></pre>
<div id="inner-join" class="section level3">
<h3>Inner Join</h3>
<ul>
<li>Only joins wherever <span style="color: #008080;background-color:#9FDDBA">keys are equivalent</span> (i.e. the key must be present in both tables).</li>
<li>Unmatched rows are <strong>not</strong> included in the result.</li>
<li>I.e. we <strong>lose</strong> observations.</li>
</ul>
<pre><code class='language-r'><code>x %>% <br>&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>inner_join</span>(y, by = "key")<br>#> # A tibble: 2 x 3<br>#> &nbsp;&nbsp;&nbsp;&nbsp;key val_x.x val_x.y<br>#> &nbsp;&nbsp;<dbl> <chr> &nbsp;&nbsp;<chr> &nbsp;<br>#> 1 &nbsp;&nbsp;&nbsp;&nbsp;1 x1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1 &nbsp;&nbsp;&nbsp;&nbsp;<br>#> 2 &nbsp;&nbsp;&nbsp;&nbsp;2 x2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y2</code></code></pre>
<p><em>Observation</em>: key = 3 in table x is not kept, and key = 4 in table y also falls away.</p>
</div>
<div id="outer-joins" class="section level3">
<h3>Outer Joins</h3>
<ul>
<li><code>Left join</code> keeps all observations in x.</li>
<li><code>Right join</code> keeps all observations in y.</li>
<li><code>Full join</code> keeps all observations in x and y.</li>
<li>Observations from <strong>at least</strong> one table is kept.</li>
<li>The most commonly used join is the <strong>left join</strong>. It looks up additional data from another table, and it preserves the original observations even when there isn’t a match.</li>
</ul>
<figure>
<p><img src="assets/join-outer.PNG" width="350" height="500" alt="Outer Join"></p>
<figcaption>
Outer Joins
</figcaption>
</figure>
<p><br></p>
<div id="left-join" class="section level4">
<h4>Left Join</h4>
<pre><code class='language-r'><code>x %>% <br>&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>left_join</span>(y, by = "key")<br>#> # A tibble: 3 x 3<br>#> &nbsp;&nbsp;&nbsp;&nbsp;key val_x.x val_x.y<br>#> &nbsp;&nbsp;<dbl> <chr> &nbsp;&nbsp;<chr> &nbsp;<br>#> 1 &nbsp;&nbsp;&nbsp;&nbsp;1 x1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1 &nbsp;&nbsp;&nbsp;&nbsp;<br>#> 2 &nbsp;&nbsp;&nbsp;&nbsp;2 x2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y2 &nbsp;&nbsp;&nbsp;&nbsp;<br>#> 3 &nbsp;&nbsp;&nbsp;&nbsp;3 x3 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<NA></code></code></pre>
</div>
<div id="right-join" class="section level4">
<h4>Right Join</h4>
<pre><code class='language-r'><code>x %>% <br>&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>right_join</span>(y, by = "key")<br>#> # A tibble: 3 x 3<br>#> &nbsp;&nbsp;&nbsp;&nbsp;key val_x.x val_x.y<br>#> &nbsp;&nbsp;<dbl> <chr> &nbsp;&nbsp;<chr> &nbsp;<br>#> 1 &nbsp;&nbsp;&nbsp;&nbsp;1 x1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1 &nbsp;&nbsp;&nbsp;&nbsp;<br>#> 2 &nbsp;&nbsp;&nbsp;&nbsp;2 x2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y2 &nbsp;&nbsp;&nbsp;&nbsp;<br>#> 3 &nbsp;&nbsp;&nbsp;&nbsp;4 <NA> &nbsp;&nbsp;&nbsp;y3</code></code></pre>
</div>
<div id="full-join" class="section level4">
<h4>Full Join</h4>
<pre><code class='language-r'><code>x %>% <br>&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>full_join</span>(y, by = "key")<br>#> # A tibble: 4 x 3<br>#> &nbsp;&nbsp;&nbsp;&nbsp;key val_x.x val_x.y<br>#> &nbsp;&nbsp;<dbl> <chr> &nbsp;&nbsp;<chr> &nbsp;<br>#> 1 &nbsp;&nbsp;&nbsp;&nbsp;1 x1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1 &nbsp;&nbsp;&nbsp;&nbsp;<br>#> 2 &nbsp;&nbsp;&nbsp;&nbsp;2 x2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y2 &nbsp;&nbsp;&nbsp;&nbsp;<br>#> 3 &nbsp;&nbsp;&nbsp;&nbsp;3 x3 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<NA> &nbsp;&nbsp;<br>#> 4 &nbsp;&nbsp;&nbsp;&nbsp;4 <NA> &nbsp;&nbsp;&nbsp;y3</code></code></pre>
</div>
</div>
<div id="duplicate-keys" class="section level3">
<h3>Duplicate Keys</h3>
<p>Sometimes the keys are not unique.</p>
<ol style="list-style-type: decimal">
<li><p>One table has duplicate keys - there is typically a one-to-many relationship.</p>
<figure>
<p><img src="assets/join-one-to-many.PNG" width="300" height="150" alt="One to many"></p>
<figcaption>
<p><span style="color: #6d6875;background-color:#e5989b">One to many</span></p>
</figcaption>
</figure>
<p><br></p>
<pre><code class='language-r'><code>x <- tribble(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~key, ~val_x,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1, &nbsp;&nbsp;&nbsp;"x1",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2, &nbsp;&nbsp;&nbsp;"x2",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2, &nbsp;&nbsp;&nbsp;"x3",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1, &nbsp;&nbsp;&nbsp;"x4"<br>&nbsp;&nbsp;&nbsp;&nbsp;)<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;y <- tribble(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~key, ~val_y,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1, &nbsp;&nbsp;&nbsp;"y1",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2, &nbsp;&nbsp;&nbsp;"y2"<br>&nbsp;&nbsp;&nbsp;&nbsp;)<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>left_join</span>(x, y, by = "key")<br>&nbsp;&nbsp;&nbsp;&nbsp;#> # A tibble: 4 x 3<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;&nbsp;&nbsp;&nbsp;key val_x val_y<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;&nbsp;<dbl> <chr> <chr><br>&nbsp;&nbsp;&nbsp;&nbsp;#> 1 &nbsp;&nbsp;&nbsp;&nbsp;1 x1 &nbsp;&nbsp;&nbsp;y1 &nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> 2 &nbsp;&nbsp;&nbsp;&nbsp;2 x2 &nbsp;&nbsp;&nbsp;y2 &nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> 3 &nbsp;&nbsp;&nbsp;&nbsp;2 x3 &nbsp;&nbsp;&nbsp;y2 &nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> 4 &nbsp;&nbsp;&nbsp;&nbsp;1 x4 &nbsp;&nbsp;&nbsp;y1</code></code></pre>
<p>Notice that:</p>
<ul>
<li>The result has <em>two</em> <code>key == 1</code>, and <em>two</em> <code>key == 2</code>.</li>
<li>I.e. the observations from <code>x</code>, the <code>left table</code>, is preserved.</li>
</ul></li>
<li><p>Both tables have duplicate keys. When you join tables with duplicated keys, you get all possible combinations, called the <span style="color: #008080;background-color:#9FDDBA">Cartesian product</span>.</p>
<pre><code> &lt;figure&gt;</code></pre>
<p><img src="assets/join-many-to-many.PNG" width="480" height="300" alt="Many to many"></p>
<figcaption>
<p><span style="color: #6d6875;background-color:#e5989b">Many to many</span></p>
</figcaption>
</figure>
<p><br></p>
<pre class="r"><code>x &lt;- tribble(
  ~key, ~val_x,
     1,  &quot;x1&quot;,
     2,  &quot;x2&quot;,
     2,  &quot;x3&quot;,
     1,  &quot;x4&quot;
)

y &lt;- tribble(
  ~key, ~val_y,
     1, &quot;y1&quot;,
     2, &quot;y2&quot;,
     2, &quot;y3&quot;,
     3, &quot;y4&quot;
)

left_join(x, y, by = &quot;key&quot;)
#&gt; # A tibble: 6 x 3
#&gt;     key val_x val_y
#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
#&gt; 1     1 x1    y1   
#&gt; 2     2 x2    y2   
#&gt; 3     2 x2    y3   
#&gt; 4     2 x3    y2   
#&gt; 5     2 x3    y3   
#&gt; 6     1 x4    y1</code></pre>
<p>Notice that we have <em>two</em> <code>key == 2</code> in table <code>x</code> and <em>two</em> <code>key == 2</code> in table <code>y</code>. That means that both the <code>key == 2</code> in <code>x</code> matches both the <code>key == 2</code> in <code>y</code> resulting in <strong>4</strong> entries in the resulting table.</p></li>
</ol>
<h2>
Defining Key Columns
</h2>
</div>
</div>
<div id="defining-key-columns" class="section level2">
<h2>Defining Key Columns</h2>
<p>We’ve been lucky so far that the <strong>key</strong> column in both tables we are joining is called <em>key</em>. That’s not usually the case, and tables often have composite keys (keys made up of several columns).</p>
<ul>
<li><p>The default joining happens using <span style="color: #008080;background-color:#9FDDBA"><code>by = NULL</code></span>, which uses all variables that appear in both tables. For example, the flights and weather tables match on their common variables: <code>year</code>, <code>month</code>, <code>day</code>, <code>hour</code> and <code>origin</code>.</p>
<pre class="r"><code>flights2 %&gt;% 
  left_join(weather)
#&gt; Joining, by = c(&quot;year&quot;, &quot;month&quot;, &quot;day&quot;, &quot;hour&quot;, &quot;origin&quot;)
#&gt; # A tibble: 336,776 x 18
#&gt;     year month   day  hour origin dest  tailnum carrier  temp  dewp humid
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt;  1  2013     1     1     5 EWR    IAH   N14228  UA       39.0  28.0  64.4
#&gt;  2  2013     1     1     5 LGA    IAH   N24211  UA       39.9  25.0  54.8
#&gt;  3  2013     1     1     5 JFK    MIA   N619AA  AA       39.0  27.0  61.6
#&gt;  4  2013     1     1     5 JFK    BQN   N804JB  B6       39.0  27.0  61.6
#&gt;  5  2013     1     1     6 LGA    ATL   N668DN  DL       39.9  25.0  54.8
#&gt;  6  2013     1     1     5 EWR    ORD   N39463  UA       39.0  28.0  64.4
#&gt;  7  2013     1     1     6 EWR    FLL   N516JB  B6       37.9  28.0  67.2
#&gt;  8  2013     1     1     6 LGA    IAD   N829AS  EV       39.9  25.0  54.8
#&gt;  9  2013     1     1     6 JFK    MCO   N593JB  B6       37.9  27.0  64.3
#&gt; 10  2013     1     1     6 LGA    ORD   N3ALAA  AA       39.9  25.0  54.8
#&gt; # ... with 336,766 more rows, and 7 more variables: wind_dir &lt;dbl&gt;,
#&gt; #   wind_speed &lt;dbl&gt;, wind_gust &lt;dbl&gt;, precip &lt;dbl&gt;, pressure &lt;dbl&gt;,
#&gt; #   visib &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre></li>
<li><p><span style="color: #008080;background-color:#9FDDBA">A character vector</span> as we have been using thus far, <span style="color: #008080;background-color:#9FDDBA"><code>by = "x"</code></span>. This uses some of the common variables. For example, <code>flights</code> and <code>planes</code> have <code>year</code> variables, but they mean different things so we only want to join by <code>tailnum</code>. The variable which is named the same <code>year</code> but which mean completely different things in each table, is uniquely named in the output by adding a <code>.x</code> and <code>.y</code> at the end of its name.</p>
<pre class="r"><code>flights2 %&gt;% 
  left_join(planes, by = &quot;tailnum&quot;) %&gt;% 
  print(width = Inf)
#&gt; # A tibble: 336,776 x 16
#&gt;    year.x month   day  hour origin dest  tailnum carrier year.y
#&gt;     &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;int&gt;
#&gt;  1   2013     1     1     5 EWR    IAH   N14228  UA        1999
#&gt;  2   2013     1     1     5 LGA    IAH   N24211  UA        1998
#&gt;  3   2013     1     1     5 JFK    MIA   N619AA  AA        1990
#&gt;  4   2013     1     1     5 JFK    BQN   N804JB  B6        2012
#&gt;  5   2013     1     1     6 LGA    ATL   N668DN  DL        1991
#&gt;  6   2013     1     1     5 EWR    ORD   N39463  UA        2012
#&gt;  7   2013     1     1     6 EWR    FLL   N516JB  B6        2000
#&gt;  8   2013     1     1     6 LGA    IAD   N829AS  EV        1998
#&gt;  9   2013     1     1     6 JFK    MCO   N593JB  B6        2004
#&gt; 10   2013     1     1     6 LGA    ORD   N3ALAA  AA          NA
#&gt;    type                    manufacturer     model       engines seats speed
#&gt;    &lt;chr&gt;                   &lt;chr&gt;            &lt;chr&gt;         &lt;int&gt; &lt;int&gt; &lt;int&gt;
#&gt;  1 Fixed wing multi engine BOEING           737-824           2   149    NA
#&gt;  2 Fixed wing multi engine BOEING           737-824           2   149    NA
#&gt;  3 Fixed wing multi engine BOEING           757-223           2   178    NA
#&gt;  4 Fixed wing multi engine AIRBUS           A320-232          2   200    NA
#&gt;  5 Fixed wing multi engine BOEING           757-232           2   178    NA
#&gt;  6 Fixed wing multi engine BOEING           737-924ER         2   191    NA
#&gt;  7 Fixed wing multi engine AIRBUS INDUSTRIE A320-232          2   200    NA
#&gt;  8 Fixed wing multi engine CANADAIR         CL-600-2B19       2    55    NA
#&gt;  9 Fixed wing multi engine AIRBUS           A320-232          2   200    NA
#&gt; 10 &lt;NA&gt;                    &lt;NA&gt;             &lt;NA&gt;             NA    NA    NA
#&gt;    engine   
#&gt;    &lt;chr&gt;    
#&gt;  1 Turbo-fan
#&gt;  2 Turbo-fan
#&gt;  3 Turbo-fan
#&gt;  4 Turbo-fan
#&gt;  5 Turbo-fan
#&gt;  6 Turbo-fan
#&gt;  7 Turbo-fan
#&gt;  8 Turbo-fan
#&gt;  9 Turbo-fan
#&gt; 10 &lt;NA&gt;     
#&gt; # ... with 336,766 more rows</code></pre></li>
<li><p>A <span style="color: #008080;background-color:#9FDDBA">named character vector</span>: <code>by = c("a" = "b")</code>. This will match variable <code>a</code> in table <code>x</code> to variable <code>b</code> in table <code>y</code>.</p>
<p>For example, to draw a map we need to combine the flights data with the airports data which contains the geographical coordinates (<code>lat</code> and <code>lon</code>) of the airport. Each flight has an origin and destination <code>airport</code>, so we need to specify which one we want to join to.</p>
<pre><code class='language-r'><code>flights2 %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;left_join(airports, <span style='background-color:#9FDDBA;color:#008080'>c('dest' = 'faa')</span>) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(width = Inf)<br>&nbsp;&nbsp;&nbsp;&nbsp;#> # A tibble: 336,776 x 15<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;&nbsp;&nbsp;&nbsp;year month &nbsp;&nbsp;day &nbsp;hour origin dest &nbsp;tailnum carrier<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;&nbsp;&nbsp;<int> <int> <int> <dbl> <chr> &nbsp;<chr> <chr> &nbsp;&nbsp;<chr> &nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;1 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;5 EWR &nbsp;&nbsp;&nbsp;IAH &nbsp;&nbsp;N14228 &nbsp;UA &nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;2 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;5 LGA &nbsp;&nbsp;&nbsp;IAH &nbsp;&nbsp;N24211 &nbsp;UA &nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;3 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;5 JFK &nbsp;&nbsp;&nbsp;MIA &nbsp;&nbsp;N619AA &nbsp;AA &nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;4 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;5 JFK &nbsp;&nbsp;&nbsp;BQN &nbsp;&nbsp;N804JB &nbsp;B6 &nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;5 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;6 LGA &nbsp;&nbsp;&nbsp;ATL &nbsp;&nbsp;N668DN &nbsp;DL &nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;6 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;5 EWR &nbsp;&nbsp;&nbsp;ORD &nbsp;&nbsp;N39463 &nbsp;UA &nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;7 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;6 EWR &nbsp;&nbsp;&nbsp;FLL &nbsp;&nbsp;N516JB &nbsp;B6 &nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;8 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;6 LGA &nbsp;&nbsp;&nbsp;IAD &nbsp;&nbsp;N829AS &nbsp;EV &nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;9 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;6 JFK &nbsp;&nbsp;&nbsp;MCO &nbsp;&nbsp;N593JB &nbsp;B6 &nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> 10 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;6 LGA &nbsp;&nbsp;&nbsp;ORD &nbsp;&nbsp;N3ALAA &nbsp;AA &nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;&nbsp;&nbsp;name &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lat &nbsp;&nbsp;lon &nbsp;&nbsp;alt &nbsp;&nbsp;&nbsp;tz dst &nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;&nbsp;&nbsp;<chr> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<dbl> <dbl> <dbl> <dbl> <chr><br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;1 George Bush Intercontinental &nbsp;&nbsp;&nbsp;&nbsp;30.0 -95.3 &nbsp;&nbsp;&nbsp;97 &nbsp;&nbsp;&nbsp;-6 A &nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;2 George Bush Intercontinental &nbsp;&nbsp;&nbsp;&nbsp;30.0 -95.3 &nbsp;&nbsp;&nbsp;97 &nbsp;&nbsp;&nbsp;-6 A &nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;3 Miami Intl &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;25.8 -80.3 &nbsp;&nbsp;&nbsp;&nbsp;8 &nbsp;&nbsp;&nbsp;-5 A &nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;4 <NA> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA &nbsp;&nbsp;&nbsp;NA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NA &nbsp;&nbsp;&nbsp;NA <NA> <br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;5 Hartsfield Jackson Atlanta Intl &nbsp;33.6 -84.4 &nbsp;1026 &nbsp;&nbsp;&nbsp;-5 A &nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;6 Chicago Ohare Intl &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;42.0 -87.9 &nbsp;&nbsp;668 &nbsp;&nbsp;&nbsp;-6 A &nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;7 Fort Lauderdale Hollywood Intl &nbsp;&nbsp;26.1 -80.2 &nbsp;&nbsp;&nbsp;&nbsp;9 &nbsp;&nbsp;&nbsp;-5 A &nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;8 Washington Dulles Intl &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;38.9 -77.5 &nbsp;&nbsp;313 &nbsp;&nbsp;&nbsp;-5 A &nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;9 Orlando Intl &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;28.4 -81.3 &nbsp;&nbsp;&nbsp;96 &nbsp;&nbsp;&nbsp;-5 A &nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> 10 Chicago Ohare Intl &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;42.0 -87.9 &nbsp;&nbsp;668 &nbsp;&nbsp;&nbsp;-6 A &nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;&nbsp;&nbsp;tzone &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;&nbsp;&nbsp;<chr> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;1 America/Chicago <br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;2 America/Chicago <br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;3 America/New_York<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;4 <NA> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;5 America/New_York<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;6 America/Chicago <br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;7 America/New_York<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;8 America/New_York<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;9 America/New_York<br>&nbsp;&nbsp;&nbsp;&nbsp;#> 10 America/Chicago <br>&nbsp;&nbsp;&nbsp;&nbsp;#> # ... with 336,766 more rows<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;flights2 %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;left_join(airports, <span style='background-color:#9FDDBA;color:#008080'>c('origin' = 'faa')</span>) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(width = Inf)<br>&nbsp;&nbsp;&nbsp;&nbsp;#> # A tibble: 336,776 x 15<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;&nbsp;&nbsp;&nbsp;year month &nbsp;&nbsp;day &nbsp;hour origin dest &nbsp;tailnum carrier name &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;&nbsp;&nbsp;<int> <int> <int> <dbl> <chr> &nbsp;<chr> <chr> &nbsp;&nbsp;<chr> &nbsp;&nbsp;<chr> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;1 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;5 EWR &nbsp;&nbsp;&nbsp;IAH &nbsp;&nbsp;N14228 &nbsp;UA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Newark Liberty Intl<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;2 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;5 LGA &nbsp;&nbsp;&nbsp;IAH &nbsp;&nbsp;N24211 &nbsp;UA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;La Guardia &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;3 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;5 JFK &nbsp;&nbsp;&nbsp;MIA &nbsp;&nbsp;N619AA &nbsp;AA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;John F Kennedy Intl<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;4 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;5 JFK &nbsp;&nbsp;&nbsp;BQN &nbsp;&nbsp;N804JB &nbsp;B6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;John F Kennedy Intl<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;5 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;6 LGA &nbsp;&nbsp;&nbsp;ATL &nbsp;&nbsp;N668DN &nbsp;DL &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;La Guardia &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;6 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;5 EWR &nbsp;&nbsp;&nbsp;ORD &nbsp;&nbsp;N39463 &nbsp;UA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Newark Liberty Intl<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;7 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;6 EWR &nbsp;&nbsp;&nbsp;FLL &nbsp;&nbsp;N516JB &nbsp;B6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Newark Liberty Intl<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;8 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;6 LGA &nbsp;&nbsp;&nbsp;IAD &nbsp;&nbsp;N829AS &nbsp;EV &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;La Guardia &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;9 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;6 JFK &nbsp;&nbsp;&nbsp;MCO &nbsp;&nbsp;N593JB &nbsp;B6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;John F Kennedy Intl<br>&nbsp;&nbsp;&nbsp;&nbsp;#> 10 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;6 LGA &nbsp;&nbsp;&nbsp;ORD &nbsp;&nbsp;N3ALAA &nbsp;AA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;La Guardia &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lat &nbsp;&nbsp;lon &nbsp;&nbsp;alt &nbsp;&nbsp;&nbsp;tz dst &nbsp;&nbsp;tzone &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;&nbsp;&nbsp;<dbl> <dbl> <dbl> <dbl> <chr> <chr> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;1 &nbsp;40.7 -74.2 &nbsp;&nbsp;&nbsp;18 &nbsp;&nbsp;&nbsp;-5 A &nbsp;&nbsp;&nbsp;&nbsp;America/New_York<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;2 &nbsp;40.8 -73.9 &nbsp;&nbsp;&nbsp;22 &nbsp;&nbsp;&nbsp;-5 A &nbsp;&nbsp;&nbsp;&nbsp;America/New_York<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;3 &nbsp;40.6 -73.8 &nbsp;&nbsp;&nbsp;13 &nbsp;&nbsp;&nbsp;-5 A &nbsp;&nbsp;&nbsp;&nbsp;America/New_York<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;4 &nbsp;40.6 -73.8 &nbsp;&nbsp;&nbsp;13 &nbsp;&nbsp;&nbsp;-5 A &nbsp;&nbsp;&nbsp;&nbsp;America/New_York<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;5 &nbsp;40.8 -73.9 &nbsp;&nbsp;&nbsp;22 &nbsp;&nbsp;&nbsp;-5 A &nbsp;&nbsp;&nbsp;&nbsp;America/New_York<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;6 &nbsp;40.7 -74.2 &nbsp;&nbsp;&nbsp;18 &nbsp;&nbsp;&nbsp;-5 A &nbsp;&nbsp;&nbsp;&nbsp;America/New_York<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;7 &nbsp;40.7 -74.2 &nbsp;&nbsp;&nbsp;18 &nbsp;&nbsp;&nbsp;-5 A &nbsp;&nbsp;&nbsp;&nbsp;America/New_York<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;8 &nbsp;40.8 -73.9 &nbsp;&nbsp;&nbsp;22 &nbsp;&nbsp;&nbsp;-5 A &nbsp;&nbsp;&nbsp;&nbsp;America/New_York<br>&nbsp;&nbsp;&nbsp;&nbsp;#> &nbsp;9 &nbsp;40.6 -73.8 &nbsp;&nbsp;&nbsp;13 &nbsp;&nbsp;&nbsp;-5 A &nbsp;&nbsp;&nbsp;&nbsp;America/New_York<br>&nbsp;&nbsp;&nbsp;&nbsp;#> 10 &nbsp;40.8 -73.9 &nbsp;&nbsp;&nbsp;22 &nbsp;&nbsp;&nbsp;-5 A &nbsp;&nbsp;&nbsp;&nbsp;America/New_York<br>&nbsp;&nbsp;&nbsp;&nbsp;#> # ... with 336,766 more rows</code></code></pre></li>
</ul>
<div id="exercises-2" class="section level3">
<h3>Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Compute the average delay by destination, then join on the <code>airports</code> data frame so you can show the spatial distribution of delays. Here’s an easy way to draw a map of the United States:</p>
<pre class="r"><code>airports %&gt;%
  semi_join(flights, c(&quot;faa&quot; = &quot;dest&quot;)) %&gt;%
  ggplot(aes(lon, lat)) +
    borders(&quot;state&quot;) +
    geom_point() +
    coord_quickmap()</code></pre>
<p>(Don’t worry if you don’t understand what <code>semi_join()</code> does — you’ll learn about it next.)</p>
<p>You might want to use the <code>size</code> or <code>colour</code> of the points to display the average delay for each airport.</p>
<pre class="r"><code>flights %&gt;% 
  group_by(dest) %&gt;% 
  summarise(mean_delay = mean(arr_delay, na.rm = TRUE)) %&gt;% 
  inner_join(airports, c(&quot;dest&quot; = &quot;faa&quot;)) %&gt;% 
  ggplot(aes(lon, lat, colour = mean_delay)) +
    borders(&quot;state&quot;) +
    geom_point() +
    coord_quickmap() +
    scale_colour_viridis_b()</code></pre>
<p><img src="figure/ch10_relations_dplyr.Rmd/unnamed-chunk-35-1.png" width="672" style="display: block; margin: auto;" /></p></li>
<li><p>Add the location of the origin <em>and</em> destination (i.e. the <code>lat</code> and <code>lon</code>) to <code>flights</code>.</p>
<pre class="r"><code>flights %&gt;% 
  left_join(airports, by = c(&quot;origin&quot; = &quot;faa&quot;)) %&gt;% 
  left_join(airports, by = c(&quot;dest&quot; = &quot;faa&quot;)) %&gt;% 
  print(width = Inf)
#&gt; # A tibble: 336,776 x 33
#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
#&gt;  1  2013     1     1      517            515         2      830            819
#&gt;  2  2013     1     1      533            529         4      850            830
#&gt;  3  2013     1     1      542            540         2      923            850
#&gt;  4  2013     1     1      544            545        -1     1004           1022
#&gt;  5  2013     1     1      554            600        -6      812            837
#&gt;  6  2013     1     1      554            558        -4      740            728
#&gt;  7  2013     1     1      555            600        -5      913            854
#&gt;  8  2013     1     1      557            600        -3      709            723
#&gt;  9  2013     1     1      557            600        -3      838            846
#&gt; 10  2013     1     1      558            600        -2      753            745
#&gt;    arr_delay carrier flight tailnum origin dest  air_time distance  hour minute
#&gt;        &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
#&gt;  1        11 UA        1545 N14228  EWR    IAH        227     1400     5     15
#&gt;  2        20 UA        1714 N24211  LGA    IAH        227     1416     5     29
#&gt;  3        33 AA        1141 N619AA  JFK    MIA        160     1089     5     40
#&gt;  4       -18 B6         725 N804JB  JFK    BQN        183     1576     5     45
#&gt;  5       -25 DL         461 N668DN  LGA    ATL        116      762     6      0
#&gt;  6        12 UA        1696 N39463  EWR    ORD        150      719     5     58
#&gt;  7        19 B6         507 N516JB  EWR    FLL        158     1065     6      0
#&gt;  8       -14 EV        5708 N829AS  LGA    IAD         53      229     6      0
#&gt;  9        -8 B6          79 N593JB  JFK    MCO        140      944     6      0
#&gt; 10         8 AA         301 N3ALAA  LGA    ORD        138      733     6      0
#&gt;    time_hour           name.x              lat.x lon.x alt.x  tz.x dst.x
#&gt;    &lt;dttm&gt;              &lt;chr&gt;               &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
#&gt;  1 2013-01-01 05:00:00 Newark Liberty Intl  40.7 -74.2    18    -5 A    
#&gt;  2 2013-01-01 05:00:00 La Guardia           40.8 -73.9    22    -5 A    
#&gt;  3 2013-01-01 05:00:00 John F Kennedy Intl  40.6 -73.8    13    -5 A    
#&gt;  4 2013-01-01 05:00:00 John F Kennedy Intl  40.6 -73.8    13    -5 A    
#&gt;  5 2013-01-01 06:00:00 La Guardia           40.8 -73.9    22    -5 A    
#&gt;  6 2013-01-01 05:00:00 Newark Liberty Intl  40.7 -74.2    18    -5 A    
#&gt;  7 2013-01-01 06:00:00 Newark Liberty Intl  40.7 -74.2    18    -5 A    
#&gt;  8 2013-01-01 06:00:00 La Guardia           40.8 -73.9    22    -5 A    
#&gt;  9 2013-01-01 06:00:00 John F Kennedy Intl  40.6 -73.8    13    -5 A    
#&gt; 10 2013-01-01 06:00:00 La Guardia           40.8 -73.9    22    -5 A    
#&gt;    tzone.x          name.y                          lat.y lon.y alt.y  tz.y
#&gt;    &lt;chr&gt;            &lt;chr&gt;                           &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt;  1 America/New_York George Bush Intercontinental     30.0 -95.3    97    -6
#&gt;  2 America/New_York George Bush Intercontinental     30.0 -95.3    97    -6
#&gt;  3 America/New_York Miami Intl                       25.8 -80.3     8    -5
#&gt;  4 America/New_York &lt;NA&gt;                             NA    NA      NA    NA
#&gt;  5 America/New_York Hartsfield Jackson Atlanta Intl  33.6 -84.4  1026    -5
#&gt;  6 America/New_York Chicago Ohare Intl               42.0 -87.9   668    -6
#&gt;  7 America/New_York Fort Lauderdale Hollywood Intl   26.1 -80.2     9    -5
#&gt;  8 America/New_York Washington Dulles Intl           38.9 -77.5   313    -5
#&gt;  9 America/New_York Orlando Intl                     28.4 -81.3    96    -5
#&gt; 10 America/New_York Chicago Ohare Intl               42.0 -87.9   668    -6
#&gt;    dst.y tzone.y         
#&gt;    &lt;chr&gt; &lt;chr&gt;           
#&gt;  1 A     America/Chicago 
#&gt;  2 A     America/Chicago 
#&gt;  3 A     America/New_York
#&gt;  4 &lt;NA&gt;  &lt;NA&gt;            
#&gt;  5 A     America/New_York
#&gt;  6 A     America/Chicago 
#&gt;  7 A     America/New_York
#&gt;  8 A     America/New_York
#&gt;  9 A     America/New_York
#&gt; 10 A     America/Chicago 
#&gt; # ... with 336,766 more rows</code></pre></li>
<li><p>Is there a relationship between the age of a plane and its delays?</p>
<p>Let’s have a look at the total delay, i.e. considering the departure and arrival delays.</p>
<pre class="r"><code>(flights_sub &lt;- flights %&gt;% 
   # get subset of fields
   select(year:day, dep_delay, arr_delay, origin, dest,
          tailnum))
#&gt; # A tibble: 336,776 x 8
#&gt;     year month   day dep_delay arr_delay origin dest  tailnum
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  
#&gt;  1  2013     1     1         2        11 EWR    IAH   N14228 
#&gt;  2  2013     1     1         4        20 LGA    IAH   N24211 
#&gt;  3  2013     1     1         2        33 JFK    MIA   N619AA 
#&gt;  4  2013     1     1        -1       -18 JFK    BQN   N804JB 
#&gt;  5  2013     1     1        -6       -25 LGA    ATL   N668DN 
#&gt;  6  2013     1     1        -4        12 EWR    ORD   N39463 
#&gt;  7  2013     1     1        -5        19 EWR    FLL   N516JB 
#&gt;  8  2013     1     1        -3       -14 LGA    IAD   N829AS 
#&gt;  9  2013     1     1        -3        -8 JFK    MCO   N593JB 
#&gt; 10  2013     1     1        -2         8 LGA    ORD   N3ALAA 
#&gt; # ... with 336,766 more rows

flights_sub %&gt;% 
  # join on tailnum
  inner_join(planes, by = (&quot;tailnum&quot; = &quot;tailnum&quot;)) %&gt;% 
  # subset data again from the planes tbl
  select(dep_delay, arr_delay, origin, dest,
         tailnum, year.x, year.y,type, manufacturer) %&gt;% 
  # need stats for a plane, so group by tailnum the
  # unique id for a plane
  group_by(tailnum) %&gt;% 
  # add variables to calc age of plane
  # and various delay stats
  mutate(age_plane_in_2013 = year.x - year.y,
         mean_dep_delay = mean(dep_delay, na.rm = TRUE),
         mean_arr_delay = mean(arr_delay, na.rm = TRUE),
         tot_delay = mean_dep_delay + mean_arr_delay) %&gt;% 
  # we only care about planes where delay exists
  # and where we know the planes age
  filter(tot_delay &gt; 0,
         age_plane_in_2013 &gt; 0) %&gt;% 
  select(tailnum, year = year.y, age_plane_in_2013, type, manufacturer,
         mean_dep_delay, mean_arr_delay, tot_delay) %&gt;% 
  ungroup() %&gt;% 
  distinct() %&gt;% 
  ggplot(aes(x = age_plane_in_2013, y = tot_delay)) +
  geom_col()</code></pre>
<p><img src="figure/ch10_relations_dplyr.Rmd/unnamed-chunk-37-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The planes delay increases as the plane ages, but starts decreasing around age = 12, and drops further past that age. Perhaps the maintenance cycle gets more rigourous as the plane ages? 🤷</p></li>
<li><p>What weather conditions make it more likely to see a delay?</p>
<pre class="r"><code>
flights %&gt;% 
  select(&quot;year&quot;, &quot;month&quot;, &quot;day&quot;, &quot;origin&quot;, &quot;hour&quot;, &quot;time_hour&quot;,
         &quot;dep_delay&quot;) %&gt;% 
  inner_join(weather) %&gt;% 
  group_by(origin, year, month, day, hour) %&gt;% 
  mutate(avg_dep_delay = mean(dep_delay, na.rm = TRUE)) %&gt;% 
  ungroup() %&gt;% 
  filter(avg_dep_delay &gt; 0) %&gt;% 
  select(&quot;year&quot;, &quot;month&quot;, &quot;day&quot;, &quot;origin&quot;, &quot;hour&quot;, 
         &quot;avg_dep_delay&quot;, &quot;temp&quot;:&quot;visib&quot;) %&gt;% 
  distinct() %&gt;% 
  arrange(-avg_dep_delay) %&gt;% 
  # slice_head(n = 10) %&gt;% 
  # print(width = Inf) %&gt;% 
  pivot_longer(cols = &quot;temp&quot;:&quot;visib&quot;,
               names_to = &quot;type&quot;,
               values_to = &quot;measure&quot;) %&gt;% 
  ggplot(aes(y = avg_dep_delay, x = measure)) +
  geom_point(alpha = 0.1) +
  facet_wrap(~ type, scales = &quot;free_x&quot;) </code></pre>
<p><img src="figure/ch10_relations_dplyr.Rmd/unnamed-chunk-38-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>It seems that the higher the dewp and humidity (and to some degree temp) the higher the delay. The visibility in miles also seems to increase the departure delay.</p>
<p>The precipitation seems to decrease the delay which is a bit strange for me, I was under the impression that would lead to longer delays.</p></li>
<li><p>What happened on June 13 2013? Display the spatial pattern of delays, and then use Google to cross-reference with the weather.</p>
<pre class="r"><code>worst &lt;- filter(flights, !is.na(dep_time), month == 6, day == 13)
worst %&gt;%
  group_by(dest) %&gt;%
  summarise(delay = mean(arr_delay), n = n()) %&gt;%
  filter(n &gt; 5) %&gt;%
  inner_join(airports, by = c(&quot;dest&quot; = &quot;faa&quot;)) %&gt;%
  ggplot(aes(lon, lat)) +
    borders(&quot;state&quot;) +
    geom_point(aes(size = n, colour = delay)) +
    coord_quickmap()</code></pre>
<p><img src="figure/ch10_relations_dplyr.Rmd/unnamed-chunk-39-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>It seems there was <a href="https://www.washingtonpost.com/news/capital-weather-gang/wp/2013/06/14/june-13-2013-severe-weather-hypestorm-or-the-real-deal/">intense storms</a> on June 13th, 2013.</p></li>
</ol>
</div>
<div id="other-ways" class="section level3">
<h3>Other ways</h3>
<p><code>base::merge()</code> can perform all four types of mutating join:</p>
<table>
<thead>
<tr class="header">
<th>dplyr</th>
<th>merge</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>inner_join(x, y)</code></td>
<td><code>merge(x, y)</code></td>
</tr>
<tr class="even">
<td><code>left_join(x, y)</code></td>
<td><code>merge(x, y, all.x = TRUE)</code></td>
</tr>
<tr class="odd">
<td><code>right_join(x, y)</code></td>
<td><code>merge(x, y, all.y = TRUE)</code>,</td>
</tr>
<tr class="even">
<td><code>full_join(x, y)</code></td>
<td><code>merge(x, y, all.x = TRUE, all.y = TRUE)</code></td>
</tr>
</tbody>
</table>
<p>Pros for {dplyr}:</p>
<ul>
<li>Easier to understand what the code is doing,</li>
<li>Translates better to SQL (which is a language by the way, and not an acronym - found out from <code>SQL: Visual QuickStart Guide, by Chris Fehily</code>,</li>
<li>Is <em>faster</em>, and</li>
<li>Does not mess with row order.</li>
</ul>
<p>SQL translation</p>
<table>
<thead>
<tr class="header">
<th>dplyr</th>
<th>SQL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>inner_join(x, y, by = "z")</code></td>
<td><code>SELECT * FROM x INNER JOIN y USING (z)</code></td>
</tr>
<tr class="even">
<td><code>left_join(x, y, by = "z")</code></td>
<td><code>SELECT * FROM x LEFT OUTER JOIN y USING (z)</code></td>
</tr>
<tr class="odd">
<td><code>right_join(x, y, by = "z")</code></td>
<td><code>SELECT * FROM x RIGHT OUTER JOIN y USING (z)</code></td>
</tr>
<tr class="even">
<td><code>full_join(x, y, by = "z")</code></td>
<td><code>SELECT * FROM x FULL OUTER JOIN y USING (z)</code></td>
</tr>
</tbody>
</table>
<p>Joining different variables between the tables, e.g. <code>inner_join(x, y, by = c("a" = "b"))</code> uses a slightly different syntax in SQL: <span style="color: #008080;background-color:#9FDDBA"><code>SELECT * FROM x INNER JOIN y ON x.a = y.b</code></span>.</p>
<h2>
Filtering Joins
</h2>
</div>
</div>
<div id="filtering-joins" class="section level2">
<h2>Filtering Joins</h2>
<ul>
<li><p><span style="color: #008080;background-color:#9FDDBA"><code>semi_join(x, y)</code></span>: <strong>keeps</strong> all observations in x with a corresponding observation in y. Semi-joins are useful for matching filtered summary tables back to the original tbl.</p>
<p>You can think of <code>semi_join(x, y)</code> as observations in x asking each observation in y - “Hey, yoohoo, over there, for the columns we have in common, do you also have the same values in those columns as I do?”</p>
<ul>
<li><p>if yes (doppelgänger found), x observation kept</p></li>
<li><p>if no (no doppelgänger found), x observation dropped</p></li>
<li><p>Keep <strong>ONLY</strong> the observations of me you can find in y</p></li>
</ul></li>
<li><p><span style="color: #008080;background-color:#9FDDBA"><code>anti_join(x, y)</code></span>: <strong>drops</strong> all observations in <code>x</code> that have a match in <code>y</code>. I.e. it keeps the rows that <em>don’t</em> have a match.</p>
<p>You can think of <code>anti_join(x, y)</code> as observations in x asking each observation in y the same question as above, but taking the opposite action!</p>
<ul>
<li><p>if yes (doppelgänger found), x observation <strong>dropped</strong> [I want to be unique!]</p></li>
<li><p>if no (doppelgänger not found), x observation <strong>retained</strong> [Yay, I’m the only one]</p></li>
<li><p>Keeps <strong>ONLY</strong> Unique entries of me</p></li>
</ul>
<p><img src="assets/tvd_dopplegangers.gif" width="500" height="300" alt="gif for fun"></p></li>
</ul>
<pre class="r"><code>(top_dest &lt;- flights %&gt;%
  count(dest, sort = TRUE) %&gt;%
  head(10))
#&gt; # A tibble: 10 x 2
#&gt;    dest      n
#&gt;    &lt;chr&gt; &lt;int&gt;
#&gt;  1 ORD   17283
#&gt;  2 ATL   17215
#&gt;  3 LAX   16174
#&gt;  4 BOS   15508
#&gt;  5 MCO   14082
#&gt;  6 CLT   14064
#&gt;  7 SFO   13331
#&gt;  8 FLL   12055
#&gt;  9 MIA   11728
#&gt; 10 DCA    9705</code></pre>
<p>Now to find flights that went to one of those destinations you could construct a filter yourself …</p>
<pre class="r"><code>flights %&gt;% 
  filter(dest %in% top_dest$dest)
#&gt; # A tibble: 141,145 x 19
#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
#&gt;  1  2013     1     1      542            540         2      923            850
#&gt;  2  2013     1     1      554            600        -6      812            837
#&gt;  3  2013     1     1      554            558        -4      740            728
#&gt;  4  2013     1     1      555            600        -5      913            854
#&gt;  5  2013     1     1      557            600        -3      838            846
#&gt;  6  2013     1     1      558            600        -2      753            745
#&gt;  7  2013     1     1      558            600        -2      924            917
#&gt;  8  2013     1     1      558            600        -2      923            937
#&gt;  9  2013     1     1      559            559         0      702            706
#&gt; 10  2013     1     1      600            600         0      851            858
#&gt; # ... with 141,135 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#&gt; #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>But this gets tricky if you have multiple columns you’re summarising something for.</p>
<pre class="r"><code>flights %&gt;% 
  semi_join(top_dest)
#&gt; # A tibble: 141,145 x 19
#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
#&gt;  1  2013     1     1      542            540         2      923            850
#&gt;  2  2013     1     1      554            600        -6      812            837
#&gt;  3  2013     1     1      554            558        -4      740            728
#&gt;  4  2013     1     1      555            600        -5      913            854
#&gt;  5  2013     1     1      557            600        -3      838            846
#&gt;  6  2013     1     1      558            600        -2      753            745
#&gt;  7  2013     1     1      558            600        -2      924            917
#&gt;  8  2013     1     1      558            600        -2      923            937
#&gt;  9  2013     1     1      559            559         0      702            706
#&gt; 10  2013     1     1      600            600         0      851            858
#&gt; # ... with 141,135 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#&gt; #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<figure>
<img src="assets/join-semi.PNG" width="480" height="220" alt="Semi join">
<figcaption>
<span style="color: #6d6875;background-color:#e5989b">Semi-join x and y</span>
</figcaption>
</figure>
<p><br></p>
<figure>
<img src="assets/join-semi-many.PNG" width="480" height="180" alt="Semi join">
<figcaption>
<span style="color: #6d6875;background-color:#e5989b">Semi-join x and y (multi match)</span>
</figcaption>
</figure>
<p><br></p>
<figure>
<img src="assets/join-anti.PNG" width="480" height="220" alt="Anti join">
<figcaption>
<span style="color: #6d6875;background-color:#e5989b">Anti-join x and y</span>
</figcaption>
</figure>
<p><br></p>
<p>How many flights don’t have a match in <code>plane</code>?</p>
<pre><code class='language-r'><code>flights %>% <br>&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>anti_join</span>(planes, by = "tailnum") %>% <br>&nbsp;&nbsp;count(tailnum, sort = TRUE)<br>#> # A tibble: 722 x 2<br>#> &nbsp;&nbsp;&nbsp;tailnum &nbsp;&nbsp;&nbsp;&nbsp;n<br>#> &nbsp;&nbsp;&nbsp;<chr> &nbsp;&nbsp;<int><br>#> &nbsp;1 <NA> &nbsp;&nbsp;&nbsp;&nbsp;2512<br>#> &nbsp;2 N725MQ &nbsp;&nbsp;&nbsp;575<br>#> &nbsp;3 N722MQ &nbsp;&nbsp;&nbsp;513<br>#> &nbsp;4 N723MQ &nbsp;&nbsp;&nbsp;507<br>#> &nbsp;5 N713MQ &nbsp;&nbsp;&nbsp;483<br>#> &nbsp;6 N735MQ &nbsp;&nbsp;&nbsp;396<br>#> &nbsp;7 N0EGMQ &nbsp;&nbsp;&nbsp;371<br>#> &nbsp;8 N534MQ &nbsp;&nbsp;&nbsp;364<br>#> &nbsp;9 N542MQ &nbsp;&nbsp;&nbsp;363<br>#> 10 N531MQ &nbsp;&nbsp;&nbsp;349<br>#> # ... with 712 more rows</code></code></pre>
<div id="exercises-3" class="section level3">
<h3>Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>What does it mean for a flight to have a missing <code>tailnum</code>? What do the tail numbers that don’t have a matching record in <code>planes</code> have in common? (Hint: one variable explains ~90% of the problems.)</p>
<pre class="r"><code>flights %&gt;% 
  filter(is.na(tailnum),
         is.na(dep_time),
         is.na(dep_delay),
         is.na(arr_time),
         is.na(arr_delay))
#&gt; # A tibble: 2,512 x 19
#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
#&gt;  1  2013     1     2       NA           1545        NA       NA           1910
#&gt;  2  2013     1     2       NA           1601        NA       NA           1735
#&gt;  3  2013     1     3       NA            857        NA       NA           1209
#&gt;  4  2013     1     3       NA            645        NA       NA            952
#&gt;  5  2013     1     4       NA            845        NA       NA           1015
#&gt;  6  2013     1     4       NA           1830        NA       NA           2044
#&gt;  7  2013     1     5       NA            840        NA       NA           1001
#&gt;  8  2013     1     7       NA            820        NA       NA            958
#&gt;  9  2013     1     8       NA           1645        NA       NA           1838
#&gt; 10  2013     1     9       NA            755        NA       NA           1012
#&gt; # ... with 2,502 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#&gt; #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>The flights that were cancelled seem to be the ones with missing <code>tailnum</code>.</p>
<p>What about those that have a tailnum but we don’t have an entry for it in planes?</p>
<pre class="r"><code>(missing_planes &lt;- flights %&gt;% 
  anti_join(planes, by = &quot;tailnum&quot;) %&gt;% 
  count(tailnum, sort = TRUE))
#&gt; # A tibble: 722 x 2
#&gt;    tailnum     n
#&gt;    &lt;chr&gt;   &lt;int&gt;
#&gt;  1 &lt;NA&gt;     2512
#&gt;  2 N725MQ    575
#&gt;  3 N722MQ    513
#&gt;  4 N723MQ    507
#&gt;  5 N713MQ    483
#&gt;  6 N735MQ    396
#&gt;  7 N0EGMQ    371
#&gt;  8 N534MQ    364
#&gt;  9 N542MQ    363
#&gt; 10 N531MQ    349
#&gt; # ... with 712 more rows

flights %&gt;% 
  filter(!is.na(tailnum)) %&gt;% 
  semi_join(missing_planes, by = &quot;tailnum&quot;) %&gt;% 
  select(tailnum, carrier) %&gt;% 
  left_join(airlines, by = &quot;carrier&quot;) %&gt;% 
  count(carrier, name, sort = TRUE) 
#&gt; # A tibble: 9 x 3
#&gt;   carrier name                            n
#&gt;   &lt;chr&gt;   &lt;chr&gt;                       &lt;int&gt;
#&gt; 1 MQ      Envoy Air                   25395
#&gt; 2 AA      American Airlines Inc.      22474
#&gt; 3 UA      United Air Lines Inc.        1007
#&gt; 4 B6      JetBlue Airways               830
#&gt; 5 FL      AirTran Airways Corporation   187
#&gt; 6 DL      Delta Air Lines Inc.          110
#&gt; 7 F9      Frontier Airlines Inc.         47
#&gt; 8 US      US Airways Inc.                36
#&gt; 9 WN      Southwest Airlines Co.          8

planes %&gt;% 
   filter(stringr::str_detect(tailnum, &quot;MQ&quot;)|
          stringr::str_detect(tailnum, &quot;AA&quot;))
#&gt; # A tibble: 175 x 9
#&gt;    tailnum  year type           manufacturer model engines seats speed engine   
#&gt;    &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;          &lt;chr&gt;        &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;    
#&gt;  1 N201AA   1959 Fixed wing si~ CESSNA       150         1     2    90 Reciproc~
#&gt;  2 N202AA   1980 Fixed wing mu~ CESSNA       421C        2     8    90 Reciproc~
#&gt;  3 N319AA   1985 Fixed wing mu~ BOEING       767-~       2   255    NA Turbo-fan
#&gt;  4 N320AA   1985 Fixed wing mu~ BOEING       767-~       2   255    NA Turbo-fan
#&gt;  5 N323AA   1986 Fixed wing mu~ BOEING       767-~       2   255    NA Turbo-fan
#&gt;  6 N324AA   1986 Fixed wing mu~ BOEING       767-~       2   255    NA Turbo-fan
#&gt;  7 N325AA   1986 Fixed wing mu~ BOEING       767-~       2   255    NA Turbo-fan
#&gt;  8 N327AA   1986 Fixed wing mu~ BOEING       767-~       2   255    NA Turbo-fan
#&gt;  9 N328AA   1986 Fixed wing mu~ BOEING       767-~       2   255    NA Turbo-fan
#&gt; 10 N329AA   1987 Fixed wing mu~ BOEING       767-~       2   255    NA Turbo-fan
#&gt; # ... with 165 more rows

(carrier_missing &lt;- airlines %&gt;% 
  filter(carrier == &quot;MQ&quot; | carrier == &quot;AA&quot;))
#&gt; # A tibble: 2 x 2
#&gt;   carrier name                  
#&gt;   &lt;chr&gt;   &lt;chr&gt;                 
#&gt; 1 AA      American Airlines Inc.
#&gt; 2 MQ      Envoy Air</code></pre>
<p>These seem to be mostly for carriers AA, MQ, which are American Airlines Inc., Envoy Air.</p></li>
<li><p>Filter flights to only show flights with planes that have flown at least 100 flights.</p>
<pre class="r"><code>(flights_100 &lt;- flights %&gt;% 
   filter(!is.na(tailnum)) %&gt;% 
   select(tailnum) %&gt;% 
   add_count(tailnum) %&gt;% 
   filter(n &gt;= 100)
)
#&gt; # A tibble: 228,390 x 2
#&gt;    tailnum     n
#&gt;    &lt;chr&gt;   &lt;int&gt;
#&gt;  1 N14228    111
#&gt;  2 N24211    130
#&gt;  3 N804JB    219
#&gt;  4 N39463    107
#&gt;  5 N516JB    288
#&gt;  6 N829AS    230
#&gt;  7 N593JB    294
#&gt;  8 N793JB    283
#&gt;  9 N657JB    285
#&gt; 10 N53441    102
#&gt; # ... with 228,380 more rows

flights %&gt;% 
  semi_join(flights_100)
#&gt; # A tibble: 228,390 x 19
#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
#&gt;  1  2013     1     1      517            515         2      830            819
#&gt;  2  2013     1     1      533            529         4      850            830
#&gt;  3  2013     1     1      544            545        -1     1004           1022
#&gt;  4  2013     1     1      554            558        -4      740            728
#&gt;  5  2013     1     1      555            600        -5      913            854
#&gt;  6  2013     1     1      557            600        -3      709            723
#&gt;  7  2013     1     1      557            600        -3      838            846
#&gt;  8  2013     1     1      558            600        -2      849            851
#&gt;  9  2013     1     1      558            600        -2      853            856
#&gt; 10  2013     1     1      558            600        -2      923            937
#&gt; # ... with 228,380 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#&gt; #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre></li>
<li><p>Combine <code>fueleconomy::vehicles</code> and <code>fueleconomy::common</code> to find only the records for the most common models.</p>
<pre class="r"><code>fueleconomy::common %&gt;% 
  left_join(fueleconomy::vehicles,
            by = c(&quot;make&quot;=&quot;make&quot;, &quot;model&quot;=&quot;model&quot;))
#&gt; # A tibble: 14,531 x 14
#&gt;    make  model     n years    id  year class trans drive   cyl displ fuel    hwy
#&gt;    &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
#&gt;  1 Acura Inte~    42    16  1833  1986 Subc~ Auto~ Fron~     4   1.6 Regu~    28
#&gt;  2 Acura Inte~    42    16  1834  1986 Subc~ Manu~ Fron~     4   1.6 Regu~    28
#&gt;  3 Acura Inte~    42    16  3037  1987 Subc~ Auto~ Fron~     4   1.6 Regu~    28
#&gt;  4 Acura Inte~    42    16  3038  1987 Subc~ Manu~ Fron~     4   1.6 Regu~    28
#&gt;  5 Acura Inte~    42    16  4183  1988 Subc~ Auto~ Fron~     4   1.6 Regu~    27
#&gt;  6 Acura Inte~    42    16  4184  1988 Subc~ Manu~ Fron~     4   1.6 Regu~    28
#&gt;  7 Acura Inte~    42    16  5303  1989 Subc~ Auto~ Fron~     4   1.6 Regu~    27
#&gt;  8 Acura Inte~    42    16  5304  1989 Subc~ Manu~ Fron~     4   1.6 Regu~    28
#&gt;  9 Acura Inte~    42    16  6442  1990 Subc~ Auto~ Fron~     4   1.8 Regu~    24
#&gt; 10 Acura Inte~    42    16  6443  1990 Subc~ Manu~ Fron~     4   1.8 Regu~    26
#&gt; # ... with 14,521 more rows, and 1 more variable: cty &lt;dbl&gt;</code></pre></li>
<li><p>Find the 48 hours (over the course of the whole year) that have the worst delays. Cross-reference it with the <code>weather</code> data. Can you see any patterns?</p>
<p>I am going to assume that the question just wants the top 48 hours that constitute the worst delays, and not the worst consecutive 48 hour block of time.</p>
<pre class="r"><code>flights %&gt;% 
  group_by(year, month, day, hour, origin) %&gt;% 
  summarise(mean_dep_delay = mean(dep_delay, na.rm = TRUE)) %&gt;% 
  # ungroup removes grouping - without this we get weird
  # results! Try it with and without to see diff.
  ungroup() %&gt;% 
  arrange(-mean_dep_delay) %&gt;% 
  slice_head(n = 48) %&gt;% 
  left_join(weather) %&gt;% 
  pivot_longer(cols = temp:visib,
               names_to = &quot;type&quot;,
               values_to = &quot;measure&quot;) %&gt;% 
  ggplot(aes(y = mean_dep_delay, x = measure )) +
    geom_point(alpha = 0.2) +
    facet_wrap(~ type, scales = &quot;free_x&quot;)</code></pre>
<p><img src="figure/ch10_relations_dplyr.Rmd/unnamed-chunk-48-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>If we look at the <code>Defining Key Columns</code> under question 4, we see that these flights with the top delays have humidity in the higher humidity range we saw overall, and same for temperature.</p></li>
<li><p>What does <code>anti_join(flights, airports, by = c("dest" = "faa"))</code> tell you? What does <code>anti_join(airports, flights, by = c("faa" = "dest"))</code> tell you?</p>
<pre class="r"><code>anti_join(flights, airports, by = c(&quot;dest&quot; = &quot;faa&quot;))
#&gt; # A tibble: 7,602 x 19
#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
#&gt;  1  2013     1     1      544            545        -1     1004           1022
#&gt;  2  2013     1     1      615            615         0     1039           1100
#&gt;  3  2013     1     1      628            630        -2     1137           1140
#&gt;  4  2013     1     1      701            700         1     1123           1154
#&gt;  5  2013     1     1      711            715        -4     1151           1206
#&gt;  6  2013     1     1      820            820         0     1254           1310
#&gt;  7  2013     1     1      820            820         0     1249           1329
#&gt;  8  2013     1     1      840            845        -5     1311           1350
#&gt;  9  2013     1     1      909            810        59     1331           1315
#&gt; 10  2013     1     1      913            918        -5     1346           1416
#&gt; # ... with 7,592 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#&gt; #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;

anti_join(flights, airports, by = c(&quot;dest&quot; = &quot;faa&quot;)) %&gt;% 
  distinct(dest)
#&gt; # A tibble: 4 x 1
#&gt;   dest 
#&gt;   &lt;chr&gt;
#&gt; 1 BQN  
#&gt; 2 SJU  
#&gt; 3 STT  
#&gt; 4 PSE

anti_join(airports, flights, by = c(&quot;faa&quot; = &quot;dest&quot;))
#&gt; # A tibble: 1,357 x 8
#&gt;    faa   name                       lat    lon   alt    tz dst   tzone          
#&gt;    &lt;chr&gt; &lt;chr&gt;                    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;          
#&gt;  1 04G   Lansdowne Airport         41.1  -80.6  1044    -5 A     America/New_Yo~
#&gt;  2 06A   Moton Field Municipal A~  32.5  -85.7   264    -6 A     America/Chicago
#&gt;  3 06C   Schaumburg Regional       42.0  -88.1   801    -6 A     America/Chicago
#&gt;  4 06N   Randall Airport           41.4  -74.4   523    -5 A     America/New_Yo~
#&gt;  5 09J   Jekyll Island Airport     31.1  -81.4    11    -5 A     America/New_Yo~
#&gt;  6 0A9   Elizabethton Municipal ~  36.4  -82.2  1593    -5 A     America/New_Yo~
#&gt;  7 0G6   Williams County Airport   41.5  -84.5   730    -5 A     America/New_Yo~
#&gt;  8 0G7   Finger Lakes Regional A~  42.9  -76.8   492    -5 A     America/New_Yo~
#&gt;  9 0P2   Shoestring Aviation Air~  39.8  -76.6  1000    -5 U     America/New_Yo~
#&gt; 10 0S9   Jefferson County Intl     48.1 -123.    108    -8 A     America/Los_An~
#&gt; # ... with 1,347 more rows

airports %&gt;% 
  distinct(tz)
#&gt; # A tibble: 7 x 1
#&gt;      tz
#&gt;   &lt;dbl&gt;
#&gt; 1    -5
#&gt; 2    -6
#&gt; 3    -8
#&gt; 4    -7
#&gt; 5    -9
#&gt; 6   -10
#&gt; 7     8</code></pre>
<p><code>anti_join(flights, airports, by = c("dest" = "faa"))</code> gives us any flights where the destination does not exist in airports.</p>
<p>If you google the airport names you will see that most flight destinations that are not in <code>airports</code> are located in Puerto Rico, or US Virgin Islands. Perhaps these were not in the FAA listing of airports when this data was extracted? Because the wiki pages for these show that the FAA code is the same as we see here.</p>
<p><code>anti_join(airports, flights, by = c("faa" = "dest"))</code> gives us airports that don’t exist in flights. These will be destinations that are not flown to directing from New York.</p></li>
<li><p>You might expect that there’s an implicit relationship between plane and airline, because each plane is flown by a single airline. Confirm or reject this hypothesis using the tools you’ve learned above.</p>
<p>Ok so what would we believe here? I would suspect that a plane belongs to a single airline. But some counters to this view is that surely planes can be bought and sold between carriers. The question would be in that case would the plane change <code>tailnum</code>?</p>
<p>Working on the first assumption what sort of join would help me determine if a plane belongs to one airline?</p>
<p>I would do a <code>left_join(planes, flights, by = "tailnum")</code> and then get the carrier(s) per plane, and join with airlines.</p>
<pre class="r"><code>flights %&gt;% 
  select(tailnum, carrier) %&gt;% 
  distinct() %&gt;% 
  left_join(airlines, by = &quot;carrier&quot;) %&gt;% 
  inner_join(planes, by = &quot;tailnum&quot;) %&gt;% 
  count(tailnum, carrier) %&gt;% 
  filter(n &gt; 1)
#&gt; # A tibble: 0 x 3
#&gt; # ... with 3 variables: tailnum &lt;chr&gt;, carrier &lt;chr&gt;, n &lt;int&gt;</code></pre></li>
</ol>
</div>
<div id="tips-for-joins" class="section level3">
<h3>Tips for joins</h3>
<ol style="list-style-type: decimal">
<li>Determine the primary key</li>
<li>Check that none of the primary key variables are NULL</li>
<li>Check that foreign keys match primary keys in other tables.</li>
<li>Don’t just rely on counts before and after joins! These can be misleading.</li>
</ol>
<h2>
Set operations
</h2>
</div>
</div>
<div id="set-operations" class="section level2">
<h2>Set operations</h2>
<ul>
<li><code>intersect(x, y)</code>: return only observations in both <code>x</code> and <code>y</code>.</li>
<li><code>union(x, y)</code>: return unique observations in <code>x</code> and <code>y</code>.</li>
<li><code>setdiff(x, y)</code>: return observations in <code>x</code>, but not in <code>y</code>.</li>
</ul>
<pre class="r"><code>df1 &lt;- tribble(
  ~x, ~y,
   1,  1,
   2,  1
)
df2 &lt;- tribble(
  ~x, ~y,
   1,  1,
   1,  2
)</code></pre>
<div id="intersect" class="section level3">
<h3>Intersect</h3>
<pre class="r"><code>dplyr::intersect(df1, df2)
#&gt; # A tibble: 1 x 2
#&gt;       x     y
#&gt;   &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1     1     1</code></pre>
</div>
<div id="union" class="section level3">
<h3>Union</h3>
<pre class="r"><code>dplyr::union(df1, df2)
#&gt; # A tibble: 3 x 2
#&gt;       x     y
#&gt;   &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1     1     1
#&gt; 2     2     1
#&gt; 3     1     2</code></pre>
</div>
<div id="setdiff" class="section level3">
<h3>Setdiff</h3>
<pre class="r"><code>setdiff(df1, df2)
#&gt; # A tibble: 1 x 2
#&gt;       x     y
#&gt;   &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1     2     1
setdiff(df2, df1)
#&gt; # A tibble: 1 x 2
#&gt;       x     y
#&gt;   &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1     1     2</code></pre>
<br>
<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-sessioninfo" data-toggle="collapse" data-target="#workflowr-sessioninfo" style="display: block;">
<span class="glyphicon glyphicon-wrench" aria-hidden="true"></span> Session information
</button>
</p>
<div id="workflowr-sessioninfo" class="collapse">
<pre class="r"><code>sessionInfo()
#&gt; R version 3.6.3 (2020-02-29)
#&gt; Platform: x86_64-w64-mingw32/x64 (64-bit)
#&gt; Running under: Windows 10 x64 (build 19042)
#&gt; 
#&gt; Matrix products: default
#&gt; 
#&gt; locale:
#&gt; [1] LC_COLLATE=English_South Africa.1252  LC_CTYPE=English_South Africa.1252   
#&gt; [3] LC_MONETARY=English_South Africa.1252 LC_NUMERIC=C                         
#&gt; [5] LC_TIME=English_South Africa.1252    
#&gt; 
#&gt; attached base packages:
#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     
#&gt; 
#&gt; other attached packages:
#&gt;  [1] nycflights13_1.0.1         tidyquant_1.0.0           
#&gt;  [3] quantmod_0.4.17            TTR_0.23-6                
#&gt;  [5] PerformanceAnalytics_2.0.4 xts_0.12-0                
#&gt;  [7] zoo_1.8-7                  magrittr_1.5              
#&gt;  [9] lubridate_1.7.9            emo_0.0.0.9000            
#&gt; [11] flair_0.0.2                forcats_0.5.0             
#&gt; [13] stringr_1.4.0              dplyr_1.0.2               
#&gt; [15] purrr_0.3.4                readr_1.4.0               
#&gt; [17] tidyr_1.1.2                tibble_3.0.3              
#&gt; [19] ggplot2_3.3.2              tidyverse_1.3.0           
#&gt; [21] workflowr_1.6.2           
#&gt; 
#&gt; loaded via a namespace (and not attached):
#&gt;  [1] httr_1.4.2        maps_3.3.0        viridisLite_0.3.0 jsonlite_1.7.1   
#&gt;  [5] modelr_0.1.8      assertthat_0.2.1  cellranger_1.1.0  yaml_2.2.1       
#&gt;  [9] pillar_1.4.6      backports_1.1.6   lattice_0.20-38   glue_1.4.2       
#&gt; [13] quadprog_1.5-8    digest_0.6.27     promises_1.1.0    rvest_0.3.6      
#&gt; [17] colorspace_1.4-1  htmltools_0.5.0   httpuv_1.5.2      fueleconomy_1.0.0
#&gt; [21] pkgconfig_2.0.3   broom_0.7.2       haven_2.3.1       scales_1.1.0     
#&gt; [25] whisker_0.4       later_1.0.0       git2r_0.26.1      farver_2.0.3     
#&gt; [29] generics_0.0.2    ellipsis_0.3.1    DT_0.16           withr_2.2.0      
#&gt; [33] cli_2.1.0         crayon_1.3.4      readxl_1.3.1      Lahman_8.0-0     
#&gt; [37] evaluate_0.14     ps_1.3.2          fs_1.5.0          fansi_0.4.1      
#&gt; [41] xml2_1.3.2        tools_3.6.3       hms_0.5.3         lifecycle_0.2.0  
#&gt; [45] munsell_0.5.0     reprex_0.3.0      compiler_3.6.3    rlang_0.4.8      
#&gt; [49] grid_3.6.3        rstudioapi_0.11   htmlwidgets_1.5.1 crosstalk_1.1.0.1
#&gt; [53] labeling_0.3      rmarkdown_2.4     gtable_0.3.0      DBI_1.1.0        
#&gt; [57] curl_4.3          R6_2.4.1          knitr_1.28        utf8_1.1.4       
#&gt; [61] rprojroot_1.3-2   Quandl_2.10.0     stringi_1.5.3     Rcpp_1.0.4.6     
#&gt; [65] vctrs_0.3.2       dbplyr_2.0.0      tidyselect_1.1.0  xfun_0.13</code></pre>
</div>
</div>
</div>
</div>


<!-- Adjust MathJax settings so that all math formulae are shown using
TeX fonts only; see
http://docs.mathjax.org/en/latest/configuration.html.  This will make
the presentation more consistent at the cost of the webpage sometimes
taking slightly longer to load. Note that this only works because the
footer is added to webpages before the MathJax javascript. -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
