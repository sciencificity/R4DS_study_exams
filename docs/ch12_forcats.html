<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Vebash Naidoo" />

<meta name="date" content="2020-06-11" />

<title>Chapter 12 - Factors with {forcats}</title>

<script src="site_libs/jquery-1.12.4/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="site_libs/datatables-binding-0.16/datatables.js"></script>
<link href="site_libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="site_libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="site_libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="site_libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>

<link rel="icon" href="https://github.com/workflowr/workflowr-assets/raw/master/img/reproducible.png">
<!-- Add a small amount of space between sections. -->
<style type="text/css">
div.section {
  padding-top: 12px;
}
</style>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
      </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R4DS Book - Prep for exam</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="license.html">License</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Chapter 12 - Factors with {forcats}</h1>
<h4 class="author">Vebash Naidoo</h4>
<h4 class="date">06/11/2020</h4>

</div>


<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-report" data-toggle="collapse" data-target="#workflowr-report">
<span class="glyphicon glyphicon-list" aria-hidden="true"></span> workflowr <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span>
</button>
</p>
<div id="workflowr-report" class="collapse">
<ul class="nav nav-tabs">
<li class="active">
<a data-toggle="tab" href="#summary">Summary</a>
</li>
<li>
<a data-toggle="tab" href="#checks"> Checks <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> </a>
</li>
<li>
<a data-toggle="tab" href="#versions">Past versions</a>
</li>
</ul>
<div class="tab-content">
<div id="summary" class="tab-pane fade in active">
<p>
<strong>Last updated:</strong> 2020-11-10
</p>
<p>
<strong>Checks:</strong> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> 7 <span class="glyphicon glyphicon-exclamation-sign text-danger" aria-hidden="true"></span> 0
</p>
<p>
<strong>Knit directory:</strong> <code>r4ds_book/</code> <span class="glyphicon glyphicon-question-sign" aria-hidden="true" title="This is the local directory in which the code in this file was executed."> </span>
</p>
<p>
This reproducible <a href="http://rmarkdown.rstudio.com">R Markdown</a> analysis was created with <a
  href="https://github.com/jdblischak/workflowr">workflowr</a> (version 1.6.2). The <em>Checks</em> tab describes the reproducibility checks that were applied when the results were created. The <em>Past versions</em> tab lists the development history.
</p>
<hr>
</div>
<div id="checks" class="tab-pane fade">
<div id="workflowr-checks" class="panel-group">
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRMarkdownfilestronguptodate"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>R Markdown file:</strong> up-to-date </a>
</p>
</div>
<div id="strongRMarkdownfilestronguptodate" class="panel-collapse collapse">
<div class="panel-body">
<p>Great! Since the R Markdown file has been committed to the Git repository, you know the exact version of the code that produced these results.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongEnvironmentstrongempty"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Environment:</strong> empty </a>
</p>
</div>
<div id="strongEnvironmentstrongempty" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! The global environment was empty. Objects defined in the global environment can affect the analysis in your R Markdown file in unknown ways. For reproduciblity it’s best to always run the code in an empty environment.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSeedstrongcodesetseed20200814code"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Seed:</strong> <code>set.seed(20200814)</code> </a>
</p>
</div>
<div id="strongSeedstrongcodesetseed20200814code" class="panel-collapse collapse">
<div class="panel-body">
<p>The command <code>set.seed(20200814)</code> was run prior to running the code in the R Markdown file. Setting a seed ensures that any results that rely on randomness, e.g. subsampling or permutations, are reproducible.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSessioninformationstrongrecorded"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Session information:</strong> recorded </a>
</p>
</div>
<div id="strongSessioninformationstrongrecorded" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Recording the operating system, R version, and package versions is critical for reproducibility.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongCachestrongnone"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Cache:</strong> none </a>
</p>
</div>
<div id="strongCachestrongnone" class="panel-collapse collapse">
<div class="panel-body">
<p>Nice! There were no cached chunks for this analysis, so you can be confident that you successfully produced the results during this run.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongFilepathsstrongrelative"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>File paths:</strong> relative </a>
</p>
</div>
<div id="strongFilepathsstrongrelative" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Using relative paths to the files within your workflowr project makes it easier to run your code on other machines.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRepositoryversionstrongahrefhttpsgithubcomsciencificityR4DSstudyexamstreecf689c820a2c3a9dd1bd8f2df6ed0f03bf8dd1a9targetblankcf689c8a"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Repository version:</strong> <a href="https://github.com/sciencificity/R4DS_study_exams/tree/cf689c820a2c3a9dd1bd8f2df6ed0f03bf8dd1a9" target="_blank">cf689c8</a> </a>
</p>
</div>
<div id="strongRepositoryversionstrongahrefhttpsgithubcomsciencificityR4DSstudyexamstreecf689c820a2c3a9dd1bd8f2df6ed0f03bf8dd1a9targetblankcf689c8a" class="panel-collapse collapse">
<div class="panel-body">
<p>
Great! You are using Git for version control. Tracking code development and connecting the code version to the results is critical for reproducibility.
</p>
<p>
The results in this page were generated with repository version <a href="https://github.com/sciencificity/R4DS_study_exams/tree/cf689c820a2c3a9dd1bd8f2df6ed0f03bf8dd1a9" target="_blank">cf689c8</a>. See the <em>Past versions</em> tab to see a history of the changes made to the R Markdown and HTML files.
</p>
<p>
Note that you need to be careful to ensure that all relevant files for the analysis have been committed to Git prior to generating the results (you can use <code>wflow_publish</code> or <code>wflow_git_commit</code>). workflowr only checks the R Markdown file, but you know if there are other scripts or data files that it depends on. Below is the status of the Git repository when the results were generated:
</p>
<pre><code>
Ignored files:
    Ignored:    .Rproj.user/

Untracked files:
    Untracked:  analysis/images/
    Untracked:  code_snipp.txt

</code></pre>
<p>
Note that any generated files, e.g. HTML, png, CSS, etc., are not included in this status report because it is ok for generated content to have uncommitted changes.
</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div id="versions" class="tab-pane fade">

<p>
These are the previous versions of the repository in which changes were made to the R Markdown (<code>analysis/ch12_forcats.Rmd</code>) and HTML (<code>docs/ch12_forcats.html</code>) files. If you’ve configured a remote Git repository (see <code>?wflow_git_remote</code>), click on the hyperlinks in the table below to view the files as they were in that past version.
</p>
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
File
</th>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
<th>
Message
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/sciencificity/R4DS_study_exams/4879249efdfb1b6acb1c0ed5d85a58fac5eeb0c2/docs/ch12_forcats.html" target="_blank">4879249</a>
</td>
<td>
sciencificity
</td>
<td>
2020-11-09
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/sciencificity/R4DS_study_exams/e4239674be77d3b6d016e78863ae5cf23c93a07b/docs/ch12_forcats.html" target="_blank">e423967</a>
</td>
<td>
sciencificity
</td>
<td>
2020-11-08
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/sciencificity/R4DS_study_exams/0d223fb536f932b6f5957f0eb33982ea0a73d3db/docs/ch12_forcats.html" target="_blank">0d223fb</a>
</td>
<td>
sciencificity
</td>
<td>
2020-11-08
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/sciencificity/R4DS_study_exams/ecd1d8ed8bb055d0acaf502bb58ca1845a946c31/docs/ch12_forcats.html" target="_blank">ecd1d8e</a>
</td>
<td>
sciencificity
</td>
<td>
2020-11-07
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/sciencificity/R4DS_study_exams/274005c12ed67cd6a85e644047ee088769411b8d/docs/ch12_forcats.html" target="_blank">274005c</a>
</td>
<td>
sciencificity
</td>
<td>
2020-11-06
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/sciencificity/R4DS_study_exams/blob/d9eab386d34352295f525dc6679128a400d2b81d/analysis/ch12_forcats.Rmd" target="_blank">d9eab38</a>
</td>
<td>
sciencificity
</td>
<td>
2020-11-06
</td>
<td>
finished ch12
</td>
</tr>
</tbody>
</table>
</div>
<hr>
</div>
</div>
</div>
<style type="text/css">
.tabset h2 {display: none;}
</style>
<div id="buttons" class="section level1 tabset tabset-fade tabset-pills">
<h1>Factors</h1>
<p><strong>Click on the tab buttons below for each section</strong></p>
<h2>
Create Factors
</h2>
<div id="create-factors" class="section level2">
<h2>Create Factors</h2>
<p><strong>forcats</strong> is a set of tools to deal with <em>categorical</em> variables, and it’s an anagram of factors!</p>
<p>To create a factor you must start by creating a list of the valid <span style="color: #008080;background-color:#9FDDBA"><strong>levels</strong></span>:</p>
<pre class="r"><code>x1 &lt;- c(&quot;Dec&quot;, &quot;Apr&quot;, &quot;Jan&quot;, &quot;Mar&quot;)
sort(x1) # with just string values sorting is alphabetical
#&gt; [1] &quot;Apr&quot; &quot;Dec&quot; &quot;Jan&quot; &quot;Mar&quot;
# we could accidentally misspell words Jam instead of Jan
x2 &lt;- c(&quot;Dec&quot;, &quot;Apr&quot;, &quot;Jam&quot;, &quot;Mar&quot;) </code></pre>
<pre class="r"><code># list of valid levels
month_levels &lt;- c(&quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;, &quot;Apr&quot;,
                  &quot;May&quot;, &quot;Jun&quot;, &quot;Jul&quot;, &quot;Aug&quot;,
                  &quot;Sep&quot;, &quot;Oct&quot;, &quot;Nov&quot;, &quot;Dec&quot;)</code></pre>
<pre><code class='language-r'><code>(y1 <- <span style='background-color:#9FDDBA;color:#008080'>factor</span>(x1, <span style='background-color:#9FDDBA;color:#008080'>levels =</span> month_levels))<br>#> [1] Dec Apr Jan Mar<br>#> Levels: Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec<br>sort(y1)<br>#> [1] Jan Mar Apr Dec<br>#> Levels: Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec</code></code></pre>
<p>Any values <span style="color: #FFE4E1;background-color:#E3242B">not in the set of valid values</span> is marked as <strong>NA</strong>.</p>
<pre class="r"><code>(y2 &lt;- factor(x2, levels = month_levels))
#&gt; [1] Dec  Apr  &lt;NA&gt; Mar 
#&gt; Levels: Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec</code></pre>
<p>If you want a <span style="color: #FFE4E1;background-color:#FD5800">warning</span> use <span style="color: #FFE4E1;background-color:#FD5800"><code>parse_factor()</code></span>.</p>
<pre><code class='language-r'><code>(y2 <- <span style='background-color:#9FDDBA;color:#008080'>parse_factor</span>(x2, levels = month_levels))<br>#> <span style='background-color:#ffa578;color:#FFE4E1'>Warning:</span> 1 parsing failure.<br>#> row col &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expected actual<br>#> &nbsp;&nbsp;3 &nbsp;-- value in level set &nbsp;&nbsp;&nbsp;Jam<br>#> [1] Dec &nbsp;Apr &nbsp;<NA> Mar <br>#> attr(,"problems")<br>#> # A tibble: 1 x 4<br>#> &nbsp;&nbsp;&nbsp;&nbsp;row &nbsp;&nbsp;col expected &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;actual<br>#> &nbsp;&nbsp;<int> <int> <chr> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<chr> <br>#> 1 &nbsp;&nbsp;&nbsp;&nbsp;3 &nbsp;&nbsp;&nbsp;NA value in level set Jam &nbsp;&nbsp;<br>#> Levels: Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec</code></code></pre>
<p><span style="color: #FFE4E1;background-color:#FD5800">Check your intention</span>:</p>
<ul>
<li><p>if you <strong>omit</strong> the <code>levels =</code> argument the levels are taken from the data in <strong>alphabetical order</strong>.</p>
<pre><code class='language-r'><code>factor(x1)<br>&nbsp;&nbsp;#> [1] Dec Apr Jan Mar<br>&nbsp;&nbsp;#> <span style='background-color:#ffa578;color:#FFE4E1'>Levels:</span> Apr Dec Jan Mar</code></code></pre></li>
<li><p>if you want to match the order of <em>first appearance</em> you can do this using <span style="color: #008080;background-color:#9FDDBA"> <code>levels = unique(x)</code></span> or with <span style="color: #008080;background-color:#9FDDBA"> <code>fct_inorder()</code></span></p>
<pre><code class='language-r'><code>(f1 <- factor(x1, <span style='background-color:#9FDDBA;color:#008080'>levels = unique(x1)</span>))<br>&nbsp;&nbsp;#> [1] Dec Apr Jan Mar<br>&nbsp;&nbsp;#> Levels: Dec Apr Jan Mar<br>&nbsp;&nbsp;<br>&nbsp;&nbsp;(f2 <- x1 %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;factor() %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>fct_inorder()</span><br>&nbsp;&nbsp;)<br>&nbsp;&nbsp;#> [1] Dec Apr Jan Mar<br>&nbsp;&nbsp;#> Levels: Dec Apr Jan Mar</code></code></pre></li>
</ul>
<p>To find the <code>levels</code> of a factor:</p>
<pre><code class='language-r'><code><span style='background-color:#9FDDBA;color:#008080'>levels</span>(f2)<br>#> [1] "Dec" "Apr" "Jan" "Mar"</code></code></pre>
<h2>
Our Dataset
</h2>
</div>
<div id="our-dataset" class="section level2">
<h2>Our Dataset</h2>
<p>Sample of data from the <a href="http://gss.norc.org">General Social Survey</a>.</p>
<pre class="r"><code>gss_cat
#&gt; # A tibble: 21,483 x 9
#&gt;     year marital     age race  rincome    partyid     relig     denom    tvhours
#&gt;    &lt;int&gt; &lt;fct&gt;     &lt;int&gt; &lt;fct&gt; &lt;fct&gt;      &lt;fct&gt;       &lt;fct&gt;     &lt;fct&gt;      &lt;int&gt;
#&gt;  1  2000 Never ma~    26 White $8000 to ~ Ind,near r~ Protesta~ Souther~      12
#&gt;  2  2000 Divorced     48 White $8000 to ~ Not str re~ Protesta~ Baptist~      NA
#&gt;  3  2000 Widowed      67 White Not appli~ Independent Protesta~ No deno~       2
#&gt;  4  2000 Never ma~    39 White Not appli~ Ind,near r~ Orthodox~ Not app~       4
#&gt;  5  2000 Divorced     25 White Not appli~ Not str de~ None      Not app~       1
#&gt;  6  2000 Married      25 White $20000 - ~ Strong dem~ Protesta~ Souther~      NA
#&gt;  7  2000 Never ma~    36 White $25000 or~ Not str re~ Christian Not app~       3
#&gt;  8  2000 Divorced     44 White $7000 to ~ Ind,near d~ Protesta~ Luthera~      NA
#&gt;  9  2000 Married      44 White $25000 or~ Not str de~ Protesta~ Other          0
#&gt; 10  2000 Married      47 White $25000 or~ Strong rep~ Protesta~ Souther~       3
#&gt; # ... with 21,473 more rows</code></pre>
<pre class="r"><code>levels(gss_cat$marital)
#&gt; [1] &quot;No answer&quot;     &quot;Never married&quot; &quot;Separated&quot;     &quot;Divorced&quot;     
#&gt; [5] &quot;Widowed&quot;       &quot;Married&quot;
levels(gss_cat$race)
#&gt; [1] &quot;Other&quot;          &quot;Black&quot;          &quot;White&quot;          &quot;Not applicable&quot;
levels(gss_cat$rincome)
#&gt;  [1] &quot;No answer&quot;      &quot;Don&#39;t know&quot;     &quot;Refused&quot;        &quot;$25000 or more&quot;
#&gt;  [5] &quot;$20000 - 24999&quot; &quot;$15000 - 19999&quot; &quot;$10000 - 14999&quot; &quot;$8000 to 9999&quot; 
#&gt;  [9] &quot;$7000 to 7999&quot;  &quot;$6000 to 6999&quot;  &quot;$5000 to 5999&quot;  &quot;$4000 to 4999&quot; 
#&gt; [13] &quot;$3000 to 3999&quot;  &quot;$1000 to 2999&quot;  &quot;Lt $1000&quot;       &quot;Not applicable&quot;
levels(gss_cat$partyid)
#&gt;  [1] &quot;No answer&quot;          &quot;Don&#39;t know&quot;         &quot;Other party&quot;       
#&gt;  [4] &quot;Strong republican&quot;  &quot;Not str republican&quot; &quot;Ind,near rep&quot;      
#&gt;  [7] &quot;Independent&quot;        &quot;Ind,near dem&quot;       &quot;Not str democrat&quot;  
#&gt; [10] &quot;Strong democrat&quot;
levels(gss_cat$relig)
#&gt;  [1] &quot;No answer&quot;               &quot;Don&#39;t know&quot;             
#&gt;  [3] &quot;Inter-nondenominational&quot; &quot;Native american&quot;        
#&gt;  [5] &quot;Christian&quot;               &quot;Orthodox-christian&quot;     
#&gt;  [7] &quot;Moslem/islam&quot;            &quot;Other eastern&quot;          
#&gt;  [9] &quot;Hinduism&quot;                &quot;Buddhism&quot;               
#&gt; [11] &quot;Other&quot;                   &quot;None&quot;                   
#&gt; [13] &quot;Jewish&quot;                  &quot;Catholic&quot;               
#&gt; [15] &quot;Protestant&quot;              &quot;Not applicable&quot;
levels(gss_cat$denom)
#&gt;  [1] &quot;No answer&quot;            &quot;Don&#39;t know&quot;           &quot;No denomination&quot;     
#&gt;  [4] &quot;Other&quot;                &quot;Episcopal&quot;            &quot;Presbyterian-dk wh&quot;  
#&gt;  [7] &quot;Presbyterian, merged&quot; &quot;Other presbyterian&quot;   &quot;United pres ch in us&quot;
#&gt; [10] &quot;Presbyterian c in us&quot; &quot;Lutheran-dk which&quot;    &quot;Evangelical luth&quot;    
#&gt; [13] &quot;Other lutheran&quot;       &quot;Wi evan luth synod&quot;   &quot;Lutheran-mo synod&quot;   
#&gt; [16] &quot;Luth ch in america&quot;   &quot;Am lutheran&quot;          &quot;Methodist-dk which&quot;  
#&gt; [19] &quot;Other methodist&quot;      &quot;United methodist&quot;     &quot;Afr meth ep zion&quot;    
#&gt; [22] &quot;Afr meth episcopal&quot;   &quot;Baptist-dk which&quot;     &quot;Other baptists&quot;      
#&gt; [25] &quot;Southern baptist&quot;     &quot;Nat bapt conv usa&quot;    &quot;Nat bapt conv of am&quot; 
#&gt; [28] &quot;Am bapt ch in usa&quot;    &quot;Am baptist asso&quot;      &quot;Not applicable&quot;</code></pre>
<pre class="r"><code>gss_cat %&gt;% 
  count(marital, sort = TRUE)
#&gt; # A tibble: 6 x 2
#&gt;   marital           n
#&gt;   &lt;fct&gt;         &lt;int&gt;
#&gt; 1 Married       10117
#&gt; 2 Never married  5416
#&gt; 3 Divorced       3383
#&gt; 4 Widowed        1807
#&gt; 5 Separated       743
#&gt; 6 No answer        17

gss_cat %&gt;% 
  count(race, sort = TRUE)
#&gt; # A tibble: 3 x 2
#&gt;   race      n
#&gt;   &lt;fct&gt; &lt;int&gt;
#&gt; 1 White 16395
#&gt; 2 Black  3129
#&gt; 3 Other  1959

gss_cat %&gt;% 
  count(relig, sort = TRUE)
#&gt; # A tibble: 15 x 2
#&gt;    relig                       n
#&gt;    &lt;fct&gt;                   &lt;int&gt;
#&gt;  1 Protestant              10846
#&gt;  2 Catholic                 5124
#&gt;  3 None                     3523
#&gt;  4 Christian                 689
#&gt;  5 Jewish                    388
#&gt;  6 Other                     224
#&gt;  7 Buddhism                  147
#&gt;  8 Inter-nondenominational   109
#&gt;  9 Moslem/islam              104
#&gt; 10 Orthodox-christian         95
#&gt; 11 No answer                  93
#&gt; 12 Hinduism                   71
#&gt; 13 Other eastern              32
#&gt; 14 Native american            23
#&gt; 15 Don&#39;t know                 15</code></pre>
<pre class="r"><code>gss_cat %&gt;% 
  ggplot(aes(x = race)) +
  geom_bar()</code></pre>
<p><img src="figure/ch12_forcats.Rmd/unnamed-chunk-13-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>
gss_cat %&gt;% 
  ggplot(aes(x = relig)) +
  geom_bar() +
  guides(x = guide_axis(angle = 90))</code></pre>
<p><img src="figure/ch12_forcats.Rmd/unnamed-chunk-13-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>By <strong>default</strong> levels with <strong>NO Values</strong> are dropped in <code>ggplot()</code>. To explicitly show all levels irrespective of whether any observations in your data fall in that category use: <span style="color: #008080;background-color:#9FDDBA"><code>scale_x_discrete(drop = FALSE)</code></span>.</p>
<pre><code class='language-r'><code>gss_cat %>% <br>&nbsp;&nbsp;ggplot(aes(x = race)) +<br>&nbsp;&nbsp;geom_bar() +<br>&nbsp;&nbsp;# show all levels even if 0 observations<br>&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>scale_x_discrete(drop = FALSE)</span></code></code></pre>
<p><img src="figure/ch12_forcats.Rmd/unnamed-chunk-42-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code class='language-r'><code>gss_cat %>% <br>&nbsp;&nbsp;count(race, sort=TRUE, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# in count use .drop<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>.drop = FALSE</span>)<br>#> # A tibble: 4 x 2<br>#> &nbsp;&nbsp;race &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n<br>#> &nbsp;&nbsp;<fct> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<int><br>#> 1 White &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;16395<br>#> 2 Black &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3129<br>#> 3 Other &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1959<br>#> 4 Not applicable &nbsp;&nbsp;&nbsp;&nbsp;0</code></code></pre>
<div id="exercises" class="section level3">
<h3>Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Explore the distribution of <code>rincome</code> (reported income). What makes the default bar chart hard to understand? How could you improve the plot?</p>
<pre class="r"><code>gss_cat %&gt;% 
  ggplot(aes(rincome)) +
  geom_bar() +
  # let&#39;s change x-axis text orientation
  # otherwise hard to read anything
  guides(x = guide_axis(angle = 45))</code></pre>
<p><img src="figure/ch12_forcats.Rmd/unnamed-chunk-15-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The order of the categories is a bit hard to read since we are reading right to left in increasing order of income categories. But also in the mix is some <code>Not applicable</code> at one end, whereas <code>No answer</code>, <code>Don't   know</code> and <code>Refused</code> is on the other end.</p>
<p>Let’s flip the axis.</p>
<pre class="r"><code>gss_cat %&gt;% 
  ggplot(aes(y = rincome))+
  geom_bar() +
  labs(y = &#39;Reported Income&#39;,
       x = &#39;Number of observations&#39;)</code></pre>
<p><img src="figure/ch12_forcats.Rmd/unnamed-chunk-16-1.png" width="672" style="display: block; margin: auto;" /></p></li>
<li><p>What is the most common <code>relig</code> in this survey? What’s the most common <code>partyid</code>?</p>
<pre class="r"><code>most_common_relig &lt;- gss_cat %&gt;% 
  count(relig, sort = TRUE) %&gt;% 
  head(1)

most_common_partyid &lt;- gss_cat %&gt;% 
  count(partyid, sort = TRUE) %&gt;% 
  head(1)</code></pre>
<p>The most common <strong>religion</strong> is Protestant with 10846 observations out of 21483 in that category.</p>
<p>The most common <strong>partyid</strong> is Independent with 4119 observations out of 21483 in that category.</p></li>
<li><p>Which <code>relig</code> does <code>denom</code> (denomination) apply to? How can you find out with a table? How can you find out with a visualisation?</p>
<pre class="r"><code>gss_cat %&gt;% 
  count(relig, denom, sort=TRUE)
#&gt; # A tibble: 47 x 3
#&gt;    relig      denom                n
#&gt;    &lt;fct&gt;      &lt;fct&gt;            &lt;int&gt;
#&gt;  1 Catholic   Not applicable    5124
#&gt;  2 None       Not applicable    3523
#&gt;  3 Protestant Other             2534
#&gt;  4 Protestant Southern baptist  1536
#&gt;  5 Protestant Baptist-dk which  1457
#&gt;  6 Protestant No denomination   1224
#&gt;  7 Protestant United methodist  1067
#&gt;  8 Christian  No denomination    452
#&gt;  9 Protestant Episcopal          397
#&gt; 10 Jewish     Not applicable     388
#&gt; # ... with 37 more rows

gss_cat %&gt;% 
  count(denom, sort = TRUE) %&gt;% 
  DT::datatable()</code></pre>
<div id="htmlwidget-092a7ce9087b17ef7cc3" style="width:100%;height:auto;" class="datatables html-widget"></div>
      <script type="application/json" data-for="htmlwidget-092a7ce9087b17ef7cc3">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30"],["Not applicable","Other","No denomination","Southern baptist","Baptist-dk which","United methodist","Episcopal","Lutheran-dk which","Presbyterian-dk wh","Methodist-dk which","Am baptist asso","Other baptists","Lutheran-mo synod","Am lutheran","Am bapt ch in usa","Evangelical luth","No answer","United pres ch in us","Presbyterian c in us","Afr meth episcopal","Nat bapt conv of am","Wi evan luth synod","Luth ch in america","Presbyterian, merged","Don't know","Other presbyterian","Nat bapt conv usa","Other methodist","Afr meth ep zion","Other lutheran"],[10072,2534,1683,1536,1457,1067,397,267,244,239,237,213,212,146,130,122,117,110,104,77,76,71,71,67,52,47,40,33,32,30]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>denom<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>
gss_cat %&gt;% 
  filter(!is.na(denom),
         denom != &quot;Not applicable&quot;, 
         denom != &#39;No answer&#39;) %&gt;% 
  count(relig, sort = TRUE)
#&gt; # A tibble: 3 x 2
#&gt;   relig          n
#&gt;   &lt;fct&gt;      &lt;int&gt;
#&gt; 1 Protestant 10824
#&gt; 2 Christian    463
#&gt; 3 Other          7

gss_cat %&gt;% 
  filter(!is.na(denom),
         denom != &quot;Not applicable&quot;, 
         denom != &#39;No answer&#39;)  %&gt;% 
  select(relig, denom) %&gt;% 
  group_by(relig) %&gt;% 
  skimr::skim()</code></pre>
<table>
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">Piped data</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">11294</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">2</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">factor</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">relig</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="left">relig</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">ordered</th>
<th align="right">n_unique</th>
<th align="left">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">denom</td>
<td align="left">Christian</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">2</td>
<td align="left">No : 452, Don: 11, No : 0, Oth: 0</td>
</tr>
<tr class="even">
<td align="left">denom</td>
<td align="left">Other</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">1</td>
<td align="left">No : 7, No : 0, Don: 0, Oth: 0</td>
</tr>
<tr class="odd">
<td align="left">denom</td>
<td align="left">Protestant</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">28</td>
<td align="left">Oth: 2534, Sou: 1536, Bap: 1457, No : 1224</td>
</tr>
</tbody>
</table>
<pre class="r"><code>
gss_cat %&gt;% 
  filter(relig == &#39;Christian&#39;) %&gt;% 
  count(denom, sort = TRUE)
#&gt; # A tibble: 4 x 2
#&gt;   denom               n
#&gt;   &lt;fct&gt;           &lt;int&gt;
#&gt; 1 No denomination   452
#&gt; 2 Not applicable    224
#&gt; 3 Don&#39;t know         11
#&gt; 4 No answer           2

gss_cat %&gt;% 
  ggplot(aes(y = relig, fill = denom)) +
  geom_bar() +
  scale_fill_tq() +
  labs(y = &#39;Religion&#39;,
  fill = &#39;Denomination&#39;)</code></pre>
<p><img src="figure/ch12_forcats.Rmd/unnamed-chunk-18-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>The <code>denom</code> is applicable to the <code>Protestant</code> religion.</p></li>
</ol>
<h2>
Modify Factor Order
</h2>
</div>
</div>
<div id="modify-factor-order" class="section level2">
<h2>Modify Factor Order</h2>
<p>It’s often useful to change the order of the factor levels in a visualisation.</p>
<pre class="r"><code>( relig_summ &lt;- gss_cat %&gt;% 
  group_by(relig) %&gt;% 
  summarise(
    age = mean(age, na.rm = TRUE),
    tvhours = mean(tvhours, na.rm = TRUE),
    n = n()
  ) )
#&gt; # A tibble: 15 x 4
#&gt;    relig                     age tvhours     n
#&gt;    &lt;fct&gt;                   &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;
#&gt;  1 No answer                49.5    2.72    93
#&gt;  2 Don&#39;t know               35.9    4.62    15
#&gt;  3 Inter-nondenominational  40.0    2.87   109
#&gt;  4 Native american          38.9    3.46    23
#&gt;  5 Christian                40.1    2.79   689
#&gt;  6 Orthodox-christian       50.4    2.42    95
#&gt;  7 Moslem/islam             37.6    2.44   104
#&gt;  8 Other eastern            45.9    1.67    32
#&gt;  9 Hinduism                 37.7    1.89    71
#&gt; 10 Buddhism                 44.7    2.38   147
#&gt; 11 Other                    41.0    2.73   224
#&gt; 12 None                     41.2    2.71  3523
#&gt; 13 Jewish                   52.4    2.52   388
#&gt; 14 Catholic                 46.9    2.96  5124
#&gt; 15 Protestant               49.9    3.15 10846

relig_summ %&gt;% 
  ggplot(aes(tvhours, relig)) +
  geom_point()</code></pre>
<p><img src="figure/ch12_forcats.Rmd/unnamed-chunk-19-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The plot above is hard to interpret since there is no pattern.</p>
<p>We can improve it by reordering the levels of <code>relig</code> using <span style="color: #008080;background-color:#9FDDBA"><code>fct_reorder()</code></span> .</p>
<p><span style="color: #008080;background-color:#9FDDBA"><code>fct_reorder()</code></span> takes three arguments:</p>
<ul>
<li><span style="color: #008080;background-color:#9FDDBA"><code>f</code></span>, the factor whose levels you want to modify.</li>
<li><span style="color: #008080;background-color:#9FDDBA"><code>x</code></span>, a numeric vector that you want to use to reorder the levels.</li>
<li>Optionally, <span style="color: #008080;background-color:#9FDDBA"><code>fun</code></span> , a function that’s used if there are multiple values of <code>x</code> for each value of <code>f</code>. The default value is <code>median</code>.</li>
</ul>
<pre><code class='language-r'><code>relig_summ %>% <br>&nbsp;&nbsp;ggplot(aes(tvhours, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# I want to reorder the levels of religion<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# based on the order of tvhours<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>fct_reorder</span>(relig, tvhours))) +<br>&nbsp;&nbsp;geom_point()</code></code></pre>
<p><img src="figure/ch12_forcats.Rmd/unnamed-chunk-43-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>For more complicated reordering move these out into <code>mutate()</code>.</p>
<pre><code class='language-r'><code>relig_summ %>% <br>&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>mutate</span>(relig = <span style='background-color:#9FDDBA;color:#008080'>fct_reorder</span>(relig, tvhours)) %>% <br>&nbsp;&nbsp;ggplot(aes(tvhours, relig)) +<br>&nbsp;&nbsp;geom_point()</code></code></pre>
<p><img src="figure/ch12_forcats.Rmd/unnamed-chunk-44-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>How does age vary across reported income?</p>
<pre class="r"><code>(age_per_inc_level &lt;- gss_cat %&gt;% 
  group_by(rincome) %&gt;% 
  summarise(age = mean(age, na.rm = TRUE),
            n = n()))
#&gt; # A tibble: 16 x 3
#&gt;    rincome          age     n
#&gt;    &lt;fct&gt;          &lt;dbl&gt; &lt;int&gt;
#&gt;  1 No answer       45.5   183
#&gt;  2 Don&#39;t know      45.6   267
#&gt;  3 Refused         47.6   975
#&gt;  4 $25000 or more  44.2  7363
#&gt;  5 $20000 - 24999  41.5  1283
#&gt;  6 $15000 - 19999  40.0  1048
#&gt;  7 $10000 - 14999  41.1  1168
#&gt;  8 $8000 to 9999   41.1   340
#&gt;  9 $7000 to 7999   38.2   188
#&gt; 10 $6000 to 6999   40.3   215
#&gt; 11 $5000 to 5999   37.8   227
#&gt; 12 $4000 to 4999   38.9   226
#&gt; 13 $3000 to 3999   37.8   276
#&gt; 14 $1000 to 2999   34.5   395
#&gt; 15 Lt $1000        40.5   286
#&gt; 16 Not applicable  56.1  7043

age_per_inc_level %&gt;% 
  mutate(rincome = fct_reorder(rincome, age)) %&gt;% 
  ggplot(aes(age, rincome)) +
  geom_point()</code></pre>
<p><img src="figure/ch12_forcats.Rmd/unnamed-chunk-22-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Here, reordering the levels does not make sense because <code>rincome</code> already has an order that we shouldn’t mess with.</p>
<p>Advice in book: <strong>Reserve <code>fct_reorder()</code> for factors whose levels are arbitrarily ordered</strong>.</p>
<p>Notice that it is probably better to pull out <em>Not applicable</em>. We use <span style="color: #008080;background-color:#9FDDBA"><code>fct_relevel()</code></span>. It takes a factor, <code>f</code>, and then any number of levels that you want to move to the front.</p>
<pre><code class='language-r'><code>levels(age_per_inc_level$rincome) # levels originally<br>#> &nbsp;[1] "No answer" &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Don't know" &nbsp;&nbsp;&nbsp;&nbsp;"Refused" &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"$25000 or more"<br>#> &nbsp;[5] "$20000 - 24999" "$15000 - 19999" "$10000 - 14999" "$8000 to 9999" <br>#> &nbsp;[9] "$7000 to 7999" &nbsp;"$6000 to 6999" &nbsp;"$5000 to 5999" &nbsp;"$4000 to 4999" <br>#> [13] "$3000 to 3999" &nbsp;"$1000 to 2999" &nbsp;"Lt $1000" &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span style='background-color:#cfdad4;color:#6d6875'>Not applicable</span>"<br>(x <- <span style='background-color:#9FDDBA;color:#008080'>fct_relevel</span>(age_per_inc_level$rincome, "<span style='background-color:#cfdad4;color:#6d6875'>Not applicable</span>")) # let's relevel<br>#> &nbsp;[1] No answer &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Don't know &nbsp;&nbsp;&nbsp;&nbsp;Refused &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$25000 or more $20000 - 24999<br>#> &nbsp;[6] $15000 - 19999 $10000 - 14999 $8000 to 9999 &nbsp;$7000 to 7999 &nbsp;$6000 to 6999 <br>#> [11] $5000 to 5999 &nbsp;$4000 to 4999 &nbsp;$3000 to 3999 &nbsp;$1000 to 2999 &nbsp;Lt $1000 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>#> [16] <span style='background-color:#cfdad4;color:#6d6875'>Not applicable</span><br>#> 16 Levels: <span style='background-color:#cfdad4;color:#6d6875'>Not applicable</span> No answer Don't know Refused ... Lt $1000<br>levels(x) # levels after<br>#> &nbsp;[1] "<span style='background-color:#cfdad4;color:#6d6875'>Not applicable</span>" "No answer" &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Don't know" &nbsp;&nbsp;&nbsp;&nbsp;"Refused" &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>#> &nbsp;[5] "$25000 or more" "$20000 - 24999" "$15000 - 19999" "$10000 - 14999"<br>#> &nbsp;[9] "$8000 to 9999" &nbsp;"$7000 to 7999" &nbsp;"$6000 to 6999" &nbsp;"$5000 to 5999" <br>#> [13] "$4000 to 4999" &nbsp;"$3000 to 3999" &nbsp;"$1000 to 2999" &nbsp;"Lt $1000"<br><br>ggplot(age_per_inc_level, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aes(age, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>fct_relevel</span>(rincome,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span style='background-color:#cfdad4;color:#6d6875'>Not applicable</span>"))) +<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;geom_point()</code></code></pre>
<p><img src="figure/ch12_forcats.Rmd/unnamed-chunk-45-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Why do you think the average age for “Not applicable” is so high?</p>
<p>Maybe these are retirees that don’t earn a monthly income any longer, hence they marked it as <em>Not applicable</em>.</p>
<p>Another type of <strong>reordering</strong> is useful when you are <strong>colouring the lines on a plot</strong>. <span style="color: #008080;background-color:#9FDDBA"><code>fct_reorder2()</code></span> reorders the factor by the <code>y</code> values associated with the largest <code>x</code> values. The legend lines up much nicer and is easier to read.</p>
<pre class="r"><code>(by_age &lt;- gss_cat %&gt;% 
  filter(!is.na(age)) %&gt;% 
  count(age, marital) %&gt;% 
  group_by(age) %&gt;% 
  mutate(prop = n / sum(n)))
#&gt; # A tibble: 351 x 4
#&gt; # Groups:   age [72]
#&gt;      age marital           n    prop
#&gt;    &lt;int&gt; &lt;fct&gt;         &lt;int&gt;   &lt;dbl&gt;
#&gt;  1    18 Never married    89 0.978  
#&gt;  2    18 Married           2 0.0220 
#&gt;  3    19 Never married   234 0.940  
#&gt;  4    19 Divorced          3 0.0120 
#&gt;  5    19 Widowed           1 0.00402
#&gt;  6    19 Married          11 0.0442 
#&gt;  7    20 Never married   227 0.904  
#&gt;  8    20 Separated         1 0.00398
#&gt;  9    20 Divorced          2 0.00797
#&gt; 10    20 Married          21 0.0837 
#&gt; # ... with 341 more rows

ggplot(by_age, aes(age, prop, colour = marital)) +
  geom_line(na.rm = TRUE)</code></pre>
<p><img src="figure/ch12_forcats.Rmd/unnamed-chunk-24-1.png" width="50%" /></p>
<pre class="r"><code>
ggplot(by_age, aes(age, prop, 
                   # reorder marital categories
                   # by the largest proportion
                   # in each age group
                   colour = fct_reorder2(marital,
                                         age,
                                         prop))) +
  geom_line() +
  labs(colour = &#39;marital&#39;)</code></pre>
<p><img src="figure/ch12_forcats.Rmd/unnamed-chunk-24-2.png" width="50%" /></p>
<p>For bar plots, you can use <code>fct_infreq()</code> to order levels in increasing frequency, and it doesn’t need any extra variables. You may want to combine with <code>fct_rev()</code>.</p>
<pre class="r"><code>gss_cat %&gt;%
  mutate(marital = marital %&gt;% fct_infreq()) %&gt;%
  ggplot(aes(marital)) +
    geom_bar()</code></pre>
<p><img src="figure/ch12_forcats.Rmd/unnamed-chunk-25-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>
gss_cat %&gt;% 
  mutate(marital = marital %&gt;% 
           fct_infreq() %&gt;% fct_rev()) %&gt;% 
  ggplot(aes(marital)) +
  geom_bar()</code></pre>
<p><img src="figure/ch12_forcats.Rmd/unnamed-chunk-25-2.png" width="672" style="display: block; margin: auto;" /></p>
<div id="exercises-1" class="section level3">
<h3>Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>There are some suspiciously high numbers in <code>tvhours</code>. Is the mean a good summary?</p>
<pre class="r"><code>ggplot(gss_cat, aes(tvhours)) +
  geom_histogram()</code></pre>
<p><img src="figure/ch12_forcats.Rmd/unnamed-chunk-26-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>It’s probably better to use a median as there are outliers present.</p></li>
<li><p>For each factor in <code>gss_cat</code> identify whether the order of the levels is arbitrary or principled.</p>
<pre class="r"><code>levels(gss_cat$marital)
#&gt; [1] &quot;No answer&quot;     &quot;Never married&quot; &quot;Separated&quot;     &quot;Divorced&quot;     
#&gt; [5] &quot;Widowed&quot;       &quot;Married&quot;
levels(gss_cat$race)
#&gt; [1] &quot;Other&quot;          &quot;Black&quot;          &quot;White&quot;          &quot;Not applicable&quot;
levels(gss_cat$rincome)
#&gt;  [1] &quot;No answer&quot;      &quot;Don&#39;t know&quot;     &quot;Refused&quot;        &quot;$25000 or more&quot;
#&gt;  [5] &quot;$20000 - 24999&quot; &quot;$15000 - 19999&quot; &quot;$10000 - 14999&quot; &quot;$8000 to 9999&quot; 
#&gt;  [9] &quot;$7000 to 7999&quot;  &quot;$6000 to 6999&quot;  &quot;$5000 to 5999&quot;  &quot;$4000 to 4999&quot; 
#&gt; [13] &quot;$3000 to 3999&quot;  &quot;$1000 to 2999&quot;  &quot;Lt $1000&quot;       &quot;Not applicable&quot;
levels(gss_cat$partyid)
#&gt;  [1] &quot;No answer&quot;          &quot;Don&#39;t know&quot;         &quot;Other party&quot;       
#&gt;  [4] &quot;Strong republican&quot;  &quot;Not str republican&quot; &quot;Ind,near rep&quot;      
#&gt;  [7] &quot;Independent&quot;        &quot;Ind,near dem&quot;       &quot;Not str democrat&quot;  
#&gt; [10] &quot;Strong democrat&quot;
levels(gss_cat$relig)
#&gt;  [1] &quot;No answer&quot;               &quot;Don&#39;t know&quot;             
#&gt;  [3] &quot;Inter-nondenominational&quot; &quot;Native american&quot;        
#&gt;  [5] &quot;Christian&quot;               &quot;Orthodox-christian&quot;     
#&gt;  [7] &quot;Moslem/islam&quot;            &quot;Other eastern&quot;          
#&gt;  [9] &quot;Hinduism&quot;                &quot;Buddhism&quot;               
#&gt; [11] &quot;Other&quot;                   &quot;None&quot;                   
#&gt; [13] &quot;Jewish&quot;                  &quot;Catholic&quot;               
#&gt; [15] &quot;Protestant&quot;              &quot;Not applicable&quot;
levels(gss_cat$denom)
#&gt;  [1] &quot;No answer&quot;            &quot;Don&#39;t know&quot;           &quot;No denomination&quot;     
#&gt;  [4] &quot;Other&quot;                &quot;Episcopal&quot;            &quot;Presbyterian-dk wh&quot;  
#&gt;  [7] &quot;Presbyterian, merged&quot; &quot;Other presbyterian&quot;   &quot;United pres ch in us&quot;
#&gt; [10] &quot;Presbyterian c in us&quot; &quot;Lutheran-dk which&quot;    &quot;Evangelical luth&quot;    
#&gt; [13] &quot;Other lutheran&quot;       &quot;Wi evan luth synod&quot;   &quot;Lutheran-mo synod&quot;   
#&gt; [16] &quot;Luth ch in america&quot;   &quot;Am lutheran&quot;          &quot;Methodist-dk which&quot;  
#&gt; [19] &quot;Other methodist&quot;      &quot;United methodist&quot;     &quot;Afr meth ep zion&quot;    
#&gt; [22] &quot;Afr meth episcopal&quot;   &quot;Baptist-dk which&quot;     &quot;Other baptists&quot;      
#&gt; [25] &quot;Southern baptist&quot;     &quot;Nat bapt conv usa&quot;    &quot;Nat bapt conv of am&quot; 
#&gt; [28] &quot;Am bapt ch in usa&quot;    &quot;Am baptist asso&quot;      &quot;Not applicable&quot;</code></pre>
<p>I think all are arbitrary apart from <code>rincome</code>. We also saw earlier that <code>race</code> seems to be ordered by count of observations in each category but on its own they are arbitrary - i.e. there is no order to race. There are some that are a mix, like <code>partyid</code> (the <code>No answer</code>, <code>Don't know</code> and <code>No denomination</code> are up front, but then <code>Not applicable</code> is at the end) but again these are arbitrary. For <code>partyid</code> as well it is arbitrary apart from the fact that <code>democrats</code> are near each other, <code>republicans</code> are near each other etc.</p></li>
<li><p>Why did moving “Not applicable” to the front of the levels move it to the bottom of the plot?</p>
<p>The levels are plotted from the bottom upwards, so the first level goes at the bottom, followed by the next level etc.</p></li>
</ol>
<h2>
Modify Factor Levels
</h2>
</div>
</div>
<div id="modify-factor-levels" class="section level2">
<h2>Modify Factor Levels</h2>
<p>You may also change the values of factors.</p>
<ul>
<li>good for clarifying labels for publication</li>
<li>collapse levels for high-level displays</li>
</ul>
<p><span style="color: #008080;background-color:#9FDDBA"><code>fct_recode()</code></span> allows you to recode, or change, the value of each level.</p>
<pre class="r"><code>gss_cat %&gt;% 
  count(partyid)
#&gt; # A tibble: 10 x 2
#&gt;    partyid                n
#&gt;    &lt;fct&gt;              &lt;int&gt;
#&gt;  1 No answer            154
#&gt;  2 Don&#39;t know             1
#&gt;  3 Other party          393
#&gt;  4 Strong republican   2314
#&gt;  5 Not str republican  3032
#&gt;  6 Ind,near rep        1791
#&gt;  7 Independent         4119
#&gt;  8 Ind,near dem        2499
#&gt;  9 Not str democrat    3690
#&gt; 10 Strong democrat     3490</code></pre>
<p>To <strong>change</strong> these:</p>
<pre><code class='language-r'><code>gss_cat %>% <br>&nbsp;&nbsp;mutate(partyid = <span style='background-color:#9FDDBA;color:#008080'>fct_recode</span>(partyid, # recode what?<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# <span style='background-color:#cfdad4;color:#6d6875'>new level name = old level name</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Republican, strong" = "Strong republican",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Republican, weak" = "Not str republican",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Independent, near rep" = "Ind,near rep",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Independent, near dem" = "Ind,near dem",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Democrat, weak" = "Not str democrat",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Democrat, strong" = "Strong democrat")) %>% <br>&nbsp;&nbsp;count(partyid)<br>#> # A tibble: 10 x 2<br>#> &nbsp;&nbsp;&nbsp;partyid &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n<br>#> &nbsp;&nbsp;&nbsp;<fct> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<int><br>#> &nbsp;1 No answer &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;154<br>#> &nbsp;2 Don't know &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1<br>#> &nbsp;3 Other party &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;393<br>#> &nbsp;4 Republican, strong &nbsp;&nbsp;&nbsp;&nbsp;2314<br>#> &nbsp;5 Republican, weak &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3032<br>#> &nbsp;6 Independent, near rep &nbsp;1791<br>#> &nbsp;7 Independent &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4119<br>#> &nbsp;8 Independent, near dem &nbsp;2499<br>#> &nbsp;9 Democrat, weak &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3690<br>#> 10 Democrat, strong &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3490</code></code></pre>
<p><code>fct_recode()</code> will leave levels that aren’t explicitly mentioned as is, and will warn you if you accidentally refer to a level that doesn’t exist.</p>
<p>You can also combine groups, by assigning multiple old levels to the same new level, but <span style="color: #FFE4E1;background-color:#FD5800">use with caution</span>. Combining categories that are truly independent, can lead to misleading results.</p>
<pre class="r"><code>gss_cat %&gt;% 
  mutate(partyid = fct_recode(partyid, # recode what?
      # new level name = old level name
      &quot;Republican, strong&quot; = &quot;Strong republican&quot;,
      &quot;Republican, weak&quot; = &quot;Not str republican&quot;,
      &quot;Independent, near rep&quot; = &quot;Ind,near rep&quot;,
      &quot;Independent, near dem&quot; = &quot;Ind,near dem&quot;,
      &quot;Democrat, weak&quot; = &quot;Not str democrat&quot;,
      &quot;Democrat, strong&quot; = &quot;Strong democrat&quot;,
      &quot;Other&quot; = &quot;No answer&quot;,
      &quot;Other&quot; = &quot;Don&#39;t know&quot;,
      &quot;Other&quot; = &quot;Other party&quot;)) %&gt;% 
  count(partyid)
#&gt; # A tibble: 8 x 2
#&gt;   partyid                   n
#&gt;   &lt;fct&gt;                 &lt;int&gt;
#&gt; 1 Other                   548
#&gt; 2 Republican, strong     2314
#&gt; 3 Republican, weak       3032
#&gt; 4 Independent, near rep  1791
#&gt; 5 Independent            4119
#&gt; 6 Independent, near dem  2499
#&gt; 7 Democrat, weak         3690
#&gt; 8 Democrat, strong       3490</code></pre>
<p><span style="color: #008080;background-color:#9FDDBA"><code>fct_collapse()</code></span> is a useful variant of <code>fct_recode()</code> to collapse levels. For each new variable, you provide a vector of old levels.</p>
<pre><code class='language-r'><code>gss_cat %>% <br>&nbsp;&nbsp;mutate(partyid = <span style='background-color:#9FDDBA;color:#008080'>fct_collapse</span>(partyid,<br>&nbsp;&nbsp;&nbsp;# new name = vector of old names<br>&nbsp;&nbsp;&nbsp;"other" = <span style='background-color:#9FDDBA;color:#008080'>c(</span>"No answer", "Don't know", "Other party"),<br>&nbsp;&nbsp;&nbsp;"rep" = <span style='background-color:#9FDDBA;color:#008080'>c(</span>"Strong republican", "Not str republican"),<br>&nbsp;&nbsp;&nbsp;"ind" = <span style='background-color:#9FDDBA;color:#008080'>c(</span>"Ind,near rep", "Independent", "Ind,near dem"),<br>&nbsp;&nbsp;&nbsp;"dem" = <span style='background-color:#9FDDBA;color:#008080'>c(</span>"Not str democrat", "Strong democrat"))) %>% <br>&nbsp;&nbsp;count(partyid)<br>#> # A tibble: 4 x 2<br>#> &nbsp;&nbsp;partyid &nbsp;&nbsp;&nbsp;&nbsp;n<br>#> &nbsp;&nbsp;<fct> &nbsp;&nbsp;<int><br>#> 1 other &nbsp;&nbsp;&nbsp;&nbsp;548<br>#> 2 rep &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5346<br>#> 3 ind &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8409<br>#> 4 dem &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7180</code></code></pre>
<p>Sometimes you want to <span style="color: #008080;background-color:#9FDDBA">lump together all the small groups</span> to make a plot or table simpler - enter <span style="color: #008080;background-color:#9FDDBA"><code>fct_lump()</code></span>.</p>
<pre><code class='language-r'><code>gss_cat %>% <br>&nbsp;&nbsp;mutate(relig = <span style='background-color:#9FDDBA;color:#008080'>fct_lump</span>(relig)) %>% <br>&nbsp;&nbsp;count(relig)<br>#> # A tibble: 2 x 2<br>#> &nbsp;&nbsp;relig &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n<br>#> &nbsp;&nbsp;<fct> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<int><br>#> 1 Protestant 10846<br>#> 2 Other &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10637</code></code></pre>
<p>The default method is to progressively lump together the smallest groups, ensuring that the aggregate is still the smallest group. But here it’s not very helpful since we have probably over collapsed.</p>
<p>We can use the <code>n</code> parameter to specify how many groups (including <code>Other</code>) we want to keep</p>
<pre><code class='language-r'><code>gss_cat %>% <br>&nbsp;&nbsp;mutate(relig = <span style='background-color:#9FDDBA;color:#008080'>fct_lump</span>(relig, <span style='background-color:#9FDDBA;color:#008080'>n =</span> 10)) %>% <br>&nbsp;&nbsp;count(relig, sort = TRUE) %>% <br>&nbsp;&nbsp;print(<span style='background-color:#9FDDBA;color:#008080'>n =</span> Inf)<br>#> # A tibble: 10 x 2<br>#> &nbsp;&nbsp;&nbsp;relig &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n<br>#> &nbsp;&nbsp;&nbsp;<fct> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<int><br>#> &nbsp;1 Protestant &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10846<br>#> &nbsp;2 Catholic &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5124<br>#> &nbsp;3 None &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3523<br>#> &nbsp;4 Christian &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;689<br>#> &nbsp;5 Other &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;458<br>#> &nbsp;6 Jewish &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;388<br>#> &nbsp;7 Buddhism &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;147<br>#> &nbsp;8 Inter-nondenominational &nbsp;&nbsp;109<br>#> &nbsp;9 Moslem/islam &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;104<br>#> 10 Orthodox-christian &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;95</code></code></pre>
<div id="exercises-2" class="section level3">
<h3>Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>How have the proportions of people identifying as Democrat, Republican, and Independent changed over time?</p>
<pre class="r"><code>gss_cat %&gt;% 
  count(year, sort = TRUE)
#&gt; # A tibble: 8 x 2
#&gt;    year     n
#&gt;   &lt;int&gt; &lt;int&gt;
#&gt; 1  2006  4510
#&gt; 2  2000  2817
#&gt; 3  2004  2812
#&gt; 4  2002  2765
#&gt; 5  2014  2538
#&gt; 6  2010  2044
#&gt; 7  2008  2023
#&gt; 8  2012  1974

gss_cat %&gt;% 
  mutate(partyid = fct_collapse(partyid,
    &quot;Democrat&quot; = c(&quot;Not str democrat&quot;, &quot;Strong democrat&quot;),
    &quot;Republican&quot; = c(&quot;Strong republican&quot;, 
                     &quot;Not str republican&quot;),
    &quot;Independent&quot; = c(&quot;Ind,near rep&quot;, &quot;Independent&quot;,
                      &quot;Ind,near dem&quot;),
    &quot;Other&quot; = c(&quot;No answer&quot;, &quot;Don&#39;t know&quot;, &quot;Other party&quot;))) %&gt;% 
 # filter(partyid != &quot;Other&quot;) %&gt;% 
  add_count(year, partyid) %&gt;% 
  group_by(year) %&gt;% 
  mutate(prop = n / n())  %&gt;% 
  select(year, partyid, n, prop) %&gt;% 
  distinct() %&gt;% 
  ggplot(aes(year, prop, fill = partyid)) +
    geom_col() +
    scale_fill_tq()</code></pre>
<p><img src="figure/ch12_forcats.Rmd/unnamed-chunk-34-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>It seems that both democrats and republicans have lost some members to the independent parties.</p></li>
<li><p>How could you collapse <code>rincome</code> into a small set of categories?</p>
<pre class="r"><code>gss_cat %&gt;% 
  count(rincome, sort = TRUE)
#&gt; # A tibble: 16 x 2
#&gt;    rincome            n
#&gt;    &lt;fct&gt;          &lt;int&gt;
#&gt;  1 $25000 or more  7363
#&gt;  2 Not applicable  7043
#&gt;  3 $20000 - 24999  1283
#&gt;  4 $10000 - 14999  1168
#&gt;  5 $15000 - 19999  1048
#&gt;  6 Refused          975
#&gt;  7 $1000 to 2999    395
#&gt;  8 $8000 to 9999    340
#&gt;  9 Lt $1000         286
#&gt; 10 $3000 to 3999    276
#&gt; 11 Don&#39;t know       267
#&gt; 12 $5000 to 5999    227
#&gt; 13 $4000 to 4999    226
#&gt; 14 $6000 to 6999    215
#&gt; 15 $7000 to 7999    188
#&gt; 16 No answer        183</code></pre>
<p>You could make the income bands larger in some categories.</p>
<pre class="r"><code>gss_cat %&gt;% 
  mutate(rincome = fct_collapse(rincome,
    &quot;Unknown&quot; = c(&quot;Refused&quot;, &quot;Don&#39;t know&quot;, &quot;No answer&quot;),
    &quot;$1000 to 3999&quot; = c(&quot;$1000 to 2999&quot;, 
                        &quot;$3000 to 3999&quot;),
    &quot;$4000 to 6999&quot; = c(&quot;$4000 to 4999&quot;,
                        &quot;$5000 to 5999&quot;, 
                        &quot;$6000 to 6999&quot;),
    &quot;$7000 to 9999&quot; = c(&quot;$7000 to 7999&quot;, 
                        &quot;$8000 to 9999&quot;)
  )) %&gt;% 
  mutate(rincome = fct_relevel(rincome,
                               &quot;Unknown&quot;,
                               &quot;Not applicable&quot;)) %&gt;% 
  count(rincome)
#&gt; # A tibble: 10 x 2
#&gt;    rincome            n
#&gt;    &lt;fct&gt;          &lt;int&gt;
#&gt;  1 Unknown         1425
#&gt;  2 Not applicable  7043
#&gt;  3 $25000 or more  7363
#&gt;  4 $20000 - 24999  1283
#&gt;  5 $15000 - 19999  1048
#&gt;  6 $10000 - 14999  1168
#&gt;  7 $7000 to 9999    528
#&gt;  8 $4000 to 6999    668
#&gt;  9 $1000 to 3999    671
#&gt; 10 Lt $1000         286</code></pre></li>
</ol>
<br>
<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-sessioninfo" data-toggle="collapse" data-target="#workflowr-sessioninfo" style="display: block;">
<span class="glyphicon glyphicon-wrench" aria-hidden="true"></span> Session information
</button>
</p>
<div id="workflowr-sessioninfo" class="collapse">
<pre class="r"><code>sessionInfo()
#&gt; R version 3.6.3 (2020-02-29)
#&gt; Platform: x86_64-w64-mingw32/x64 (64-bit)
#&gt; Running under: Windows 10 x64 (build 18363)
#&gt; 
#&gt; Matrix products: default
#&gt; 
#&gt; locale:
#&gt; [1] LC_COLLATE=English_South Africa.1252  LC_CTYPE=English_South Africa.1252   
#&gt; [3] LC_MONETARY=English_South Africa.1252 LC_NUMERIC=C                         
#&gt; [5] LC_TIME=English_South Africa.1252    
#&gt; 
#&gt; attached base packages:
#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     
#&gt; 
#&gt; other attached packages:
#&gt;  [1] tidyquant_1.0.0            quantmod_0.4.17           
#&gt;  [3] TTR_0.23-6                 PerformanceAnalytics_2.0.4
#&gt;  [5] xts_0.12-0                 zoo_1.8-7                 
#&gt;  [7] lubridate_1.7.9            magrittr_1.5              
#&gt;  [9] flair_0.0.2                forcats_0.5.0             
#&gt; [11] stringr_1.4.0              dplyr_1.0.2               
#&gt; [13] purrr_0.3.4                readr_1.4.0               
#&gt; [15] tidyr_1.1.2                tibble_3.0.3              
#&gt; [17] ggplot2_3.3.2              tidyverse_1.3.0           
#&gt; [19] workflowr_1.6.2           
#&gt; 
#&gt; loaded via a namespace (and not attached):
#&gt;  [1] httr_1.4.2        jsonlite_1.7.1    modelr_0.1.8      assertthat_0.2.1 
#&gt;  [5] highr_0.8         cellranger_1.1.0  yaml_2.2.1        pillar_1.4.6     
#&gt;  [9] backports_1.1.6   lattice_0.20-38   glue_1.4.2        quadprog_1.5-8   
#&gt; [13] digest_0.6.27     promises_1.1.0    rvest_0.3.6       colorspace_1.4-1 
#&gt; [17] htmltools_0.5.0   httpuv_1.5.2      pkgconfig_2.0.3   broom_0.7.2      
#&gt; [21] haven_2.3.1       scales_1.1.0      whisker_0.4       later_1.0.0      
#&gt; [25] git2r_0.26.1      generics_0.0.2    farver_2.0.3      ellipsis_0.3.1   
#&gt; [29] DT_0.16           repr_1.1.0        withr_2.2.0       skimr_2.1.1      
#&gt; [33] cli_2.1.0         crayon_1.3.4      readxl_1.3.1      evaluate_0.14    
#&gt; [37] ps_1.3.2          fs_1.5.0          fansi_0.4.1       xml2_1.3.2       
#&gt; [41] tools_3.6.3       hms_0.5.3         lifecycle_0.2.0   munsell_0.5.0    
#&gt; [45] reprex_0.3.0      compiler_3.6.3    rlang_0.4.8       grid_3.6.3       
#&gt; [49] rstudioapi_0.11   htmlwidgets_1.5.1 crosstalk_1.1.0.1 base64enc_0.1-3  
#&gt; [53] labeling_0.3      rmarkdown_2.4     gtable_0.3.0      DBI_1.1.0        
#&gt; [57] curl_4.3          R6_2.4.1          knitr_1.28        utf8_1.1.4       
#&gt; [61] rprojroot_1.3-2   Quandl_2.10.0     stringi_1.5.3     Rcpp_1.0.4.6     
#&gt; [65] vctrs_0.3.2       dbplyr_2.0.0      tidyselect_1.1.0  xfun_0.13</code></pre>
</div>
</div>
</div>
</div>


<!-- Adjust MathJax settings so that all math formulae are shown using
TeX fonts only; see
http://docs.mathjax.org/en/latest/configuration.html.  This will make
the presentation more consistent at the cost of the webpage sometimes
taking slightly longer to load. Note that this only works because the
footer is added to webpages before the MathJax javascript. -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
