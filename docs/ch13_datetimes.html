<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Vebash Naidoo" />

<meta name="date" content="2020-08-11" />

<title>Chapter 13 - Dates and Time with {lubridate}</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<link rel="icon" href="https://github.com/workflowr/workflowr-assets/raw/master/img/reproducible.png">
<!-- Add a small amount of space between sections. -->
<style type="text/css">
div.section {
  padding-top: 12px;
}
</style>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
      </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R4DS Book - Prep for exam</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="license.html">License</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Chapter 13 - Dates and Time with {lubridate}</h1>
<h4 class="author">Vebash Naidoo</h4>
<h4 class="date">08/11/2020</h4>

</div>


<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-report" data-toggle="collapse" data-target="#workflowr-report">
<span class="glyphicon glyphicon-list" aria-hidden="true"></span> workflowr <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span>
</button>
</p>
<div id="workflowr-report" class="collapse">
<ul class="nav nav-tabs">
<li class="active">
<a data-toggle="tab" href="#summary">Summary</a>
</li>
<li>
<a data-toggle="tab" href="#checks"> Checks <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> </a>
</li>
<li>
<a data-toggle="tab" href="#versions">Past versions</a>
</li>
</ul>
<div class="tab-content">
<div id="summary" class="tab-pane fade in active">
<p>
<strong>Last updated:</strong> 2020-11-21
</p>
<p>
<strong>Checks:</strong> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> 7 <span class="glyphicon glyphicon-exclamation-sign text-danger" aria-hidden="true"></span> 0
</p>
<p>
<strong>Knit directory:</strong> <code>r4ds_book/</code> <span class="glyphicon glyphicon-question-sign" aria-hidden="true" title="This is the local directory in which the code in this file was executed."> </span>
</p>
<p>
This reproducible <a href="http://rmarkdown.rstudio.com">R Markdown</a> analysis was created with <a
  href="https://github.com/jdblischak/workflowr">workflowr</a> (version 1.6.2). The <em>Checks</em> tab describes the reproducibility checks that were applied when the results were created. The <em>Past versions</em> tab lists the development history.
</p>
<hr>
</div>
<div id="checks" class="tab-pane fade">
<div id="workflowr-checks" class="panel-group">
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRMarkdownfilestronguptodate"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>R Markdown file:</strong> up-to-date </a>
</p>
</div>
<div id="strongRMarkdownfilestronguptodate" class="panel-collapse collapse">
<div class="panel-body">
<p>Great! Since the R Markdown file has been committed to the Git repository, you know the exact version of the code that produced these results.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongEnvironmentstrongempty"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Environment:</strong> empty </a>
</p>
</div>
<div id="strongEnvironmentstrongempty" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! The global environment was empty. Objects defined in the global environment can affect the analysis in your R Markdown file in unknown ways. For reproduciblity it’s best to always run the code in an empty environment.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSeedstrongcodesetseed20200814code"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Seed:</strong> <code>set.seed(20200814)</code> </a>
</p>
</div>
<div id="strongSeedstrongcodesetseed20200814code" class="panel-collapse collapse">
<div class="panel-body">
<p>The command <code>set.seed(20200814)</code> was run prior to running the code in the R Markdown file. Setting a seed ensures that any results that rely on randomness, e.g. subsampling or permutations, are reproducible.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSessioninformationstrongrecorded"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Session information:</strong> recorded </a>
</p>
</div>
<div id="strongSessioninformationstrongrecorded" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Recording the operating system, R version, and package versions is critical for reproducibility.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongCachestrongnone"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Cache:</strong> none </a>
</p>
</div>
<div id="strongCachestrongnone" class="panel-collapse collapse">
<div class="panel-body">
<p>Nice! There were no cached chunks for this analysis, so you can be confident that you successfully produced the results during this run.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongFilepathsstrongrelative"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>File paths:</strong> relative </a>
</p>
</div>
<div id="strongFilepathsstrongrelative" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Using relative paths to the files within your workflowr project makes it easier to run your code on other machines.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRepositoryversionstrongahrefhttpsgithubcomsciencificityR4DSstudyexamstree6e7b3db6d0e7fa527d843407cafe965d5f7acd67targetblank6e7b3dba"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Repository version:</strong> <a href="https://github.com/sciencificity/R4DS_study_exams/tree/6e7b3db6d0e7fa527d843407cafe965d5f7acd67" target="_blank">6e7b3db</a> </a>
</p>
</div>
<div id="strongRepositoryversionstrongahrefhttpsgithubcomsciencificityR4DSstudyexamstree6e7b3db6d0e7fa527d843407cafe965d5f7acd67targetblank6e7b3dba" class="panel-collapse collapse">
<div class="panel-body">
<p>
Great! You are using Git for version control. Tracking code development and connecting the code version to the results is critical for reproducibility.
</p>
<p>
The results in this page were generated with repository version <a href="https://github.com/sciencificity/R4DS_study_exams/tree/6e7b3db6d0e7fa527d843407cafe965d5f7acd67" target="_blank">6e7b3db</a>. See the <em>Past versions</em> tab to see a history of the changes made to the R Markdown and HTML files.
</p>
<p>
Note that you need to be careful to ensure that all relevant files for the analysis have been committed to Git prior to generating the results (you can use <code>wflow_publish</code> or <code>wflow_git_commit</code>). workflowr only checks the R Markdown file, but you know if there are other scripts or data files that it depends on. Below is the status of the Git repository when the results were generated:
</p>
<pre><code>
Ignored files:
    Ignored:    .Rproj.user/

Untracked files:
    Untracked:  analysis/images/
    Untracked:  code_snipp.txt
    Untracked:  data/at_health_facilities.csv
    Untracked:  data/infant_hiv.csv
    Untracked:  data/measurements.csv
    Untracked:  data/person.csv
    Untracked:  data/ranking.csv
    Untracked:  data/visited.csv

</code></pre>
<p>
Note that any generated files, e.g. HTML, png, CSS, etc., are not included in this status report because it is ok for generated content to have uncommitted changes.
</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div id="versions" class="tab-pane fade">

<p>
These are the previous versions of the repository in which changes were made to the R Markdown (<code>analysis/ch13_datetimes.Rmd</code>) and HTML (<code>docs/ch13_datetimes.html</code>) files. If you’ve configured a remote Git repository (see <code>?wflow_git_remote</code>), click on the hyperlinks in the table below to view the files as they were in that past version.
</p>
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
File
</th>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
<th>
Message
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/sciencificity/R4DS_study_exams/7ed0458900c1f46198c63e4abf18223bec6e4a2f/docs/ch13_datetimes.html" target="_blank">7ed0458</a>
</td>
<td>
sciencificity
</td>
<td>
2020-11-10
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/sciencificity/R4DS_study_exams/86457fa9c658cdc29f07e57c5b965859ac6c9814/docs/ch13_datetimes.html" target="_blank">86457fa</a>
</td>
<td>
sciencificity
</td>
<td>
2020-11-10
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/sciencificity/R4DS_study_exams/4879249efdfb1b6acb1c0ed5d85a58fac5eeb0c2/docs/ch13_datetimes.html" target="_blank">4879249</a>
</td>
<td>
sciencificity
</td>
<td>
2020-11-09
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/sciencificity/R4DS_study_exams/e4239674be77d3b6d016e78863ae5cf23c93a07b/docs/ch13_datetimes.html" target="_blank">e423967</a>
</td>
<td>
sciencificity
</td>
<td>
2020-11-08
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/sciencificity/R4DS_study_exams/blob/e93cfefef031fee1dfbcff30bf43ee028e4a7f30/analysis/ch13_datetimes.Rmd" target="_blank">e93cfef</a>
</td>
<td>
sciencificity
</td>
<td>
2020-11-08
</td>
<td>
finished ch13
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/sciencificity/R4DS_study_exams/0d223fb536f932b6f5957f0eb33982ea0a73d3db/docs/ch13_datetimes.html" target="_blank">0d223fb</a>
</td>
<td>
sciencificity
</td>
<td>
2020-11-08
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/sciencificity/R4DS_study_exams/blob/b67f0a772355dbf4d20909761be4300904e84662/analysis/ch13_datetimes.Rmd" target="_blank">b67f0a7</a>
</td>
<td>
sciencificity
</td>
<td>
2020-11-08
</td>
<td>
added ch13
</td>
</tr>
</tbody>
</table>
</div>
<hr>
</div>
</div>
</div>
<style type="text/css">
.tabset h2 {display: none;}
</style>
<div id="buttons" class="section level1 tabset tabset-fade tabset-pills">
<h1>Date and Times</h1>
<p><strong>Click on the tab buttons below for each section</strong></p>
<h2>
Create Date and Times
</h2>
<div id="create-date-and-times" class="section level2">
<h2>Create Date and Times</h2>
<pre class="r"><code>today()
#&gt; [1] &quot;2020-11-21&quot;
now()
#&gt; [1] &quot;2020-11-21 20:25:48 SAST&quot;</code></pre>
<div id="from-strings" class="section level3">
<h3>From Strings</h3>
<div id="dates" class="section level4">
<h4>Dates</h4>
<pre class="r"><code>ymd(&quot;2017-01-31&quot;)
#&gt; [1] &quot;2017-01-31&quot;
mdy(&quot;january 31st, 2017&quot;)
#&gt; [1] &quot;2017-01-31&quot;
dmy(&quot;31-Jan-2017&quot;)
#&gt; [1] &quot;2017-01-31&quot;
ymd(20170131)
#&gt; [1] &quot;2017-01-31&quot;</code></pre>
</div>
<div id="date-times" class="section level4">
<h4>Date Times</h4>
<pre class="r"><code>ymd_hms(&quot;2017-01-31 20:11:59&quot;)
#&gt; [1] &quot;2017-01-31 20:11:59 UTC&quot;
mdy_hm(&quot;01/31/2017 08:01&quot;)
#&gt; [1] &quot;2017-01-31 08:01:00 UTC&quot;
# force a dttm creation by supplying a tz
ymd(20170131, tz = &quot;UTC&quot;)
#&gt; [1] &quot;2017-01-31 UTC&quot;
dmy(31012017, tz = &quot;Africa/Johannesburg&quot;)
#&gt; [1] &quot;2017-01-31 SAST&quot;</code></pre>
</div>
</div>
<div id="from-individual-components" class="section level3">
<h3>From Individual Components</h3>
<p>Sometimes date and time components are scattered over multiple columns in your data. This is the case in the <code>flights</code> data.</p>
<p>You can use <span style="color: #008080;background-color:#9FDDBA"><code>make_date()</code></span> and <span style="color: #008080;background-color:#9FDDBA"><code>make_datetime()</code></span> to create a date or dttm field.</p>
<pre><code class='language-r'><code>flights %>% <br>&nbsp;&nbsp;select(year:day, hour, minute)<br>#> # A tibble: 336,776 x 5<br>#> &nbsp;&nbsp;&nbsp;&nbsp;year month &nbsp;&nbsp;day &nbsp;hour minute<br>#> &nbsp;&nbsp;&nbsp;<int> <int> <int> <dbl> &nbsp;<dbl><br>#> &nbsp;1 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;5 &nbsp;&nbsp;&nbsp;&nbsp;15<br>#> &nbsp;2 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;5 &nbsp;&nbsp;&nbsp;&nbsp;29<br>#> &nbsp;3 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;5 &nbsp;&nbsp;&nbsp;&nbsp;40<br>#> &nbsp;4 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;5 &nbsp;&nbsp;&nbsp;&nbsp;45<br>#> &nbsp;5 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0<br>#> &nbsp;6 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;5 &nbsp;&nbsp;&nbsp;&nbsp;58<br>#> &nbsp;7 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0<br>#> &nbsp;8 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0<br>#> &nbsp;9 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0<br>#> 10 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0<br>#> # ... with 336,766 more rows<br><br>flights %>% <br>&nbsp;&nbsp;select(year:day, hour, minute) %>% <br>&nbsp;&nbsp;mutate(<br>&nbsp;&nbsp;&nbsp;&nbsp;departure = <span style='background-color:#9FDDBA;color:#008080'>make_datetime</span>(year = year, month = month, day = day, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hour = hour, min = minute)<br>&nbsp;&nbsp;)<br>#> # A tibble: 336,776 x 6<br>#> &nbsp;&nbsp;&nbsp;&nbsp;year month &nbsp;&nbsp;day &nbsp;hour minute departure &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>#> &nbsp;&nbsp;&nbsp;<int> <int> <int> <dbl> &nbsp;<dbl> <dttm> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>#> &nbsp;1 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;5 &nbsp;&nbsp;&nbsp;&nbsp;15 2013-01-01 05:15:00<br>#> &nbsp;2 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;5 &nbsp;&nbsp;&nbsp;&nbsp;29 2013-01-01 05:29:00<br>#> &nbsp;3 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;5 &nbsp;&nbsp;&nbsp;&nbsp;40 2013-01-01 05:40:00<br>#> &nbsp;4 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;5 &nbsp;&nbsp;&nbsp;&nbsp;45 2013-01-01 05:45:00<br>#> &nbsp;5 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 2013-01-01 06:00:00<br>#> &nbsp;6 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;5 &nbsp;&nbsp;&nbsp;&nbsp;58 2013-01-01 05:58:00<br>#> &nbsp;7 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 2013-01-01 06:00:00<br>#> &nbsp;8 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 2013-01-01 06:00:00<br>#> &nbsp;9 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 2013-01-01 06:00:00<br>#> 10 &nbsp;2013 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 2013-01-01 06:00:00<br>#> # ... with 336,766 more rows</code></code></pre>
<pre><code class='language-r'><code>make_dttm <- function(year, month, day, time){<br>&nbsp;&nbsp;# this func will make a proper dttm for the dep_time,<br>&nbsp;&nbsp;# sched_dep_time etc.<br>&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>make_datetime</span>(year, month, day,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# divide by 100 and get the integer part - hour part<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time %/% 100,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# divide by 100 and get the remainder - minutes part<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time %% 100<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>}<br><br>(flights_dt <- flights %>% <br>&nbsp;&nbsp;filter(!is.na(dep_time), !is.na(arr_time)) %>% <br>&nbsp;&nbsp;mutate(<br>&nbsp;&nbsp;&nbsp;&nbsp;dep_time = make_dttm(year, month, day, dep_time),<br>&nbsp;&nbsp;&nbsp;&nbsp;sched_dep_time = make_dttm(year, month, day, sched_dep_time),<br>&nbsp;&nbsp;&nbsp;&nbsp;arr_time = make_dttm(year, month, day, arr_time),<br>&nbsp;&nbsp;&nbsp;&nbsp;sched_arr_time = make_dttm(year, month, day, sched_arr_time)<br>&nbsp;&nbsp;) %>% <br>&nbsp;&nbsp;select(origin, dest, ends_with("delay"), ends_with("time")))<br>#> # A tibble: 328,063 x 9<br>#> &nbsp;&nbsp;&nbsp;origin dest &nbsp;dep_delay arr_delay dep_time &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sched_dep_time &nbsp;&nbsp;&nbsp;&nbsp;<br>#> &nbsp;&nbsp;&nbsp;<chr> &nbsp;<chr> &nbsp;&nbsp;&nbsp;&nbsp;<dbl> &nbsp;&nbsp;&nbsp;&nbsp;<dbl> <dttm> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<dttm> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>#> &nbsp;1 EWR &nbsp;&nbsp;&nbsp;IAH &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;11 2013-01-01 05:17:00 2013-01-01 05:15:00<br>#> &nbsp;2 LGA &nbsp;&nbsp;&nbsp;IAH &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;20 2013-01-01 05:33:00 2013-01-01 05:29:00<br>#> &nbsp;3 JFK &nbsp;&nbsp;&nbsp;MIA &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;33 2013-01-01 05:42:00 2013-01-01 05:40:00<br>#> &nbsp;4 JFK &nbsp;&nbsp;&nbsp;BQN &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-18 2013-01-01 05:44:00 2013-01-01 05:45:00<br>#> &nbsp;5 LGA &nbsp;&nbsp;&nbsp;ATL &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-6 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-25 2013-01-01 05:54:00 2013-01-01 06:00:00<br>#> &nbsp;6 EWR &nbsp;&nbsp;&nbsp;ORD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-4 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;12 2013-01-01 05:54:00 2013-01-01 05:58:00<br>#> &nbsp;7 EWR &nbsp;&nbsp;&nbsp;FLL &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-5 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;19 2013-01-01 05:55:00 2013-01-01 06:00:00<br>#> &nbsp;8 LGA &nbsp;&nbsp;&nbsp;IAD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-3 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-14 2013-01-01 05:57:00 2013-01-01 06:00:00<br>#> &nbsp;9 JFK &nbsp;&nbsp;&nbsp;MCO &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-3 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-8 2013-01-01 05:57:00 2013-01-01 06:00:00<br>#> 10 LGA &nbsp;&nbsp;&nbsp;ORD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8 2013-01-01 05:58:00 2013-01-01 06:00:00<br>#> # ... with 328,053 more rows, and 3 more variables: arr_time <dttm>,<br>#> # &nbsp;&nbsp;sched_arr_time <dttm>, air_time <dbl><br><br>flights_dt %>% <br>&nbsp;&nbsp;ggplot(aes(dep_time)) +<br>&nbsp;&nbsp;# how's the distribution across the year looking?<br>&nbsp;&nbsp;geom_freqpoly(binwidth = 24*60*60) # binwidth = 1 day</code></code></pre>
<p><img src="figure/ch13_datetimes.Rmd/unnamed-chunk-54-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code class='language-r'><code>flights_dt %>% <br>&nbsp;&nbsp;filter(dep_time < ymd(20130102)) %>% <br>&nbsp;&nbsp;ggplot(aes(dep_time)) +<br>&nbsp;&nbsp;# how's the distribution of dep times across a day looking<br>&nbsp;&nbsp;geom_freqpoly(binwidth = 15 * 60) # how's it looking every 15 min</code></code></pre>
<p><img src="figure/ch13_datetimes.Rmd/unnamed-chunk-54-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>Note that when you use date-times in a numeric context (like in a histogram), <span style="color: #008080;background-color:#9FDDBA">1 means 1 second</span>, so <span style="color: #008080;background-color:#9FDDBA">a binwidth of 86400 means one day</span>. <strong>For dates, 1 means 1 day</strong>.</p>
</div>
<div id="from-other-types" class="section level3">
<h3>From other types</h3>
<p>You may want to switch between a <strong>date-time</strong> and a <strong>date</strong>. That’s the job of <span style="color: #008080;background-color:#9FDDBA"><code>as_datetime()</code></span> and <span style="color: #008080;background-color:#9FDDBA"><code>as_date()</code></span>.</p>
<pre><code class='language-r'><code><span style='background-color:#9FDDBA;color:#008080'><span style='background-color:#9FDDBA;color:#008080'>as_date</span>time</span>(today()) # today() returns a date, convert to dttm<br>#> [1] "2020-11-21 UTC"<br><span style='background-color:#9FDDBA;color:#008080'>as_date</span>(now()) # now() returns a dttm, convert to date<br>#> [1] "2020-11-21"</code></code></pre>
<p>Sometimes you’ll get date/times as numeric offsets from the “Unix Epoch”, 1970-01-01. If the offset is in seconds, use <code>as_datetime()</code>; if it’s in days, use <code>as_date()</code>.</p>
<pre><code class='language-r'><code>as_datetime(60 * 60 * 10) # add 10 hours to default dttm <span style='background-color:#cfdad4;color:#6d6875'>1970-01-01</span> UTC<br>#> [1] "<span style='background-color:#cfdad4;color:#6d6875'>1970-01-01</span> 10:00:00 UTC"<br>as_datetime(0) # default dttm<br>#> [1] "<span style='background-color:#cfdad4;color:#6d6875'>1970-01-01</span> UTC"<br>as_date(365 * 10 + 2) # add 10 years (365 * 10) + 2 days to get to 1980-01-01<br>#> [1] "1980-01-01"<br>as_date(365 * 10) # add 10 years - 365 days per year * 10<br>#> [1] "1979-12-30"<br>as_date(0) # default date (add 0 days)<br>#> [1] "<span style='background-color:#cfdad4;color:#6d6875'>1970-01-01</span>"<br>as_date(10) # add 10 days to default<br>#> [1] "1970-01-11"<br>make_date() # default == Unix Epoch Date<br>#> [1] "<span style='background-color:#cfdad4;color:#6d6875'>1970-01-01</span>"<br>make_datetime() # default == Unix Epoch Date<br>#> [1] "<span style='background-color:#cfdad4;color:#6d6875'>1970-01-01</span> UTC"</code></code></pre>
</div>
<div id="exercises" class="section level3">
<h3>Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>What happens if you parse a string that contains invalid dates?</p>
<pre class="r"><code>ymd(c(&quot;2010-10-10&quot;, &quot;bananas&quot;))</code></pre>
<pre class="r"><code>ymd(c(&quot;2010-10-10&quot;, &quot;bananas&quot;))
#&gt; Warning: 1 failed to parse.
#&gt; [1] &quot;2010-10-10&quot; NA</code></pre>
<p>You get a warning that some failed to parse.</p></li>
<li><p>What does the <code>tzone</code> argument to <code>today()</code> do? Why is it important?</p>
<p>The <code>today()</code> and <code>now()</code> uses your computer’s time and date. This is usually accurate for your timezone. For example I am in South Africa so you would see <em>SAST</em> when I call <code>now()</code>.</p>
<p>But you may want to do analyses that involve other timezones, or UTC itself. You can use this argument to adjust to the timezone you’re interested in.</p>
<pre class="r"><code>today()
#&gt; [1] &quot;2020-11-21&quot;
(utc_today &lt;- today(tzone = &quot;UTC&quot;))
#&gt; [1] &quot;2020-11-21&quot;
utc_today == today()
#&gt; [1] TRUE
utc_today == today(tzone = &quot;GMT&quot;)
#&gt; [1] TRUE
now()
#&gt; [1] &quot;2020-11-21 20:25:54 SAST&quot;
now(&quot;UTC&quot;)
#&gt; [1] &quot;2020-11-21 18:25:54 UTC&quot;</code></pre></li>
<li><p>Use the appropriate lubridate function to parse each of the following dates:</p>
<pre class="r"><code>d1 &lt;- &quot;January 1, 2010&quot;
mdy(d1)
#&gt; [1] &quot;2010-01-01&quot;
d2 &lt;- &quot;2015-Mar-07&quot;
ymd(d2)
#&gt; [1] &quot;2015-03-07&quot;
d3 &lt;- &quot;06-Jun-2017&quot;
dmy(d3)
#&gt; [1] &quot;2017-06-06&quot;
d4 &lt;- c(&quot;August 19 (2015)&quot;, &quot;July 1 (2015)&quot;)
mdy(d4)
#&gt; [1] &quot;2015-08-19&quot; &quot;2015-07-01&quot;
d5 &lt;- &quot;12/30/14&quot; # Dec 30, 2014
mdy(d5)
#&gt; [1] &quot;2014-12-30&quot;</code></pre></li>
</ol>
<h2>
Date-time components
</h2>
</div>
</div>
<div id="date-time-components" class="section level2">
<h2>Date-time components</h2>
<p>We will focus on the accessor functions that let you get and set individual components.</p>
<div id="getting-components" class="section level3">
<h3>Getting components</h3>
<ul>
<li><code>year()</code></li>
<li><code>month()</code></li>
<li><code>mday()</code> (day of the month)</li>
<li><code>yday()</code> (day of the year)</li>
<li><code>wday()</code> (day of the week)</li>
<li><code>hour()</code>, <code>minute()</code>, and <code>second()</code></li>
</ul>
<pre><code class='language-r'><code>(datetime <- ymd_hms("2016-07-08 12:34:56"))<br>#> [1] "2016-07-08 12:34:56 UTC"<br><span style='background-color:#9FDDBA;color:#008080'>year</span>(datetime)<br>#> [1] 2016<br><br><span style='background-color:#9FDDBA;color:#008080'>month</span>(datetime)<br>#> [1] 7<br><br><span style='background-color:#9FDDBA;color:#008080'>mday</span>(datetime)<br>#> [1] 8<br><br><span style='background-color:#9FDDBA;color:#008080'>yday</span>(datetime)<br>#> [1] 190<br><br><span style='background-color:#9FDDBA;color:#008080'>wday</span>(datetime)<br>#> [1] 6<br><br><span style='background-color:#9FDDBA;color:#008080'>wday</span>(datetime, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='background-color:#cfdad4;color:#6d6875'>label = TRUE</span>) # abbreviated weekday day instead of number<br>#> [1] Fri<br>#> Levels: Sun < Sat<br><br>wday(datetime, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label = TRUE, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;abbr = FALSE) # full weekday name <br>#> [1] Friday<br>#> 7 Levels: Sunday < Saturday<br><br>hour(datetime)<br>#> [1] 12<br><br><span style='background-color:#9FDDBA;color:#008080'>minute</span>(datetime)<br>#> [1] 34<br><br><span style='background-color:#9FDDBA;color:#008080'>second</span>(datetime)<br>#> [1] 56<br><br><span style='background-color:#9FDDBA;color:#008080'>month</span>(datetime, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='background-color:#cfdad4;color:#6d6875'>label = TRUE</span>) # abbreviated <span style='background-color:#9FDDBA;color:#008080'>month</span> name instead of number<br>#> [1] Jul<br>#> 12 Levels: Jan < Dec<br><br>month(datetime, label = TRUE, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;abbr = FALSE) # full month name instead of number<br>#> [1] July<br>#> 12 Levels: January</code></code></pre>
<pre class="r"><code>(current_dt &lt;- now())
#&gt; [1] &quot;2020-11-21 20:25:54 SAST&quot;
year(current_dt)
#&gt; [1] 2020
month(current_dt)
#&gt; [1] 11
mday(current_dt)
#&gt; [1] 21
yday(current_dt)
#&gt; [1] 326
wday(current_dt) # sunday
#&gt; [1] 7
wday(current_dt, 
     label = TRUE) # abbreviated weekday day instead of number
#&gt; [1] Sat
#&gt; Levels: Sun &lt; Mon &lt; Tue &lt; Wed &lt; Thu &lt; Fri &lt; Sat
wday(current_dt, 
     label = TRUE, 
     abbr = FALSE) # full weekday name 
#&gt; [1] Saturday
#&gt; 7 Levels: Sunday &lt; Monday &lt; Tuesday &lt; Wednesday &lt; Thursday &lt; ... &lt; Saturday
hour(current_dt)
#&gt; [1] 20
minute(current_dt)
#&gt; [1] 25
second(current_dt)
#&gt; [1] 54.85329
month(current_dt, 
      label = TRUE) # abbreviated month name instead of number
#&gt; [1] Nov
#&gt; 12 Levels: Jan &lt; Feb &lt; Mar &lt; Apr &lt; May &lt; Jun &lt; Jul &lt; Aug &lt; Sep &lt; ... &lt; Dec
month(current_dt, label = TRUE, 
      abbr = FALSE) # full month name instead of number
#&gt; [1] November
#&gt; 12 Levels: January &lt; February &lt; March &lt; April &lt; May &lt; June &lt; ... &lt; December</code></pre>
<pre class="r"><code># wday() shows that more flights depart in the week
flights_dt %&gt;% 
  mutate(wday = wday(dep_time, label = TRUE)) %&gt;% 
  ggplot(aes(x = wday)) +
  geom_bar()</code></pre>
<p><img src="figure/ch13_datetimes.Rmd/unnamed-chunk-15-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code># interesting that flights at certain minutes in
# an hour experience lower delays
flights_dt %&gt;% 
  mutate(minute = minute(dep_time)) %&gt;% 
  group_by(minute) %&gt;% 
  summarise(avg_delay = mean(dep_delay, na.rm = TRUE),
            n = n()) %&gt;% 
  ggplot(aes(minute, avg_delay)) +
  geom_line() +
  geom_point(aes(size = n))</code></pre>
<p><img src="figure/ch13_datetimes.Rmd/unnamed-chunk-16-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code># the scheduled departure time, does not show such
(sched_dep &lt;- flights_dt %&gt;% 
  mutate(minute = minute(sched_dep_time)) %&gt;% 
  group_by(minute) %&gt;% 
  summarise(avg_delay = mean(dep_delay, na.rm = TRUE),
            n = n())) 
#&gt; # A tibble: 60 x 3
#&gt;    minute avg_delay     n
#&gt;     &lt;int&gt;     &lt;dbl&gt; &lt;int&gt;
#&gt;  1      0      8.82 59019
#&gt;  2      1     16.6   2085
#&gt;  3      2     12.9    818
#&gt;  4      3     19.8   1381
#&gt;  5      4     16.8   1323
#&gt;  6      5     12.5  13720
#&gt;  7      6     17.8   1345
#&gt;  8      7     14.5   1068
#&gt;  9      8     12.0   1649
#&gt; 10      9     18.5   1411
#&gt; # ... with 50 more rows

sched_dep %&gt;% 
  ggplot(aes(minute, avg_delay)) +
  geom_line() +
  geom_point(aes(size = n))</code></pre>
<p><img src="figure/ch13_datetimes.Rmd/unnamed-chunk-17-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>
sched_dep %&gt;% 
  ggplot(aes(minute, n)) +
  geom_line()</code></pre>
<p><img src="figure/ch13_datetimes.Rmd/unnamed-chunk-17-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>You may also round a date to a nearby unit of time, with <code>floor_date()</code>, <code>round_date()</code>, and <code>ceiling_date()</code>.</p>
<p>Each function takes a vector of dates to change, and then the name of the unit to round down (floor), round up (ceiling), or round to.</p>
<pre><code class='language-r'><code>(x <- ymd_hms("2020-08-08 12:01:59.93")) # Saturday 8th Aug<br>#> [1] "2020-08-08 12:01:59 UTC"<br><br>round_date(x, ".5s")<br>#> [1] "2020-08-08 12:02:00 UTC"<br><br>round_date(x, "sec")<br>#> [1] "2020-08-08 12:02:00 UTC"<br><br>round_date(x, "second")<br>#> [1] "2020-08-08 12:02:00 UTC"<br><br>round_date(x, "minute")<br>#> [1] "2020-08-08 12:02:00 UTC"<br><br>round_date(x, "5 mins")<br>#> [1] "2020-08-08 12:00:00 UTC"<br><br><span style='background-color:#9FDDBA;color:#008080'>round_date(x, "hour")</span><br>#> [1] "2020-08-08 12:00:00 UTC"<br><br>round_date(x, "2 hours")<br>#> [1] "2020-08-08 12:00:00 UTC"<br><br>round_date(x, "day") # it's past afternoon so closer to tomorrow<br>#> [1] "2020-08-09 UTC"<br><br>round_date(x, "week")<br>#> [1] "2020-08-09 UTC"<br><br>round_date(x, "month")<br>#> [1] "2020-08-01 UTC"<br><br>round_date(x, "bimonth") # 1,3,5,7,9,11 are the bimonths<br>#> [1] "2020-09-01 UTC"<br><br>round_date(x, "quarter")<br>#> [1] "2020-07-01 UTC"<br><br>round_date(x, "quarter") == round_date(x, "3 months")<br>#> [1] TRUE<br><br>round_date(x, "halfyear")<br>#> [1] "2020-07-01 UTC"<br><br>round_date(x, "year")<br>#> [1] "2021-01-01 UTC"<br><br>round_date(x, "season")<br>#> [1] "2020-09-01 UTC"</code></code></pre>
<pre><code class='language-r'><code>(x <- ymd_hms("2020-08-08 12:01:59.93")) # Saturday 8th Aug<br>#> [1] "2020-08-08 12:01:59 UTC"<br><br>floor_date(x, ".5s")<br>#> [1] "2020-08-08 12:01:59 UTC"<br><br>floor_date(x, "sec")<br>#> [1] "2020-08-08 12:01:59 UTC"<br><br>floor_date(x, "second")<br>#> [1] "2020-08-08 12:01:59 UTC"<br><br>floor_date(x, "minute")<br>#> [1] "2020-08-08 12:01:00 UTC"<br><br>floor_date(x, "5 mins")<br>#> [1] "2020-08-08 12:00:00 UTC"<br><br><span style='background-color:#9FDDBA;color:#008080'>floor_date(x, "hour")</span><br>#> [1] "2020-08-08 12:00:00 UTC"<br><br>floor_date(x, "2 hours")<br>#> [1] "2020-08-08 12:00:00 UTC"<br><br>floor_date(x, "day") # floor of date hence still today even though closer to tomorrow<br>#> [1] "2020-08-08 UTC"<br><br>floor_date(x, "week") # floor so last sunday NOT tomorrow<br>#> [1] "2020-08-02 UTC"<br><br>floor_date(x, "month")<br>#> [1] "2020-08-01 UTC"<br><br>floor_date(x, "bimonth") # 1,3,5,7,9,11 are the bimonths<br>#> [1] "2020-07-01 UTC"<br><br>floor_date(x, "quarter")<br>#> [1] "2020-07-01 UTC"<br><br>floor_date(x, "quarter") == floor_date(x, "3 months")<br>#> [1] TRUE<br><br>floor_date(x, "halfyear")<br>#> [1] "2020-07-01 UTC"<br><br>floor_date(x, "year")<br>#> [1] "2020-01-01 UTC"<br><br>floor_date(x, "season")<br>#> [1] "2020-06-01 UTC"</code></code></pre>
<pre><code class='language-r'><code>(x <- ymd_hms("2020-08-08 12:01:59.93")) # Saturday 8th Aug<br>#> [1] "2020-08-08 12:01:59 UTC"<br><br>ceiling_date(x, ".5s")<br>#> [1] "2020-08-08 12:02:00 UTC"<br><br>ceiling_date(x, "sec")<br>#> [1] "2020-08-08 12:02:00 UTC"<br><br>ceiling_date(x, "second")<br>#> [1] "2020-08-08 12:02:00 UTC"<br><br>ceiling_date(x, "minute")<br>#> [1] "2020-08-08 12:02:00 UTC"<br><br>ceiling_date(x, "5 mins")<br>#> [1] "2020-08-08 12:05:00 UTC"<br><br><span style='background-color:#9FDDBA;color:#008080'>ceiling_date(x, "hour")</span><br>#> [1] "2020-08-08 13:00:00 UTC"<br><br>ceiling_date(x, "2 hours")<br>#> [1] "2020-08-08 14:00:00 UTC"<br><br>ceiling_date(x, "day") # ceiling of date hence tomorrow<br>#> [1] "2020-08-09 UTC"<br><br># ceiling so tomorrow which is start of new week<br># Sunday 9th August 2020<br>ceiling_date(x, "week") <br>#> [1] "2020-08-09 UTC"<br><br>ceiling_date(x, "month")<br>#> [1] "2020-09-01 UTC"<br><br>ceiling_date(x, "bimonth") # 1,3,5,7,9,11 are the bimonths<br>#> [1] "2020-09-01 UTC"<br><br>ceiling_date(x, "quarter")<br>#> [1] "2020-10-01 UTC"<br><br>ceiling_date(x, "quarter") == ceiling_date(x, "3 months")<br>#> [1] TRUE<br><br>ceiling_date(x, "halfyear")<br>#> [1] "2021-01-01 UTC"<br><br>ceiling_date(x, "year")<br>#> [1] "2021-01-01 UTC"<br><br>ceiling_date(x, "season")<br>#> [1] "2020-09-01 UTC"</code></code></pre>
</div>
<div id="setting-components" class="section level3">
<h3>Setting components</h3>
<p>You can also use each accessor function to set the components of a date/time. Note that the accessor functions now appear on the left hand side of <code>&lt;-</code>.</p>
<pre><code class='language-r'><code>(datetime <- ymd_hms("2016-07-08 12:34:56"))<br>#> [1] "2016-07-08 12:34:56 UTC"<br><br># change year<br><span style='background-color:#9FDDBA;color:#008080'>year(datetime) <-</span> 2020<br>datetime<br>#> [1] "2020-07-08 12:34:56 UTC"<br><br># change month<br><span style='background-color:#9FDDBA;color:#008080'>month(datetime) <-</span> 01<br>datetime<br>#> [1] "2020-01-08 12:34:56 UTC"<br><br># progress time by 1 hr<br>hour(datetime) <- hour(datetime) + 1<br>datetime<br>#> [1] "2020-01-08 13:34:56 UTC"</code></code></pre>
<p>Alternatively, rather than modifying in place, you can create a new date-time with <code>update()</code>. This also allows you to set multiple values at once.</p>
<pre><code class='language-r'><code><span style='background-color:#9FDDBA;color:#008080'>update</span>(datetime,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;year = 2020,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;month = 02,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mday = 02,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hour = 15)<br>#> [1] "2020-02-02 15:34:56 UTC"<br><br>datetime<br>#> [1] "2020-01-08 13:34:56 UTC"<br><br># entered a too big date / hour / min? <br># these roll over<br>ymd("2020-02-27") %>% <br>&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>update</span>(mday = 29)<br>#> [1] "2020-02-29"<br><br>ymd("2020-02-27") %>% <br>&nbsp;&nbsp;<span style='background-color:#9FDDBA;color:#008080'>update</span>(mday = 30, hour = 22,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min = 65)<br>#> [1] "2020-03-01 23:05:00 UTC"</code></code></pre>
<pre class="r"><code>flights_dt %&gt;% 
  # ignore the date, let&#39;s make a new date that pulls all observations
  # back to the 1st of Jan
  mutate(dep_hour = update(dep_time, yday = 1)) %&gt;% 
  arrange(desc(sched_dep_time)) %&gt;% 
  head(10) %&gt;% 
  print(width = Inf)
#&gt; # A tibble: 10 x 10
#&gt;    origin dest  dep_delay arr_delay dep_time            sched_dep_time     
#&gt;    &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dttm&gt;              &lt;dttm&gt;             
#&gt;  1 JFK    BQN          14         2 2013-12-31 00:13:00 2013-12-31 23:59:00
#&gt;  2 JFK    SJU          19         5 2013-12-31 00:18:00 2013-12-31 23:59:00
#&gt;  3 JFK    SJU          -4       -10 2013-12-31 23:55:00 2013-12-31 23:59:00
#&gt;  4 JFK    PSE          -3        -9 2013-12-31 23:56:00 2013-12-31 23:59:00
#&gt;  5 EWR    SJU          -2         3 2013-12-31 23:28:00 2013-12-31 23:30:00
#&gt;  6 JFK    BOS          15        11 2013-12-31 23:10:00 2013-12-31 22:55:00
#&gt;  7 JFK    SYR          -5         3 2013-12-31 22:45:00 2013-12-31 22:50:00
#&gt;  8 JFK    BUF          31        38 2013-12-31 23:21:00 2013-12-31 22:50:00
#&gt;  9 JFK    PWM         101        96 2013-12-31 00:26:00 2013-12-31 22:45:00
#&gt; 10 JFK    BTV         -10        -4 2013-12-31 22:35:00 2013-12-31 22:45:00
#&gt;    arr_time            sched_arr_time      air_time dep_hour           
#&gt;    &lt;dttm&gt;              &lt;dttm&gt;                 &lt;dbl&gt; &lt;dttm&gt;             
#&gt;  1 2013-12-31 04:39:00 2013-12-31 04:37:00      189 2013-01-01 00:13:00
#&gt;  2 2013-12-31 04:49:00 2013-12-31 04:44:00      192 2013-01-01 00:18:00
#&gt;  3 2013-12-31 04:30:00 2013-12-31 04:40:00      195 2013-01-01 23:55:00
#&gt;  4 2013-12-31 04:36:00 2013-12-31 04:45:00      200 2013-01-01 23:56:00
#&gt;  5 2013-12-31 04:12:00 2013-12-31 04:09:00      198 2013-01-01 23:28:00
#&gt;  6 2013-12-31 00:07:00 2013-12-31 23:56:00       40 2013-01-01 23:10:00
#&gt;  7 2013-12-31 23:59:00 2013-12-31 23:56:00       51 2013-01-01 22:45:00
#&gt;  8 2013-12-31 00:46:00 2013-12-31 00:08:00       66 2013-01-01 23:21:00
#&gt;  9 2013-12-31 01:29:00 2013-12-31 23:53:00       50 2013-01-01 00:26:00
#&gt; 10 2013-12-31 23:51:00 2013-12-31 23:55:00       49 2013-01-01 22:35:00

# let&#39;s visualise how many flights leave at different hours in 
# the day by pretending all flights occurred on the same day
# the 1st Jan
flights_dt %&gt;% 
  mutate(dep_hour = update(dep_time, yday = 1)) %&gt;% 
  ggplot(aes(dep_hour)) +
  geom_freqpoly(binwidth = 60 * 5) # every 5 min</code></pre>
<p><img src="figure/ch13_datetimes.Rmd/unnamed-chunk-23-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="exercises-1" class="section level3">
<h3>Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>How does the distribution of flight times within a day change over the course of the year?</p>
<pre class="r"><code># devtools::install_github(&quot;sciencificity/werpals&quot;)
library(werpals)
flights_dt %&gt;% 
  mutate(month = factor(month(dep_time)),
         dep_hour = update(dep_time, yday = 1)) %&gt;% 
  ggplot(aes(dep_hour, colour = month)) +
  geom_freqpoly(binwidth = 60 * 30) +
  scale_colour_nature(palette = &quot;bryce&quot;)</code></pre>
<p><img src="figure/ch13_datetimes.Rmd/unnamed-chunk-24-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Feb is lower but it has less days as well.</p></li>
<li><p>Compare <code>dep_time</code>, <code>sched_dep_time</code> and <code>dep_delay</code>. Are they consistent? Explain your findings.</p>
<p>The <span class="math inline">\(sched\_dep\_time + dep\_delay = dep\_time\)</span>. It does for most observations but there is a handful that does not meet this relationship.</p>
<pre class="r"><code>flights %&gt;% 
  select(year, month, day, hour, minute, dep_time, sched_dep_time,
         dep_delay)
#&gt; # A tibble: 336,776 x 8
#&gt;     year month   day  hour minute dep_time sched_dep_time dep_delay
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
#&gt;  1  2013     1     1     5     15      517            515         2
#&gt;  2  2013     1     1     5     29      533            529         4
#&gt;  3  2013     1     1     5     40      542            540         2
#&gt;  4  2013     1     1     5     45      544            545        -1
#&gt;  5  2013     1     1     6      0      554            600        -6
#&gt;  6  2013     1     1     5     58      554            558        -4
#&gt;  7  2013     1     1     6      0      555            600        -5
#&gt;  8  2013     1     1     6      0      557            600        -3
#&gt;  9  2013     1     1     6      0      557            600        -3
#&gt; 10  2013     1     1     6      0      558            600        -2
#&gt; # ... with 336,766 more rows
flights_dt %&gt;% 
  select(dep_time, sched_dep_time,
         dep_delay) %&gt;% 
  mutate(act_dep_time = sched_dep_time + 
           hms(str_glue(&quot;0, {dep_delay}, 0&quot;))) %&gt;% 
  filter(dep_time != act_dep_time)
#&gt; # A tibble: 1,205 x 4
#&gt;    dep_time            sched_dep_time      dep_delay act_dep_time       
#&gt;    &lt;dttm&gt;              &lt;dttm&gt;                  &lt;dbl&gt; &lt;dttm&gt;             
#&gt;  1 2013-01-01 08:48:00 2013-01-01 18:35:00       853 2013-01-02 08:48:00
#&gt;  2 2013-01-02 00:42:00 2013-01-02 23:59:00        43 2013-01-03 00:42:00
#&gt;  3 2013-01-02 01:26:00 2013-01-02 22:50:00       156 2013-01-03 01:26:00
#&gt;  4 2013-01-03 00:32:00 2013-01-03 23:59:00        33 2013-01-04 00:32:00
#&gt;  5 2013-01-03 00:50:00 2013-01-03 21:45:00       185 2013-01-04 00:50:00
#&gt;  6 2013-01-03 02:35:00 2013-01-03 23:59:00       156 2013-01-04 02:35:00
#&gt;  7 2013-01-04 00:25:00 2013-01-04 23:59:00        26 2013-01-05 00:25:00
#&gt;  8 2013-01-04 01:06:00 2013-01-04 22:45:00       141 2013-01-05 01:06:00
#&gt;  9 2013-01-05 00:14:00 2013-01-05 23:59:00        15 2013-01-06 00:14:00
#&gt; 10 2013-01-05 00:37:00 2013-01-05 22:30:00       127 2013-01-06 00:37:00
#&gt; # ... with 1,195 more rows</code></pre></li>
<li><p>Compare <code>air_time</code> with the duration between the departure and arrival. Explain your findings. (Hint: consider the location of the airport.)</p>
<pre class="r"><code>flights_dt %&gt;% 
  select(origin, dest, dep_time, arr_time, air_time) %&gt;% 
  filter(!is.na(air_time), !is.na(dep_time), 
         !is.na(arr_time)) %&gt;% 
  mutate(dest_same_tz = dep_time + 
           hms(str_glue(&quot;0, {air_time}, 0&quot;))) %&gt;% 
  filter(arr_time == dest_same_tz)
#&gt; # A tibble: 196 x 6
#&gt;    origin dest  dep_time            arr_time            air_time
#&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;dttm&gt;              &lt;dttm&gt;                 &lt;dbl&gt;
#&gt;  1 LGA    BNA   2013-01-07 11:50:00 2013-01-07 13:41:00      111
#&gt;  2 EWR    MSP   2013-01-13 19:47:00 2013-01-13 22:18:00      151
#&gt;  3 LGA    MDW   2013-01-16 06:51:00 2013-01-16 09:14:00      143
#&gt;  4 EWR    HOU   2013-01-16 07:07:00 2013-01-16 11:06:00      239
#&gt;  5 LGA    BNA   2013-01-16 09:43:00 2013-01-16 12:11:00      148
#&gt;  6 LGA    BNA   2013-01-25 16:19:00 2013-01-25 18:26:00      127
#&gt;  7 EWR    ORD   2013-01-30 10:16:00 2013-01-30 12:34:00      138
#&gt;  8 EWR    ORD   2013-01-30 14:19:00 2013-01-30 16:14:00      115
#&gt;  9 EWR    ORD   2013-01-30 21:55:00 2013-01-30 23:47:00      112
#&gt; 10 LGA    ORD   2013-10-02 18:53:00 2013-10-02 20:45:00      112
#&gt; # ... with 186 more rows, and 1 more variable: dest_same_tz &lt;dttm&gt;</code></pre>
<p>There are only a few where the <span class="math inline">\(dep\_time + air\_time = arr\_time\)</span>. If you look at the dest vs the origin I would have suspected that the airports in the same timezone align but LGA and ORD are different timezones and they align, LGA and BNA also and others too. So truly I am unsure without further digging.</p></li>
<li><p>How does the average delay time change over the course of a day? Should you use <code>dep_time</code> or <code>sched_dep_time</code>? Why?</p>
<pre class="r"><code>flights_dt %&gt;% 
  mutate(sched_dep_hr = update(sched_dep_time, yday = 1),
         hr_day = hour(sched_dep_hr)) %&gt;% 
  group_by(hr_day) %&gt;% 
  summarise(avg_delay = mean(dep_delay, na.rm = TRUE),
            n = n()) %&gt;% 
  ggplot(aes(hr_day, avg_delay)) +
  geom_point(aes(size = n)) +
  geom_line()</code></pre>
<p><img src="figure/ch13_datetimes.Rmd/unnamed-chunk-27-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>I used <code>sched_dep_time</code> since that is when the flight should have left and is a more accurate reflection of how delay time changes over the course of a day.</p></li>
<li><p>On what day of the week should you leave if you want to minimise the chance of a delay?</p>
<pre class="r"><code>flights_dt %&gt;% 
  mutate(day_of_week = wday(sched_dep_time, abbr = TRUE, label = TRUE)) %&gt;% 
  group_by(day_of_week) %&gt;% 
  summarise(avg_delay = mean(dep_delay, na.rm = TRUE),
            n = n()) %&gt;% 
  ggplot(aes(day_of_week, avg_delay)) +
  geom_col()</code></pre>
<p><img src="figure/ch13_datetimes.Rmd/unnamed-chunk-28-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>You best leave on Saturday.</p></li>
<li><p>What makes the distribution of <code>diamonds$carat</code> and <code>flights$sched_dep_time</code> similar?</p>
<pre class="r"><code>diamonds %&gt;% 
  count(carat, sort = TRUE)
#&gt; # A tibble: 273 x 2
#&gt;    carat     n
#&gt;    &lt;dbl&gt; &lt;int&gt;
#&gt;  1  0.3   2604
#&gt;  2  0.31  2249
#&gt;  3  1.01  2242
#&gt;  4  0.7   1981
#&gt;  5  0.32  1840
#&gt;  6  1     1558
#&gt;  7  0.9   1485
#&gt;  8  0.41  1382
#&gt;  9  0.4   1299
#&gt; 10  0.71  1294
#&gt; # ... with 263 more rows

flights_dt %&gt;% 
  mutate(sched_min = minute(sched_dep_time)) %&gt;% 
  count(sched_min, sort = TRUE)
#&gt; # A tibble: 60 x 2
#&gt;    sched_min     n
#&gt;        &lt;int&gt; &lt;int&gt;
#&gt;  1         0 59019
#&gt;  2        30 33104
#&gt;  3        45 19923
#&gt;  4        15 18393
#&gt;  5        55 18347
#&gt;  6        59 15882
#&gt;  7        10 14162
#&gt;  8        25 14057
#&gt;  9         5 13720
#&gt; 10        29 13482
#&gt; # ... with 50 more rows

# out of curiosity how does actual dep_time look?
flights_dt %&gt;% 
  mutate(min = minute(dep_time)) %&gt;% 
  count(min, sort = TRUE)
#&gt; # A tibble: 60 x 2
#&gt;      min     n
#&gt;    &lt;int&gt; &lt;int&gt;
#&gt;  1    55 10097
#&gt;  2    54  9366
#&gt;  3    56  9161
#&gt;  4    57  8878
#&gt;  5    58  8433
#&gt;  6    53  8378
#&gt;  7    59  7500
#&gt;  8    52  7422
#&gt;  9     0  7160
#&gt; 10    25  6918
#&gt; # ... with 50 more rows</code></pre>
<p>More flights are scheduled at round numbers that we talk about often; quarter past, half past, 6 ’o clock, etc. The actual departure time is much less aligned with how we talk. We don’t usually talk about out flight being 54 minutes past 5! Except when we were kids learning to tell time, then we’re very precise (ask my 6yo who keeps reminding me when I say it’s nearly half past 8 and time for bed, that actually it is only 8:26 so he has 4 more minutes 😆).</p>
<p>For carats it is similar 0.3, 0.7, 0.4 but there are some anomalies for example 0.32 or 0.31 or even 1.01.</p></li>
<li><p>Confirm my hypothesis that the early departures of flights in minutes 20-30 and 50-60 are caused by scheduled flights that leave early. Hint: create a binary variable that tells you whether or not a flight was delayed.</p>
<pre class="r"><code>flights_dt %&gt;% 
  filter(!is.na(dep_delay)) %&gt;% 
  mutate(early = dep_delay &lt; 0,
         dep_min = minute(update(dep_time, yday = 1))) %&gt;% 
  ggplot(aes(dep_min, fill = early)) +
  geom_bar() +
  scale_fill_disney(palette = &quot;pan&quot;)</code></pre>
<p><img src="figure/ch13_datetimes.Rmd/unnamed-chunk-30-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The flights that leave in minutes <code>22 - 29</code> and <code>49 - 59</code> do leave earlier than scheduled.</p></li>
</ol>
<h2>
Time spans
</h2>
</div>
</div>
<div id="time-spans" class="section level2">
<h2>Time spans</h2>
<p>Now we’re gonna see how arithmetic with dates works and learn about three important classes that represent time spans:</p>
<ul>
<li><strong>durations</strong>, which represent an exact number of seconds.</li>
<li><strong>periods</strong>, which represent human units like weeks and months.</li>
<li><strong>intervals</strong>, which represent a starting and ending point.</li>
</ul>
<div id="durations" class="section level3">
<h3>Durations</h3>
<p>When we subtract two dates, we get a <code>difftime</code> object.</p>
<pre class="r"><code># How old is Hadley?
(h_age &lt;- today() - ymd(19791014))
#&gt; Time difference of 15014 days</code></pre>
<p>A <code>difftime</code> class object records a time span of</p>
<ul>
<li>seconds,</li>
<li>minutes,</li>
<li>hours,</li>
<li>days, or</li>
<li>weeks.</li>
</ul>
<p>The ambiguity can make <code>difftimes</code> painful to work with, so {lubridate} provides an alternative which always uses seconds: the <strong>duration</strong>.</p>
<pre class="r"><code>as.duration(h_age)
#&gt; [1] &quot;1297209600s (~41.11 years)&quot;</code></pre>
<div id="duration-constructors" class="section level4">
<h4>Duration constructors</h4>
<pre><code class='language-r'><code><span style='background-color:#9FDDBA;color:#008080'>ds</span>econ<span style='background-color:#9FDDBA;color:#008080'>ds</span>(15)<br>#> [1] "15s"<br><br><span style='background-color:#9FDDBA;color:#008080'>dm</span>inutes(10)<br>#> [1] "600s (~10 minutes)"<br><br><span style='background-color:#9FDDBA;color:#008080'>dh</span>ours(c(12,24))<br>#> [1] "43200s (~12 hours)" "86400s (~1 days)"<br><br><span style='background-color:#9FDDBA;color:#008080'>dd</span>ays(0:5)<br>#> [1] "0s" &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"86400s (~1 days)" &nbsp;"172800s (~2 days)"<br>#> [4] "259200s (~3 days)" "345600s (~4 days)" "432000s (~5 days)"<br><br><span style='background-color:#9FDDBA;color:#008080'>dw</span>eeks(3)<br>#> [1] "1814400s (~3 weeks)"<br><br><span style='background-color:#9FDDBA;color:#008080'>dw</span>eeks(3) == 24 * 60 * 60 * 7 * 3 # 24 hrs, 60 min, 60 s in each min, 7 days, 3 weeks<br>#> [1] TRUE<br><br><span style='background-color:#9FDDBA;color:#008080'>dy</span>ears(1)<br>#> [1] "31557600s (~1 years)"</code></code></pre>
<p>Durations always record the time span in seconds. Larger units are converted using standard rules e.g. 60 seconds in a minute, 60 minutes in an hour, 24 hours in day, 7 days in a week, and 365 days in a year. Notice all duration constructors start with <strong>d</strong> and end with <strong>s</strong> (i.e. the plural of each time span - <strong>d</strong>day<strong>s</strong>)</p>
</div>
<div id="duration-arithmetic" class="section level4">
<h4>Duration Arithmetic</h4>
<p>You can add and multiply durations.</p>
<pre class="r"><code>2 * dyears(1)
#&gt; [1] &quot;63115200s (~2 years)&quot;
dyears(2)
#&gt; [1] &quot;63115200s (~2 years)&quot;

dyears(1)  + dweeks(12) + dhours(15)
#&gt; [1] &quot;38869200s (~1.23 years)&quot;</code></pre>
<p>We can also add and subtract durations to and from dates.</p>
<pre class="r"><code>(tomorrow &lt;- today() + ddays(1))
#&gt; [1] &quot;2020-11-22&quot;
(last_yr &lt;- year(today() - dyears(1)))
#&gt; [1] 2019</code></pre>
<p>But durations represent an exact number of seconds, and hence sometimes you might get unexpected results, especially with daylight savings etc. that complicate date time arithmetic.</p>
<pre class="r"><code>(one_pm &lt;- ymd_hms(&quot;2016-03-12 13:00:00&quot;,
                  tz = &quot;America/New_York&quot;))
#&gt; [1] &quot;2016-03-12 13:00:00 EST&quot;
one_pm + ddays(1)
#&gt; [1] &quot;2016-03-13 14:00:00 EDT&quot;</code></pre>
<p>One day after 1pm on March 12, is 2pm on March 13?! 😕 The tz has changed from EST to EDT due to daylight savings time.</p>
</div>
</div>
<div id="periods" class="section level3">
<h3>Periods</h3>
<p>To solve this problem, {lubridate} provides <strong>periods</strong>. Periods are time spans that work with “human” times, like days and months.</p>
<pre class="r"><code>one_pm
#&gt; [1] &quot;2016-03-12 13:00:00 EST&quot;
one_pm + days(1)
#&gt; [1] &quot;2016-03-13 13:00:00 EDT&quot;</code></pre>
<div id="period-constructors" class="section level4">
<h4>Period constructors</h4>
<pre class="r"><code>seconds(15)
#&gt; [1] &quot;15S&quot;

minutes(10)
#&gt; [1] &quot;10M 0S&quot;

hours(c(12, 24))
#&gt; [1] &quot;12H 0M 0S&quot; &quot;24H 0M 0S&quot;

days(0:5)
#&gt; [1] &quot;0S&quot;          &quot;1d 0H 0M 0S&quot; &quot;2d 0H 0M 0S&quot; &quot;3d 0H 0M 0S&quot; &quot;4d 0H 0M 0S&quot;
#&gt; [6] &quot;5d 0H 0M 0S&quot;

weeks(3)
#&gt; [1] &quot;21d 0H 0M 0S&quot;

years(1)
#&gt; [1] &quot;1y 0m 0d 0H 0M 0S&quot;

months(1:6)
#&gt; [1] &quot;1m 0d 0H 0M 0S&quot; &quot;2m 0d 0H 0M 0S&quot; &quot;3m 0d 0H 0M 0S&quot; &quot;4m 0d 0H 0M 0S&quot;
#&gt; [5] &quot;5m 0d 0H 0M 0S&quot; &quot;6m 0d 0H 0M 0S&quot;</code></pre>
</div>
<div id="period-arithmetic" class="section level4">
<h4>Period Arithmetic</h4>
<pre class="r"><code>2 * years(1)
#&gt; [1] &quot;2y 0m 0d 0H 0M 0S&quot;
years(2)
#&gt; [1] &quot;2y 0m 0d 0H 0M 0S&quot;

years(1) + weeks(12) + hours(15)
#&gt; [1] &quot;1y 0m 84d 15H 0M 0S&quot;

10 * (months(6) + days(1))
#&gt; [1] &quot;60m 10d 0H 0M 0S&quot;

days(50) + hours(25) + minutes(2)
#&gt; [1] &quot;50d 25H 2M 0S&quot;</code></pre>
<p>Compared to durations, periods are more likely to do what you expect.</p>
<pre class="r"><code># A leap year
ymd(20200101) + dyears(1)
#&gt; [1] &quot;2020-12-31 06:00:00 UTC&quot;
ymd(20200101) + years(1)
#&gt; [1] &quot;2021-01-01&quot;

one_pm
#&gt; [1] &quot;2016-03-12 13:00:00 EST&quot;
one_pm + ddays(1)
#&gt; [1] &quot;2016-03-13 14:00:00 EDT&quot;
one_pm + days(1)
#&gt; [1] &quot;2016-03-13 13:00:00 EDT&quot;</code></pre>
<p>Some planes appear to have arrived at their destination <em>before</em> they departed from NYC.</p>
<pre class="r"><code>flights_dt %&gt;% 
  filter(arr_time &lt; dep_time)
#&gt; # A tibble: 10,633 x 9
#&gt;    origin dest  dep_delay arr_delay dep_time            sched_dep_time     
#&gt;    &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dttm&gt;              &lt;dttm&gt;             
#&gt;  1 EWR    BQN           9        -4 2013-01-01 19:29:00 2013-01-01 19:20:00
#&gt;  2 JFK    DFW          59        NA 2013-01-01 19:39:00 2013-01-01 18:40:00
#&gt;  3 EWR    TPA          -2         9 2013-01-01 20:58:00 2013-01-01 21:00:00
#&gt;  4 EWR    SJU          -6       -12 2013-01-01 21:02:00 2013-01-01 21:08:00
#&gt;  5 EWR    SFO          11       -14 2013-01-01 21:08:00 2013-01-01 20:57:00
#&gt;  6 LGA    FLL         -10        -2 2013-01-01 21:20:00 2013-01-01 21:30:00
#&gt;  7 EWR    MCO          41        43 2013-01-01 21:21:00 2013-01-01 20:40:00
#&gt;  8 JFK    LAX          -7       -24 2013-01-01 21:28:00 2013-01-01 21:35:00
#&gt;  9 EWR    FLL          49        28 2013-01-01 21:34:00 2013-01-01 20:45:00
#&gt; 10 EWR    FLL          -9       -14 2013-01-01 21:36:00 2013-01-01 21:45:00
#&gt; # ... with 10,623 more rows, and 3 more variables: arr_time &lt;dttm&gt;,
#&gt; #   sched_arr_time &lt;dttm&gt;, air_time &lt;dbl&gt;</code></pre>
<p>They are overnight flights and incorrectly have the same date information for both the departure and the arrival times.</p>
<pre class="r"><code>(flights_dt &lt;- flights_dt %&gt;% 
  mutate(overnight = arr_time &lt; dep_time,
         arr_time = arr_time + days(overnight * 1),
         sched_arr_time = sched_arr_time + days(overnight + 1))) %&gt;% 
  filter(overnight == TRUE) %&gt;% 
  print(width = Inf)
#&gt; # A tibble: 10,633 x 10
#&gt;    origin dest  dep_delay arr_delay dep_time            sched_dep_time     
#&gt;    &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dttm&gt;              &lt;dttm&gt;             
#&gt;  1 EWR    BQN           9        -4 2013-01-01 19:29:00 2013-01-01 19:20:00
#&gt;  2 JFK    DFW          59        NA 2013-01-01 19:39:00 2013-01-01 18:40:00
#&gt;  3 EWR    TPA          -2         9 2013-01-01 20:58:00 2013-01-01 21:00:00
#&gt;  4 EWR    SJU          -6       -12 2013-01-01 21:02:00 2013-01-01 21:08:00
#&gt;  5 EWR    SFO          11       -14 2013-01-01 21:08:00 2013-01-01 20:57:00
#&gt;  6 LGA    FLL         -10        -2 2013-01-01 21:20:00 2013-01-01 21:30:00
#&gt;  7 EWR    MCO          41        43 2013-01-01 21:21:00 2013-01-01 20:40:00
#&gt;  8 JFK    LAX          -7       -24 2013-01-01 21:28:00 2013-01-01 21:35:00
#&gt;  9 EWR    FLL          49        28 2013-01-01 21:34:00 2013-01-01 20:45:00
#&gt; 10 EWR    FLL          -9       -14 2013-01-01 21:36:00 2013-01-01 21:45:00
#&gt;    arr_time            sched_arr_time      air_time overnight
#&gt;    &lt;dttm&gt;              &lt;dttm&gt;                 &lt;dbl&gt; &lt;lgl&gt;    
#&gt;  1 2013-01-02 00:03:00 2013-01-03 00:07:00      192 TRUE     
#&gt;  2 2013-01-02 00:29:00 2013-01-03 21:51:00       NA TRUE     
#&gt;  3 2013-01-02 00:08:00 2013-01-03 23:59:00      159 TRUE     
#&gt;  4 2013-01-02 01:46:00 2013-01-03 01:58:00      199 TRUE     
#&gt;  5 2013-01-02 00:25:00 2013-01-03 00:39:00      354 TRUE     
#&gt;  6 2013-01-02 00:16:00 2013-01-03 00:18:00      160 TRUE     
#&gt;  7 2013-01-02 00:06:00 2013-01-03 23:23:00      143 TRUE     
#&gt;  8 2013-01-02 00:26:00 2013-01-03 00:50:00      338 TRUE     
#&gt;  9 2013-01-02 00:20:00 2013-01-03 23:52:00      152 TRUE     
#&gt; 10 2013-01-02 00:25:00 2013-01-03 00:39:00      154 TRUE     
#&gt; # ... with 10,623 more rows

flights_dt %&gt;% 
  filter(overnight, arr_time &lt; dep_time)
#&gt; # A tibble: 0 x 10
#&gt; # ... with 10 variables: origin &lt;chr&gt;, dest &lt;chr&gt;, dep_delay &lt;dbl&gt;,
#&gt; #   arr_delay &lt;dbl&gt;, dep_time &lt;dttm&gt;, sched_dep_time &lt;dttm&gt;, arr_time &lt;dttm&gt;,
#&gt; #   sched_arr_time &lt;dttm&gt;, air_time &lt;dbl&gt;, overnight &lt;lgl&gt;</code></pre>
</div>
</div>
<div id="intervals" class="section level3">
<h3>Intervals</h3>
<p><code>dyears(1) / ddays(365)</code> returns one, because durations are always represented by a number of seconds, and a duration of a year is defined as 365 days worth of seconds.</p>
<p>For <code>years(1) / days(1)</code> it gives an estimate, and a warning.</p>
<pre class="r"><code>dyears(1) / ddays(365)
#&gt; [1] 1.000685

years(1) / days(1)
#&gt; [1] 365.25</code></pre>
<p>For more accurate measurements, use an <strong>interval</strong>. An interval is a duration with a starting point and hence you can determine how long it is.</p>
<pre class="r"><code>(next_yr &lt;- today() + years(1))
#&gt; [1] &quot;2021-11-21&quot;
 
(today() %--% next_yr)
#&gt; [1] 2020-11-21 UTC--2021-11-21 UTC

# to find how many periods in an _interval_ use integer division
(today() %--% next_yr) %/% days(1)
#&gt; [1] 365

# for duration you can use / or integer division 
# for consistency probably %/% is better
(today() %--% next_yr) %/% ddays(1)
#&gt; [1] 365</code></pre>
<br>
<figure>
<img src="assets/datetimes-arithmetic.PNG" width="700" height="450" alt="The allowed arithmetic operations between pairs of date/time classes.">
<figcaption>
The allowed arithmetic operations between pairs of date/time classes.
</figcaption>
</figure>
</div>
<div id="exercises-2" class="section level3">
<h3>Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Why is there <code>months()</code> but no <code>dmonths()</code>?</p>
<p>A month is not easily converted to a number of seconds, because a month could be 4 weeks, 5 weeks, 28 days, 30 days, or 31 days.</p>
<p>For a day we use standard convention of 24 hours in a day, and convert that to seconds, same for a week (7 days of 24 each day). But with months there is no standard number.</p></li>
<li><p>Explain <code>days(overnight * 1)</code> to someone who has just started learning R. How does it work?</p>
<pre class="r"><code>(flights_dt &lt;- flights_dt %&gt;% 
  mutate(overnight = arr_time &lt; dep_time,
         arr_time = arr_time + days(overnight * 1),
         sched_arr_time = sched_arr_time + days(overnight + 1))) %&gt;% 
  filter(overnight == TRUE) %&gt;% 
  print(width = Inf)</code></pre>
<p><code>overnight</code> is a logical value - in the df each arr_time is checked against dep_time if it is before the departure time?</p>
<ul>
<li>it is: marked as TRUE (anomalies we are looking for).</li>
<li>it is not: marked as FALSE.</li>
</ul>
<p>We need to progress our anomaly arr_times on by <code>1 day</code>.</p>
<ul>
<li>For our anomalies overnight == TRUE which behind the scenes is the integer 1 (for yes, this criterion is met). <span class="math inline">\(overnight * 1 = 1 * 1 = 1\)</span>. The arrival time is progressed one day forward and is now accurate.</li>
<li>For normal flights (the arrival time is after the departure time) overnight == FALSE which behind the scenes is the integer 0 (for nope, this criterion is <strong>not</strong> met). <span class="math inline">\(overnight * 1 = 0 * 1 = 0\)</span>. The arrival time is unchanged since it is already correct.</li>
</ul></li>
<li><p>Create a vector of dates giving the first day of every month in 2015. Create a vector of dates giving the first day of every month in the <em>current</em> year.</p>
<pre class="r"><code>ymd(20150101) + months(0:11)
#&gt;  [1] &quot;2015-01-01&quot; &quot;2015-02-01&quot; &quot;2015-03-01&quot; &quot;2015-04-01&quot; &quot;2015-05-01&quot;
#&gt;  [6] &quot;2015-06-01&quot; &quot;2015-07-01&quot; &quot;2015-08-01&quot; &quot;2015-09-01&quot; &quot;2015-10-01&quot;
#&gt; [11] &quot;2015-11-01&quot; &quot;2015-12-01&quot;
floor_date(today(), &quot;year&quot;) + months(0:11)
#&gt;  [1] &quot;2020-01-01&quot; &quot;2020-02-01&quot; &quot;2020-03-01&quot; &quot;2020-04-01&quot; &quot;2020-05-01&quot;
#&gt;  [6] &quot;2020-06-01&quot; &quot;2020-07-01&quot; &quot;2020-08-01&quot; &quot;2020-09-01&quot; &quot;2020-10-01&quot;
#&gt; [11] &quot;2020-11-01&quot; &quot;2020-12-01&quot;</code></pre></li>
<li><p>Write a function that given your birthday (as a date), returns how old you are in years.</p>
<pre class="r"><code>age &lt;- function(dob){
  secs &lt;- as.duration(today() - dob)
  secs / (60 * 60 * 24 * 365)
}

age(ymd(20140612))
#&gt; [1] &quot;6.44931506849315s&quot;</code></pre></li>
<li><p>Why can’t <code>(today() %--% (today() + years(1))) / months(1)</code> work?</p>
<p>It works but I suspect that the <code>/</code> should be replaced by <code>%/%</code> integer division.</p>
<pre class="r"><code># how many months in the timespan today - next_yr_this_time
(today() %--% (today() + years(1))) %/% months(1)
#&gt; [1] 12</code></pre></li>
</ol>
<h2>
Timezones
</h2>
</div>
</div>
<div id="timezones" class="section level2">
<h2>Timezones</h2>
<pre class="r"><code># what is my timezone?
Sys.timezone()
#&gt; [1] &quot;Africa/Johannesburg&quot;</code></pre>
<p>Get a list of tz’s.</p>
<pre class="r"><code>length(OlsonNames())
#&gt; [1] 593
head(OlsonNames())
#&gt; [1] &quot;Africa/Abidjan&quot;     &quot;Africa/Accra&quot;       &quot;Africa/Addis_Ababa&quot;
#&gt; [4] &quot;Africa/Algiers&quot;     &quot;Africa/Asmara&quot;      &quot;Africa/Asmera&quot;
tail(OlsonNames())
#&gt; [1] &quot;US/Pacific-New&quot; &quot;US/Samoa&quot;       &quot;UTC&quot;            &quot;W-SU&quot;          
#&gt; [5] &quot;WET&quot;            &quot;Zulu&quot;</code></pre>
<p>In Base R: the time zone is an attribute of the date-time that only controls printing.</p>
<pre class="r"><code>(x1 &lt;- ymd_hms(&quot;2015-06-01 12:00:00&quot;, tz = &quot;America/New_York&quot;))
#&gt; [1] &quot;2015-06-01 12:00:00 EDT&quot;
(x2 &lt;- ymd_hms(&quot;2015-06-01 18:00:00&quot;, tz = &quot;Europe/Copenhagen&quot;))
#&gt; [1] &quot;2015-06-01 18:00:00 CEST&quot;
(x3 &lt;- ymd_hms(&quot;2015-06-02 04:00:00&quot;, tz = &quot;Pacific/Auckland&quot;))
#&gt; [1] &quot;2015-06-02 04:00:00 NZST&quot;

# verify same time
x1 - x2
#&gt; Time difference of 0 secs
x1 - x3
#&gt; Time difference of 0 secs</code></pre>
<p>{lubridate} always uses UTC.</p>
<pre class="r"><code># tz dropped
x4 &lt;- c(x1, x2, x3)
x4
#&gt; [1] &quot;2015-06-01 12:00:00 EDT&quot; &quot;2015-06-01 12:00:00 EDT&quot;
#&gt; [3] &quot;2015-06-01 12:00:00 EDT&quot;

# change tz for display
x4a &lt;- with_tz(x4, tzone = &quot;Australia/Lord_Howe&quot;)
x4a
#&gt; [1] &quot;2015-06-02 02:30:00 +1030&quot; &quot;2015-06-02 02:30:00 +1030&quot;
#&gt; [3] &quot;2015-06-02 02:30:00 +1030&quot;
x4a - x4
#&gt; Time differences in secs
#&gt; [1] 0 0 0

# change tz to fix an incorrect tz
x4b &lt;- force_tz(x4, tzone = &quot;Australia/Lord_Howe&quot;)
x4b
#&gt; [1] &quot;2015-06-01 12:00:00 +1030&quot; &quot;2015-06-01 12:00:00 +1030&quot;
#&gt; [3] &quot;2015-06-01 12:00:00 +1030&quot;
x4b - x4
#&gt; Time differences in hours
#&gt; [1] -14.5 -14.5 -14.5</code></pre>
<br>
<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-sessioninfo" data-toggle="collapse" data-target="#workflowr-sessioninfo" style="display: block;">
<span class="glyphicon glyphicon-wrench" aria-hidden="true"></span> Session information
</button>
</p>
<div id="workflowr-sessioninfo" class="collapse">
<pre class="r"><code>sessionInfo()
#&gt; R version 3.6.3 (2020-02-29)
#&gt; Platform: x86_64-w64-mingw32/x64 (64-bit)
#&gt; Running under: Windows 10 x64 (build 19042)
#&gt; 
#&gt; Matrix products: default
#&gt; 
#&gt; locale:
#&gt; [1] LC_COLLATE=English_South Africa.1252  LC_CTYPE=English_South Africa.1252   
#&gt; [3] LC_MONETARY=English_South Africa.1252 LC_NUMERIC=C                         
#&gt; [5] LC_TIME=English_South Africa.1252    
#&gt; 
#&gt; attached base packages:
#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     
#&gt; 
#&gt; other attached packages:
#&gt;  [1] werpals_0.1.0              nycflights13_1.0.1        
#&gt;  [3] tidyquant_1.0.0            quantmod_0.4.17           
#&gt;  [5] TTR_0.23-6                 PerformanceAnalytics_2.0.4
#&gt;  [7] xts_0.12-0                 zoo_1.8-7                 
#&gt;  [9] lubridate_1.7.9            magrittr_1.5              
#&gt; [11] flair_0.0.2                forcats_0.5.0             
#&gt; [13] stringr_1.4.0              dplyr_1.0.2               
#&gt; [15] purrr_0.3.4                readr_1.4.0               
#&gt; [17] tidyr_1.1.2                tibble_3.0.3              
#&gt; [19] ggplot2_3.3.2              tidyverse_1.3.0           
#&gt; [21] workflowr_1.6.2           
#&gt; 
#&gt; loaded via a namespace (and not attached):
#&gt;  [1] Rcpp_1.0.4.6     lattice_0.20-38  ps_1.3.2         utf8_1.1.4      
#&gt;  [5] assertthat_0.2.1 rprojroot_1.3-2  digest_0.6.27    R6_2.4.1        
#&gt;  [9] cellranger_1.1.0 backports_1.1.6  reprex_0.3.0     evaluate_0.14   
#&gt; [13] httr_1.4.2       pillar_1.4.6     rlang_0.4.8      curl_4.3        
#&gt; [17] readxl_1.3.1     rstudioapi_0.11  whisker_0.4      rmarkdown_2.4   
#&gt; [21] labeling_0.3     munsell_0.5.0    broom_0.7.2      compiler_3.6.3  
#&gt; [25] httpuv_1.5.2     modelr_0.1.8     xfun_0.13        pkgconfig_2.0.3 
#&gt; [29] htmltools_0.5.0  tidyselect_1.1.0 emo_0.0.0.9000   quadprog_1.5-8  
#&gt; [33] fansi_0.4.1      crayon_1.3.4     dbplyr_2.0.0     withr_2.2.0     
#&gt; [37] later_1.0.0      Quandl_2.10.0    grid_3.6.3       jsonlite_1.7.1  
#&gt; [41] gtable_0.3.0     lifecycle_0.2.0  DBI_1.1.0        git2r_0.26.1    
#&gt; [45] scales_1.1.0     cli_2.1.0        stringi_1.5.3    farver_2.0.3    
#&gt; [49] fs_1.5.0         promises_1.1.0   xml2_1.3.2       ellipsis_0.3.1  
#&gt; [53] generics_0.0.2   vctrs_0.3.2      tools_3.6.3      glue_1.4.2      
#&gt; [57] hms_0.5.3        yaml_2.2.1       colorspace_1.4-1 rvest_0.3.6     
#&gt; [61] knitr_1.28       haven_2.3.1</code></pre>
</div>
</div>
</div>


<!-- Adjust MathJax settings so that all math formulae are shown using
TeX fonts only; see
http://docs.mathjax.org/en/latest/configuration.html.  This will make
the presentation more consistent at the cost of the webpage sometimes
taking slightly longer to load. Note that this only works because the
footer is added to webpages before the MathJax javascript. -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
